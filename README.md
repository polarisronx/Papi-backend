<h1 align="center">Polaris API æ¥å£å¼€æ”¾å¹³å°</h1>
<p align="center"><strong>Papi æ˜¯ä¸€ä¸ªä¸ºç”¨æˆ·å’Œå¼€å‘è€…æä¾›å…¨é¢APIæ¥å£è°ƒç”¨æœåŠ¡çš„å¹³å° ğŸ› </strong></p>
<div align="center">
	<a target="_blank" href="https://github.com/polarisronx/Papi-backend">
    	<img alt="" src="https://github.com/qimu666/qi-api/badge/star.svg?theme=gvp"/>
	</a>
    <img alt="Maven" src="https://raster.shields.io/badge/Maven-3.8.2-red.svg"/>
    <img alt="SpringBoot" src="https://raster.shields.io/badge/SpringBoot-2.7+-green.svg"/>
    <a target="_blank" href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">
        <img alt="" src="https://img.shields.io/badge/JDK-1.8+-green.svg"/>
	</a></div>

## ä¸ºä»€ä¹ˆæ˜¯ Papi

Papi ä¸ºå¹¿å¤§çš„ç”¨æˆ·å’Œå¼€å‘è€…æä¾›äº†å¤§é‡å®ç”¨çš„ã€æ–°å¥‡çš„æ¥å£ã€‚

- å¦‚æœæ‚¨æ˜¯ç‹‚çƒ­çš„ Java å¼€å‘è€…ï¼Œæ‚¨å¯ä»¥å‰å¾€ <a href="https://github.com/polarisronx/Papi-backend">Polaris APIÂ </a> çš„æºç è¿›è¡Œç ”ç©¶ï¼Œæˆ‘ä»¬æ¬¢è¿æ‚¨ä¸€èµ·äº¤æµï¼Œä¸€èµ·ç©ç‚¹å¥½ç©çš„ã€‚
- å¦‚æœæ‚¨æ˜¯ç”¨ API è°ƒç”¨éœ€æ±‚çš„ç”¨æˆ·ï¼Œä¸”æœ‰ Java å¼€å‘çš„ç»éªŒï¼Œæ‚¨å¯ä»¥å®ç”¨ maven å¼•å…¥ <a href="https://github.com/polarisronx/Papi-backend">papi-client-sdk</a> ä¾èµ–åŒ…åœ¨æœ¬åœ°è½»æ¾è°ƒç”¨æ¥å£ã€‚
- å¦‚æœæ‚¨æ²¡æœ‰ Java å¼€å‘çš„åŸºç¡€æˆ–æ‚¨åªæ˜¯å¥½å¥‡ï¼Œæ‚¨å¯ä»¥å‰å¾€ <a href="https://api.papi.icu">Papi åœ¨çº¿å¼€æ”¾å¹³å°</a> åœ¨çº¿å°è¯•ã€‚

## ç½‘ç«™æŒ‡å—

<a href="https://api.papi.icu">Papi åœ¨çº¿å¼€æ”¾å¹³å°</a> 

<a href="https://doc.papi.icu">Papi å¼€å‘è€…æ–‡æ¡£</a>

> æˆ‘ä»¬ä¹Ÿæ¨èæ‚¨å‰å¾€æˆ‘ä»¬æ–°å¼€å‘çš„ <a href="bi.papi.icu">Polaris BI</a> æ™ºèƒ½åˆ†æå¹³å°ä½“éªŒï¼Œç›®å‰æ­£åœ¨å†…æµ‹âœ¨

## æºç æŒ‡å—

<a href="https://github.com/polarisronx/Papi-backend">Papi åç«¯é¡¹ç›®</a>

<a href="https://github.com/polarisronx/Papi-frontend">Papi å‰ç«¯é¡¹ç›®</a>

<a href="https://github.com/polarisronx/papi-gateway">Papi ç½‘å…³</a>

<a href="https://github.com/polarisronx/papi-client-sdk">Papi SDK</a>

<a href="https://github.com/polarisronx/papi-interface">Papi æ¥å£</a>

## å¿«é€Ÿå¯åŠ¨

### å‰ç«¯

ç¯å¢ƒè¦æ±‚ï¼šNode.js >= 16ï¼Œyarn æˆ– npm åŒ…ä¾èµ–å·¥å…·

1. å®‰è£…ä¾èµ–ï¼šnpm æˆ– yarn å‡å¯

```bash
yarn install
npm install
```

2. å¯åŠ¨ï¼šnpm æˆ– yarn å‡å¯

```bash
yarn run start
npm run start
```

3. éƒ¨ç½²ï¼šnpm æˆ– yarn å‡å¯

```bash
yarn run build
npm run build
```

### åç«¯

1. æ‰§è¡Œsqlç›®å½•ä¸‹ddl.sqlåœ¨æ•°æ®åº“ä¸­ç”Ÿæˆå¯¹åº”åº“è¡¨ï¼›
2. å¯åŠ¨ Redisã€nacosï¼›
3. ä¿®æ”¹é¡¹ç›®é…ç½®application.yamlï¼›
4. ä¾æ¬¡å¯åŠ¨ papi-main papi-gateway papi-interface

## ä¸»è¦æŠ€æœ¯é€‰å‹

### å‰ç«¯

- React 18.2.0
- Echarts å¯è§†åŒ–åº“ 5.5.0
- Ant Design Pro å¼€å‘è„šæ‰‹æ¶ 3.3.0
- Ant Design ç»„ä»¶åº“ 5.3.3
- Ant Design Pro Components 2.6.48
- UmiJS å‰ç«¯æ¡†æ¶ 4.1.1
- Openapi ç”Ÿæˆå·¥å…· 1.0.1

### åç«¯

- Java 1.8 ï¼ˆå‘ä¸Šå…¼å®¹ï¼‰
- Springboot 2.7.0
- Spring Cloud 2021.0.7
- Spring Cloud Alibaba 2022.0.0.0.RC1
- Dubbo  3.2.5
- Nacos 2.3.0
- Hutool 5.8.16
- Caffeine 2.9.2
- Redisson 3.21.3
- MySQL 8.0.31 ï¼ˆå…¼å®¹5.xç‰ˆæœ¬ï¼‰
- Redis 7.2.0 ï¼ˆå…¼å®¹ä½ç‰ˆæœ¬ï¼‰
- Knife4j 4.0.0
- Aliyun OSS  3.17.1

## å¼€å‘ç®€ä»‹

### é¡¹ç›®ç»“æ„

<img src="https://github.com/polarisronx/Papi-backend/doc/images/papi-architecture.png" style="zoom:80%;" />

## ä¸»è¦åŠŸèƒ½

### 1 ç™»å½•å’Œæ³¨å†Œ

æ‚¨å¯ä»¥ <a href="https://api.papi.icu">Papi åœ¨çº¿å¼€æ”¾å¹³å°</a> çš„ç™»å½•å’Œæ³¨å†Œé¡µé¢å®Œæˆç™»å½•å’Œæ³¨å†Œï¼Œç›®å‰æ”¯æŒè´¦å·å¯†ç ç™»å½•ï¼ˆæ³¨å†Œï¼‰å’Œé‚®ç®±éªŒè¯ç ç™»å½•ï¼ˆæ³¨å†Œï¼‰ã€‚

è¯·æ‚¨æ¥å—æˆ‘ä»¬ä¸ºæ‚¨é…ç½®çš„æµè§ˆå™¨ç•™å­˜ tokenï¼Œè¿™æ ·ç™»å½•çŠ¶æ€æœ‰æ•ˆå‘¨æœŸå†…ï¼ˆç›®å‰æ˜¯ 4 å¤©ï¼‰ï¼Œç³»ç»Ÿå°†ä¼šè‡ªåŠ¨ä¸ºæ‚¨ç™»å½•ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/login&register.png)

### 2 æ¥å£å‘å¸ƒ

æ‚¨å¯ä»¥ <a href="https://api.papi.icu">Papi åœ¨çº¿å¼€æ”¾å¹³å°</a> çš„å‘å°„ä¸­å¿ƒå‘åä¸ºäº’è”ç½‘çš„â€œæ˜Ÿäº‘â€å‘å°„ä½ è¶…ç‚«é…·çš„æ¥å£ï¼Œä¸å…¨å®‡å®™çš„å°ä¼™ä¼´ä¸€èµ·å…±äº«ä½ çš„åˆ›æ„ï¼

![](https://github.com/polarisronx/Papi-backend/doc/images/add.png)

<img src="https://github.com/polarisronx/Papi-backend/doc/images/add2.png" style="zoom:67%;" />

<img src="https://github.com/polarisronx/Papi-backend/doc/images/add3.png" style="zoom:67%;" />

ä½†è¯·æ³¨æ„ï¼šä¸Šä¼ çš„æ¥å£éœ€è¦æ»¡è¶³ä¸€å®šçš„è§„èŒƒï¼Œåœ¨ä¸Šä¼ å‰è¯·åŠ¡å¿…ä»”ç»†é˜…è¯»æ–‡æ¡£ <a href="https://doc.papi.icu">Papi å¼€å‘è€…æ–‡æ¡£</a>

### 3 æ¥å£åœ¨çº¿è°ƒè¯•

æ‚¨å¯ä»¥ <a href="https://api.papi.icu">Papi åœ¨çº¿å¼€æ”¾å¹³å°</a> çš„æ¥å£å¸‚åœºé€‰æ‹©è‡ªå·±å¿ƒä»ªçš„æ¥å£å¹¶åœ¨çº¿è°ƒè¯•ã€‚

<img src="https://github.com/polarisronx/Papi-backend/doc/images/interface-market.png" style="zoom: 67%;" />

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240710091557.png)

å½“ç„¶ï¼Œåœ¨æ‚¨è°ƒè¯•å‰ï¼Œå…ˆäº†è§£ä¸€ä¸‹æ¥å£çš„å‚æ•°ã€é”™è¯¯ç ã€ä»£ç å®ä¾‹ä¹Ÿæ˜¯ååˆ†å¿…è¦çš„âœ¨

![](https://github.com/polarisronx/Papi-backend/doc/images/tool.png)

### 4 æ¥å£å®¢æˆ·ç«¯è°ƒç”¨ SDK

- ä¸éœ€è¦springbootï¼Œä¸éœ€è¦ä»»ä½•æ¡†æ¶ï¼ç”šè‡³ä¸éœ€è¦å…¶ä»–ä¾èµ–ï¼
- ä¸éœ€è¦ä¸éœ€è¦ä»»ä½•å·¥å…·ç±»ï¼ä¸éœ€è¦å®ç°Httpè¯·æ±‚ï¼
- ä¸éœ€è¦é«˜æ·±çš„Javaå¼€å‘ç»éªŒå’ŒæŠ€å·§ï¼

åªéœ€è¦ JavaåŸºç¡€ JDKï¼Œå’Œå¯¥å¯¥å‡ å¥ä»£ç ï¼Œå³å¯è½»æ¾è°ƒç”¨ papi ä¸°å¯Œçš„æ¥å£ï¼

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240710135353.png)

æ­¤å¤–ï¼Œpapi-client-sdk å·²ç»ç™»é™† **Maven ä¸­å¿ƒä»“åº“**ï¼Œåªéœ€è¦åœ¨ pom æ–‡ä»¶ä¸­å¼•å…¥å³å¯å¿«é€Ÿå¯åŠ¨ğŸ‰

![](https://github.com/polarisronx/Papi-backend/doc/images/maven-papi.png)

(maven ä¸Šä¼ æœ‰å»¶è¿Ÿï¼Œ1.0.3ç‰ˆæœ¬å·²ç»å‘å¸ƒ)

```xml
<dependency>
    <groupId>io.github.polarisronx</groupId>
    <artifactId>papi-client-sdk</artifactId>
    <version>1.0.3</version>
</dependency>
```

æ‚¨å¯ä»¥æ‰‹åŠ¨å®ä¾‹åŒ– papi-client

```java
// 01 é…ç½®å¼€å‘å¯†é’¥
Credential credential = new Credential("polaris", "abcdefgh");
// 02 é…ç½®æ¥å£å’Œè¯·æ±‚å‚æ•°
HttpProfile httpProfile = new HttpProfile("localhost:8123", "/api/v1/roman/intToRoman", "GET");
HttpConnection httpConnection = new HttpConnection();
// 03 åˆ›å»ºpapiå®¢æˆ·ç«¯
PapiClient papi = new PapiClient(credential, httpProfile,httpConnection);
```

ä¹Ÿå¯ä»¥å¼•å…¥springbootæ¡†æ¶ï¼Œç”¨é…ç½®æ–‡ä»¶æ³¨å…¥å±æ€§è‡ªåŠ¨è£…é… papi-client å®ä¾‹

![](https://github.com/polarisronx/Papi-backend/doc/images/papi-yml.png)

ç„¶ååœ¨springæ‰«æè·¯å¾„çš„ç±»ä¸‹

```java
@Resource
PapiClient papiClient;
```

### 5 æ¥å£è°ƒç”¨ç»Ÿè®¡åˆ†æ

æ‚¨å¯ä»¥ <a href="https://api.papi.icu">Papi åœ¨çº¿å¼€æ”¾å¹³å°</a> çš„ç®¡ç†é¡µé¢æŸ¥çœ‹æ¥å£è°ƒç”¨çš„ç»Ÿè®¡åˆ†æï¼Œå»å‘ç°ä½ æœ€æƒ¯ç”¨çš„æ¥å£ã€‚

ç›®å‰åŠŸèƒ½è¿˜ååˆ†å•ä¸€ï¼Œä»…å¯¹ç®¡ç†å‘˜æƒé™ç”¨æˆ·å¼€æ”¾ï¼Œåç»­å®Œå–„åä¼šå¯¹æ‰€æœ‰ç”¨æˆ·å¼€æ”¾ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240711144449.png)

### 6 ä¸ªæ€§åŒ–è®¾ç½®

å¼€å‘è€…å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒå’Œè®¾ç½®ä¸­å¿ƒä¿®æ”¹ä¸ªæ€§åŒ–çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤´åƒã€æ˜µç§°ã€å¯†ç ç­‰ï¼Œä»¥æ»¡è¶³ä¸ªäººéœ€æ±‚ã€‚

# å¼€å‘è®°å½• note

![](https://github.com/polarisronx/Papi-backend/doc/images/images/Papi-request-detail.png)

## 1 å‰ç«¯é¡¹ç›®ç›®å½•ç»“æ„

![](https://github.com/polarisronx/Papi-backend/doc/images/image (3).png)

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240304104906.png)

åç«¯å‡†å¤‡å¤šä¸ªdto

![](https://github.com/polarisronx/Papi-backend/doc/images/image0304.png)

å‰ç«¯è‡ªåŠ¨ç”Ÿæˆ openAPI

modalForm æ¨¡æ€æ¡†

æ·»åŠ è¡¨å•é¡¹çš„æ ¡éªŒè§„åˆ™

![](https://github.com/polarisronx/Papi-backend/doc/images/image (4).png)

## 2 æ¥å£ä¿¡æ¯ç®¡ç†

> ä¿®æ”¹æ¥å£ä¿¡æ¯

å›é¡¾ä»¥å‰è°·ç²’å­¦è‹‘ä¸­ä¿®æ”¹è®²å¸ˆçš„æ–¹æ³•ã€‚å½“æ—¶æ˜¯ç”¨ Vue æ¥å®ç°çš„ã€‚

1. ä¿®æ”¹çš„ç•Œé¢æ²¡æœ‰è®¾ç½®å¼¹çª—ï¼Œä¹Ÿä¸ç‰¹åˆ«è®¾ç½®ä¸€ä¸ªä¿®æ”¹çš„é¡µé¢ï¼Œè€Œæ˜¯è®¾ç½®ä¸€ä¸ªéšè—è·¯ç”±ï¼ˆèœå•æ ä¸æ˜¾ç¤ºï¼Œåªæœ‰è®¿é—®åˆ°è¯¥é¡µé¢æ‰ä¼šè·³è½¬æ˜¾ç¤ºï¼‰ã€‚ä¿®æ”¹æ²¿ç”¨äº†æ·»åŠ çš„ç»„ä»¶ã€‚

   ```vue
   {
   	path: 'edit/:id',  
   	name: 'EduTeacherEdit',  // è·¯ç”±çš„åç§°
   	component: () => import('@/view/edu/teacher/save'),  // å¯¹åº”é¡¹ç›®ä¸­çš„è·¯å¾„
   	meta: {title: 'ç¼–è¾‘è®²å¸ˆ', noCache: true},
   	hidden: true
   }
   ```

2. åœ¨é¡µé¢ä¸­è®¾ç½®ä¿®æ”¹æŒ‰é’®ï¼Œç”¨ \<router-link> å®ç°è·¯ç”±çš„è·³è½¬ï¼ŒScope èƒ½ä¼ å›å½“å‰æ•°æ®è¡¨çš„æ•°æ®ï¼Œæ ¹æ®idè¿›å…¥åˆ°è¦ä¿®æ”¹çš„è®²å¸ˆ

   ```vue
   <router-link :to="'/teacher/eidt/' + scope.row.id">
   	<el-button type="primary" size="mini" icon="el-icon-edit">ä¿®æ”¹</el-button>
   </router-link>
   ```

3. æ ¹æ®idæŸ¥æ‰¾è®²å¸ˆåŸæœ‰çš„ä¿¡æ¯ï¼Œè¿›è¡Œæ•°æ®å›æ˜¾

4. ç”±äºä¿®æ”¹å’Œæ·»åŠ éƒ½å…±ç”¨äº† save çš„é¡µé¢ï¼Œè¦è¿›è¡Œä¸åŒçš„æ“ä½œã€‚åŒºåˆ«åœ¨äºä¿®æ”¹åœ¨è·¯å¾„ä¸­æœ‰idè€Œæ·»åŠ æ²¡æœ‰ã€‚

   **è·å–é¡µé¢å½“å‰çš„è·¯ç”±çš„æ–¹æ³•ï¼š<font color='red'> $router.params.id</font>**

   ```vue
   created(){ // é¡µé¢æ¸²æŸ“å‰è°ƒç”¨
   	console.log('created')
   	if (this.$router.params && this.$router.params.id){ å¦‚æœæœ‰ id å‚æ•°å°±è°ƒç”¨è¿™ä¸ªæ–¹æ³•
   		const id = this.$router.params.id
   		this.getInfoById(id) // æ ¹æ®idæŸ¥è¯¢è®²å¸ˆä¿¡æ¯è¿›è¡Œæ•°æ®å›æ˜¾ 
   	}
   }
   ```

5. åœ¨é¡µé¢ä¸­ï¼Œä¸è®ºæ˜¯ä¿®æ”¹è¿˜æ˜¯æ·»åŠ éƒ½æ˜¯ç‚¹å‡»ä¿å­˜æ¥æäº¤ï¼Œè¿™ä¸ªæŒ‰é’®å¯¹åº”äº†åŒä¸€ä¸ªæ–¹æ³• saveOrUpdate()ï¼Œè¦åœ¨è¿™ä¸ªæ–¹æ³•ä¸­åˆ¤æ–­æ˜¯ä¿®æ”¹è¿˜æ˜¯æ·»åŠ ã€‚åŒºåˆ«åœ¨äºï¼Œæ·»åŠ çš„è®²å¸ˆidæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¦ä¼ ç»™åç«¯çš„ teacher é‡Œæ²¡æœ‰idï¼Œè€Œä¿®æ”¹æœ‰idã€‚

   ```vue
   saveOrUpdate(){
   	// æ ¹æ®teacheræ˜¯å¦æœ‰idåˆ¤æ–­æ˜¯ä¿®æ”¹è¿˜æ˜¯æ·»åŠ 
   	if(!this.teacher.id){
   		// æ·»åŠ 
   		this.saveTeacher()
   	}else{
   		// ä¿®æ”¹
   		this.updateTeacher()
   	}
   }
   ```

å›åˆ°é¡¹ç›®ä¸­ï¼Œç°åœ¨ç”¨çš„æ˜¯ Reactã€‚

1. é¦–å…ˆï¼Œä¿®æ”¹ä¸æ·»åŠ modalå¤§è‡´ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œä¿®æ”¹æ˜¯æœ‰åŸæ•°æ®çš„ï¼Œæ‰€ä»¥modalä¸­è¦ä¼ è¿›æ¥å€¼ï¼Œç„¶åè®¾ç½®è¡¨å•å†…çš„åˆå§‹å€¼initialValues

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240306150939.png)

2. åœ¨é¡µé¢ä¸­ï¼Œä¼šæŠŠcurrentRowä¼ åˆ° modal ä¸­çš„valuesä¸­æ¥ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯initialValuesåªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼Œç‚¹å…¶ä»–è¡Œä¿®æ”¹æ—¶ï¼Œé‡Œé¢çš„æ•°æ®è¿˜æ˜¯æœ€å¼€å§‹çš„ã€‚æ‰€ä»¥è¦ç”¨ä¸€ä¸ªç›‘å¬ï¼Œå½“æ¢ä¸åŒçš„è¡Œï¼Œæ•°æ®å‘ç”Ÿäº†å˜åŒ–ä»¥åè¦è¿›è¡Œä¿®æ”¹ã€‚

3. åœ¨Reactä¸­ç”¨useEffect()æ¥ç›‘å¬æ•°æ®çš„å˜åŒ–ï¼Œæ³¨æ„formè¦ä¼ å…¥proTableRefï¼Œè¿™æ ·æ‰èƒ½è®¿é—®åˆ°è¡¨å•å®ä¾‹

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240307203743.png)

   - åœ¨ç»„ä»¶ä¸­å†™çš„å†…å®¹ä¼šç›´æ¥æ˜¾å¼åœ¨é¡µé¢ä¸Š

     ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240307203924.png)

4. åœ¨å®æµ‹æ—¶å‘ç°æŠ¥é”™ï¼Œæç¤ºæ²¡æœ‰ä¼ å…¥idã€‚æº¯æºï¼šç”¨æˆ·ç‚¹å‡»æäº¤ï¼Œå®é™…ä¸Šæ‰§è¡Œäº†onSubmitï¼Œå¹¶æ‰§è¡Œäº† handleUpdate()æ–¹æ³•ï¼Œå¹¶ä¼ è¿›Valueçš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ¥è‡ªæˆ‘ä»¬çš„å†…éƒ¨ç»„ä»¶UpdateModalè¿™ä¸ªæ¨¡æ€çª—é‡Œç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯ã€‚è€ŒUpdateModalæ¨¡æ€çª—å†…çš„columnsæ˜¯ç”±å¤–éƒ¨å®šä¹‰çš„ï¼Œåœ¨è¿™äº›columns ä¸­ï¼Œæˆ‘ä»¬æŠŠidåˆ—çš„å±æ€§å®šä¹‰ä¸ºäº†indexã€‚è¿™æ ·å®šä¹‰çš„ç»“æœæ˜¯ï¼Œidåˆ—ä¸ä¼šå‡ºç°åœ¨è¡¨å•é¡¹é‡Œï¼Œä¹Ÿå°±ä¸ä¼šè¢«å¡«å…¥è¡¨å•ã€‚

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240307204606.png)![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240307205223.png)

5. æˆ‘ä»¬éœ€è¦ä¿å­˜ç”¨æˆ·å½“å‰ç‚¹å‡»çš„æ•°æ®é¡¹çš„ idï¼Œè¿™é‡Œæœ‰ä¸ªç°æˆçš„ **<font color='red'>é€‰ä¸­è¡Œ</font>currentRow**ï¼Œç›´æ¥ç”¨è¿™ä¸ªå»å–idå°±è¡Œäº†ã€‚

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240307205911.png)

   æˆ‘ä»¬åœ¨ç‚¹å‡»ä¿®æ”¹æ—¶æ‰§è¡Œäº†é€‰ä¸­è¡Œå’Œè®©ä¿®æ”¹æ¨¡æ€æ¡†æ˜¾ç¤º

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240307211314.png)
   
   åœ¨è¡¨æ ¼ä¸­çš„renderå‡½æ•°ä¸­ï¼Œè¡Œè®°å½•çš„æ•°æ®å­˜å‚¨åœ¨recordä¸­
   
   ````typescript
   render:(_,record)=>[]
   ````
   
   

> åˆ é™¤æ¥å£

åˆä¸€ä¸ª**Reactçš„<font color='red'>é’©å­</font>actionRef.current?.reload()** ç”¨äºåˆ é™¤æˆåŠŸåˆ™è‡ªåŠ¨åˆ·æ–°è¡¨å•

## 3 æ¥å£è°ƒç”¨å®¢æˆ·ç«¯

>æ¥å£æ¨¡æ‹Ÿ

æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œåˆ›å»ºå‡ ä¸ªæµ‹è¯•ç”¨çš„æ¥å£ã€‚

> å®¢æˆ·ç«¯

æ–°å»ºä¸€ä¸ªå®¢æˆ·ç«¯ç±»ï¼Œç”¨hutoolçš„Httpè°ƒç”¨å·¥å…·å»è°ƒç”¨æˆ‘ä»¬é¡¹ç›®ä¸­çš„æ¥å£

## 4 APIç­¾åè®¤è¯

ç¬”è®°å‚è€ƒ tricks.md

## 5 SDKå¼€å‘

æ¯æ¬¡è°ƒç”¨æ¥å£éƒ½éœ€è¦è‡ªå·±å†™å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”å†™ç­¾åè®¤è¯ã€ä¼ é€’ç­¾åå‚æ•°ç­‰ä¸€ç³»åˆ—ä¸œè¥¿éå¸¸éº»çƒ¦ï¼Œéœ€è¦å¼€å‘ä¸€ä¸ªSDKå°±åƒmybatisä¸€æ ·ï¼Œå¼•å…¥starter ä¾èµ–ï¼Œåœ¨pomä¸­é…ç½®ï¼Œå°±å¯ä»¥è½»æ¾ä½¿ç”¨ã€‚ 

## 6 å‘å¸ƒå’Œä¸‹çº¿æ¥å£

> åç«¯

æ¥å£å­˜åœ¨ + æ¥å£å¯ç”¨ + ç®¡ç†å‘˜æƒé™ --> å‘å¸ƒæ¥å£ çŠ¶æ€å­—æ®µ ç½®ä¸º 1 

æ¥å£å­˜åœ¨ + ç®¡ç†å‘˜æƒé™ --> ä¸‹çº¿æ¥å£ çŠ¶æ€å­—æ®µ ç½®ä¸º 0 

ç®¡ç†å‘˜æƒé™ åˆ‡é¢ AOP

> å‰ç«¯

ä¸Šçº¿å’Œä¸‹çº¿ä¸åŒæ—¶å‡ºç°

```
record.status===0?<Button><\Button>
```

## 7 ä¸»é¡µæ¥å£ä¿¡æ¯

> ### 01 æ¥å£åˆ—è¡¨

index

> ### 02 æŸ¥çœ‹æ¥å£ä¿¡æ¯

interfaceinfo

**1 æ·»åŠ è·¯ç”±**

```typescript
// 1 è®©è¿™ä¸ªè·¯ç”±å¯ä»¥æ¥æ”¶åŠ¨æ€å‚æ•°ï¼Œåœ¨ç‚¹å‡»æŸ¥çœ‹ä¹‹åå¯ä»¥è·³åˆ°å¯¹åº”çš„æ¥å£é¡µé¢ï¼Œé€šè¿‡idæ¥åŒºåˆ†ä¸åŒçš„æ¥å£ã€‚

path: '/interface_info/:id'

// å®šä¹‰äº†è·¯ç”±çš„è·¯å¾„ï¼Œå…¶ä¸­:idæ˜¯ä¸€ä¸ªå‚æ•°å ä½ç¬¦ï¼Œè¡¨ç¤ºåœ¨å®é™…è·¯å¾„ä¸­å¯ä»¥ä¼ é€’ä¸€ä¸ªå…·ä½“çš„IDå€¼ä½œä¸ºå‚æ•°ã€‚
```

```typescript
//2 è®©è¿™ä¸ªé¡µé¢åœ¨èœå•æ ä¸­éšè—ï¼ŒæŸ¥çœ‹æ¥å£ä¸éœ€è¦æ”¾åœ¨èœå•æ ä¸Šã€‚

hidelnMenu: true

// è¡¨ç¤ºè¯¥è·¯ç”±åœ¨èœå•ä¸­æ˜¯å¦éšè—ï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™è¯¥è·¯ç”±ä¸ä¼šåœ¨èœå•ä¸­æ˜¾ç¤ºã€‚
```

router.ts å®Œæ•´å†…å®¹

```typescript
export default [
  { 
    name: 'ä¸»é¡µ',
    icon: 'smile',
    path: '/',
    component: './Index'
  },
  {
    name: 'æ¥å£è¯¦æƒ…é¡µ',
    icon: 'BarChartOutlined',
    path: '/interface_details',
    component: './InterfaceInfo',
    hideInMenu: true, // åœ¨èœå•éšè—
  },
  {
    name:'ç™»å½•',
    path: '/user',
    layout: false, //é€šè¿‡é…ç½® layout: false å¯ä»¥å•ç‹¬å…³é—­æŸä¸€ä¸ªè·¯ç”±çš„å…¨å±€å¸ƒå±€
    routes: [{ path: '/user/login', component: './User/Login' }] },
  {
    name: 'ç®¡ç†é¡µé¢',
    path: '/admin',
    icon: 'crown',
    access: 'canAdmin',
    routes: [
      { name: 'æ¥å£ç®¡ç†', icon:'table', path: '/admin/interface_info', component: './Admin/InterfaceInfo' },
    ],
  },
  // { name: 'è¡¨æ ¼', icon: 'table', path: '/list', component: './TableList' },
  // { path: '/', redirect: '/welcome' },
  { path: '*', layout: false, component: './404' },
];

```

**2 è·å–URLé‡Œçš„idæŸ¥è¯¢æ¥å£ä¿¡æ¯å¹¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤º**

ä¹‹å‰åœ¨Vueä¸­è·å–å½“å‰é¡µé¢çš„URLå‚æ•° **$router.params.id**ã€‚

umi-Reactä¸­ä¹Ÿæœ‰è‡ªå·±çš„**é’©å­**

1. **<font color='red'>userMatch</font>**å¯ä»¥è·å–æ•´ä¸ªé¡µé¢è·¯å¾„çš„è¯¦æƒ…ï¼Œå¦‚

```tsx
//ä½¿ç”¨useMatché’©å­å°†å½“å‰çš„URLä¸æŒ‡å®šçš„è·¯å¾„/interface_details/:idè¿›è¡ŒåŒ¹é…
//å¹¶å°†åŒ¹é…ç»“æœèµ‹ç»™matchå˜é‡
const match = useMatch('interface_detail/:id');
//ä½¿ç”¨JSON.stringifyå°†matchå˜é‡çš„å€¼è½¬ä¸ºJSONå­—ç¬¦ä¸²
alert(JSON.stringify(match))
```

![](https://github.com/polarisronx/Papi-backend/doc/images/image316.png)

2. ä½†æˆ‘ä»¬è¿™å¹¶ä¸éœ€è¦è¿™ä¹ˆå…¨çš„ä¿¡æ¯ï¼Œåªéœ€è·å–è·¯ç”±ä¸­çš„å‚æ•°ï¼Œå¯ä»¥ç”¨ useParams çš„é’©å­å‡½æ•°

## 8 æ¥å£è°ƒç”¨

å‰ç«¯ä¸å¯ä»¥ç›´æ¥è°ƒç”¨æ¥å£ï¼Œè€Œåº”è¯¥ç”±åç«¯è½¬æ¥ã€‚åŸå› åœ¨äºï¼Œå¦‚æœæ¨¡æ‹Ÿæ¥å£å¯ä»¥ç›´æ¥è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå­˜åœ¨å®‰å…¨é£é™©ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå‰ç«¯è™½ç„¶å¯ä»¥ç›´æ¥è°ƒç”¨æ¨¡æ‹Ÿæ¥å£ï¼Œä½†æˆ‘ä»¬ä¸ä¼šå°†æ¨¡æ‹Ÿæ¥å£æš´éœ²ç»™å¤–éƒ¨ï¼Œè€Œæ˜¯å°†å…¶éšè—èµ·æ¥ã€‚ç”¨æˆ·æˆ–å¼€å‘è€…åœ¨è°ƒç”¨æ—¶å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“æ¨¡æ‹Ÿæ¥å£çš„åœ°å€ã€‚å‡è®¾ï¼Œæ¨¡æ‹Ÿæ¥å£çš„åœ°å€æ˜¯aaa.com/apiï¼Œåç«¯åœ°å€æ˜¯
bbb.com/apiï¼Œè€Œ aaa.com/apiå¹¶ä¸å¯¹ç”¨æˆ·å¼€æ”¾ï¼Œç”¨æˆ·æ ¹æœ¬ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ã€‚

## 9 åˆ›å»ºç”¨æˆ·-æ¥å£ä¿¡æ¯è¡¨

åˆ›å»ºç”¨æˆ·-æ¥å£è¡¨ åç«¯ç®¡ç†

ä¿®æ”¹è°ƒç”¨æ¬¡æ•°è¦è€ƒè™‘å¹¶å‘

- è®¾è®¡æ•°æ®åº“è¡¨

  ç”¨æˆ·idå’Œæ¥å£idæ„æˆä¸€ä¸ªè”åˆä¸»é”®ï¼Œä¹Ÿå¯ä»¥å¦å¤–æ–°å»ºä¸€ä¸ªç”¨æˆ·æ¥å£å…³ç³»idä½œä¸ºä¸»é”®ã€‚

  è¦ä¸è¦è€ƒè™‘åŠ æ¥å£è°ƒç”¨æ—¶é—´ï¼Ÿä¸ï¼Œè¿™æ ·å¤ªå ç”¨ç©ºé—´ï¼ŒçœŸè¦æœ‰ä¸å¦‚ä½“ç°åœ¨æ—¥å¿—ä¸­ã€‚

<font color='green'>**todo ç”¨æˆ·è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡æ—¶ï¼Œéœ€è¦è€ƒè™‘å¹¶å‘çš„é—®é¢˜ï¼Œéœ€è¦åˆ†å¸ƒå¼é”ï¼Œè¿™é‡Œæ²¡æœ‰å®ç°**</font>

## 10 ç½‘å…³

> å¦‚ä½•å®ç°ç”¨æˆ·è°ƒç”¨åæ¬¡æ•°åŠ 1

1. æŠ½å–é€šç”¨ä»£ç ï¼Ÿ
2. AOPåˆ‡é¢ï¼Ÿæ‹¦æˆªå™¨ï¼Ÿ
3. ç½‘å…³ï¼Ÿ

AOPç‹¬ç«‹äºæ¥å£ï¼Œåœ¨æ¯ä¸ªæ¥å¤´è°ƒç”¨åæ¬¡æ•°åŠ ä¸€

1.2 é€‚ç”¨äºå•ä¸ªé¡¹ç›®å†…çš„æ¥å£è¢«è°ƒç”¨ã€‚ä½†æ˜¯æ¥å£å¯èƒ½ç”±ä¸åŒå›¢é˜Ÿå¼€å‘ï¼Œåˆ†å¸ƒåœ¨ä¸åŒé¡¹ç›®å†…ï¼Œè¿™æ—¶å¦‚æœè¦å¼€å‘å›¢é˜Ÿéƒ½å¼•å…¥è¿™æ®µé€»è¾‘ï¼Œä¸å¤ªæ–¹ä¾¿ã€‚åº”è¯¥é€šè¿‡ç½‘å…³æ¥è§£å†³ï¼Œç”±ç½‘å…³æ¥è´Ÿè´£ä¸ºç”¨æˆ·æ‰¾åˆ°æ¥å£çš„åœ°å€ï¼Œå¹¶ç»Ÿè®¡æ¬¡æ•°ï¼Œè€Œä¸ç”¨å…³å¿ƒæ¥å£åœ¨å“ªä¸ªé¡¹ç›®ã€‚

- æ€è€ƒå®ç°çš„ç»†èŠ‚

  æ€æ ·æ˜¯ç”¨æˆ·è°ƒç”¨å®Œï¼Ÿå¦‚æœæ˜¯ç½‘ç»œåŸå› ç­‰å¯¼è‡´çš„å¤±è´¥ï¼Œè€Œä¸æ˜¯å‚æ•°é”™è¯¯ç­‰åŸå› ï¼Œåº”è§†ä¸ºè¯·æ±‚å®Œæˆã€‚

  é™¤äº†ç»Ÿè®¡ç”¨æˆ·è°ƒç”¨æ¬¡æ•°ï¼Œè¿˜åº”è¯¥ç»™ç”¨æˆ·åˆ†é…è°ƒç”¨æ¬¡æ•°

> **ä»€ä¹ˆæ˜¯ç½‘å…³ï¼Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿ**

ç±»ä¼¼äºç«è½¦ç«™ã€‚å„ä¸ªæœåŠ¡ç†è§£ä¸ºç«è½¦ï¼Œå¯ä»¥å¼•å¯¼ç”¨æˆ·å»å“ªåˆ—ç«è½¦ï¼Œæ£€ç¥¨ã€‚

åŠŸèƒ½æœ‰ï¼šç»Ÿä¸€è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€ç»Ÿä¸€é‰´æƒã€è·¨åŸŸã€ç»Ÿä¸€ä¸šåŠ¡å¤„ç†ï¼ˆç¼“å­˜ã€é€šç”¨ä¸šåŠ¡ï¼‰ã€è®¿é—®æ§åˆ¶ã€å‘å¸ƒæ§åˆ¶ã€æµé‡æŸ“è‰²ã€æ¥å£ä¿æŠ¤ï¼ˆè¯·æ±‚é™åˆ¶ã€è„±æ•ã€é™çº§ç†”æ–­ã€é™æµã€è¶…æ—¶ï¼‰ã€ç»Ÿä¸€æ—¥å¿—å’Œæ–‡æ¡£ã€‚knife4j API æ¥å£æ–‡æ¡£ã€‚

**1 è·¯ç”±**

èµ·åˆ°è¯·æ±‚è½¬å‘çš„åŠŸèƒ½ã€‚ç½‘å…³è®°å½•å„ä¸ªæ¥å£ã€æœåŠ¡çš„ä¿¡æ¯ï¼Œæ ¹æ®ç”¨æˆ·è®¿é—®çš„åœ°å€å’Œå‚æ•°å°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„æ¥å£ï¼ˆæœåŠ¡ï¼‰ã€‚

å¦‚ /a  è½¬å‘åˆ° æ¥å£A

/b  è½¬å‘åˆ° æ¥å£B

**2 è´Ÿè½½å‡è¡¡**

/c è½¬å‘åˆ° æœåŠ¡Aã€é›†ç¾¤Aï¼ˆè½¬å‘åˆ°å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼‰

**3 ç»Ÿä¸€é‰´æƒ**

ç›¸æ¯”äºæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­è®¾è®¡é‰´æƒé€»è¾‘ï¼Œç½‘å…³çš„é‰´æƒæ›´ä¾§é‡äºç»Ÿä¸€ã€‚

**4 å¤„ç†è·¨åŸŸ**

ä¸ç”¨åœ¨å•ä¸ªé¡¹ç›®å•ç‹¬å¤„ç†è·¨åŸŸ

**5 ç»Ÿä¸€ä¸šåŠ¡é€»è¾‘**

æŠŠä¸€äº›æ¯ä¸ªé¡¹ç›®ä¸­éƒ½è¦åšçš„é€šç”¨é€»è¾‘éƒ½æ”¾åœ¨ç½‘å…³ç»Ÿä¸€

**6 è®¿é—®æ§åˆ¶**

åŒºåˆ«äºé‰´æƒï¼Œè®¿é—®æ§åˆ¶æ˜¯ç‹¬ç«‹äºé¡¹ç›®ä¸šåŠ¡ä¹‹å¤–çš„å¯¹è®¿é—®çš„é»‘ç™½åå•è®¾ç½®ï¼Œå¦‚é™åˆ¶ DDOS IPï¼Œç¦æ­¢è¯•å›¾æ”»å‡»ç½‘ç«™çš„IPè®¿é—®

**7 å‘å¸ƒæ§åˆ¶**

æµé‡æ§åˆ¶ï¼Œç±»ä¼¼äºç°åº¦å‘å¸ƒï¼Œæ¯”å¦‚åœ¨å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶ï¼Œè®©80%çš„æµé‡ä¾æ—§è®¿é—®æ—§ç‰ˆæœ¬ï¼Œ20%è®¿é—®æ–°ç‰ˆæœ¬ã€‚

**8 æµé‡æŸ“è‰²**

åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼Œæ‰¾åˆ°å‡ºç°é—®é¢˜çš„åœ°æ–¹ã€‚åŒºåˆ†æµé‡æ¥æºã€‚æ·»åŠ è¯·æ±‚æ ‡è¯†ï¼Œå¦‚ç»™æ¥è‡ªç½‘å…³çš„è¯·æ±‚åŠ è¯·æ±‚å¤´ï¼Œè¶Šè¿‡ç½‘å…³ç›´æ¥è®¿é—®çš„è¯·æ±‚å°±ä¸èƒ½è®¿é—®

filter ä¸­å¯ä»¥ addRequestHeader

> ç½‘å…³çš„æ ¸å¿ƒæ¦‚å¿µ

è·¯ç”±routerã€æ–­è¨€predicateã€è¿‡æ»¤å™¨filter

filterå¯ä»¥å¯¹è¯·æ±‚åšå¤„ç†ï¼Œå¦‚æ·»åŠ è¯·æ±‚å‚æ•°ã€è¯·æ±‚å¤´ã€æœåŠ¡é™çº§ç­‰

> ç½‘å…³çš„é…ç½®

```yaml
spring:
	cloud:
		gateway:
			routes: 
			#è¿™æ˜¯é…ç½®è·¯ç”±çš„å±æ€§ã€‚
			- id: after_route: 
			#è¿™æ˜¯è·¯ç”±çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„è·¯ç”±ã€‚
			  uri: https://example.org 
			  #è¿™æ˜¯è·¯ç”±å°†è¯·æ±‚è½¬å‘åˆ°çš„ç›®æ ‡URIï¼Œå³è¯·æ±‚ç»è¿‡æ­¤è·¯ç”±åå°†è¢«è½¬å‘åˆ°https://example.orgè¿™ä¸ªåœ°å€ã€‚
			  predicates: #è¿™æ˜¯æ–­è¨€çš„é…ç½®å±æ€§ï¼Œç”¨äºå®šä¹‰è¯·æ±‚æ˜¯å¦æ»¡è¶³è·¯ç”±æ¡ä»¶ã€‚
			  - Cookie=mycookie,mycookievalue:
			  # è¿™æ˜¯ä¸€ä¸ªæ–­è¨€æ¡ä»¶ï¼Œå®ƒæŒ‡å®šäº†è¯·æ±‚å¿…é¡»å…·æœ‰åä¸ºmycookieçš„Cookieï¼Œä¸”å…¶å€¼å¿…é¡»ä¸ºmycookievalueï¼Œæ‰èƒ½åŒ¹é…è¿™ä¸ªè·¯ç”±ã€‚
```

"-" è¡¨ç¤ºåˆ—è¡¨ï¼Œå¯ä»¥é…ç½®å¤šé¡¹

> ç½‘å…³çš„åˆ†ç±»

1. å…¨å±€ç½‘å…³ï¼ˆæ¥å…¥å±‚ç½‘å…³ï¼‰ï¼šå…¨å±€ç½‘å…³é€šå¸¸å±‚çº§è¾ƒé«˜ï¼Œå¯èƒ½è¦†ç›–å¤šä¸ªé¡¹ç›®æˆ–å¾®æœåŠ¡ï¼Œå¹¶è´Ÿè´£å°†ç”¨æˆ·çš„è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ä¸šåŠ¡ã€é¡¹ç›®ã€æ¥å£æˆ–æœåŠ¡ã€‚å®ƒä¸»è¦ç”¨äºè¯·æ±‚çš„è´Ÿè½½å‡è¡¡ã€è¯·æ±‚æ—¥å¿—ç­‰åŠŸèƒ½ï¼Œè¾ƒå°‘æ¶‰åŠå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚
2. ä¸šåŠ¡ç½‘å…³ï¼ˆå¾®æœåŠ¡ç½‘å…³ï¼‰ï¼šä½“ç°ä¸šåŠ¡é€»è¾‘ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°ä¸åŒçš„ä¸šåŠ¡/é¡¹ç›®/æ¥å£/æœåŠ¡ã€‚

ç½‘å…³æŠ€æœ¯é€‰å‹

1. Nginxï¼ˆå…¨å±€ç½‘å…³ï¼‰ã€Kongï¼ˆä»˜è´¹ï¼‰

   ç›¸æ¯”ä¹‹ä¸‹ï¼ŒNginxæ˜¯æ¯”è¾ƒæ¨èçš„å…¨å±€ç½‘å…³ï¼Œä¹Ÿç§°ä¸ºæ¥å…¥å±‚ç½‘å…³ã€‚Nginxå¯ä»¥éƒ¨ç½²å‰ç«¯å’Œåç«¯ï¼Œè¿˜èƒ½æä¾›æ–‡ä»¶è®¿é—®æœåŠ¡ç­‰å¤šç§åŠŸèƒ½ï¼Œéå¸¸çµæ´»ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨Nginxä¸­ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œä½†æ˜¯å¹¶ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºå®ƒå¹¶ä¸åƒSpring Cloud Gatewayé‚£æ ·æ–¹ä¾¿ã€‚

2. SpringCloud gatewayï¼Œæ€§èƒ½é«˜ï¼Œå¯ç”¨javaå¼€å‘

   Gatewayå–ä»£äº†zuulï¼Œä½¿ç”¨NIOå’Œå¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œåº•å±‚é‡‡ç”¨äº†nativeå’ŒReactæ¨¡å‹ï¼Œèƒ½å®ç°æ›´é«˜çš„å¹¶å‘é‡ã€‚

## 11 ç½‘å…³å®æ“

> è·¯ç”±è½¬å‘

è·¯å¾„å‰ç¼€æ–­è¨€

> ä¸šåŠ¡é€»è¾‘

å…¨å±€è¿‡æ»¤å™¨ globalFilter

- **exchange**(è·¯ç”±äº¤æ¢æœº):æˆ‘ä»¬æ‰€æœ‰çš„è¯·æ±‚çš„ä¿¡æ¯ã€å“åº”çš„ä¿¡æ¯ã€å“åº”ä½“ã€è¯·æ±‚ä½“éƒ½èƒ½ä»è¿™é‡Œæ‹¿åˆ°ã€‚

  ```java
  ServerHttpRequest req = exchange.getRequest();
  ```

- **chain**(è´£ä»»é“¾æ¨¡å¼):å› ä¸ºæˆ‘ä»¬çš„æ‰€æœ‰è¿‡æ»¤å™¨æ˜¯æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œå½¢æˆäº†ä¸€ä¸ªé“¾æ¡ã€‚æ‰€ä»¥è¿™é‡Œç”¨äº†ä¸€ä¸ªchainï¼Œå¦‚æœå½“å‰è¿‡æ»¤å™¨å¯¹è¯·æ±‚è¿›è¡Œäº†è¿‡æ»¤åå‘ç°å¯ä»¥æ”¾è¡Œï¼Œå°±è¦è°ƒç”¨è´£ä»»é“¾ä¸­çš„nextæ–¹æ³•ï¼Œç›¸å½“äºç›´æ¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè¿™é‡Œç§°ä¸º filterã€‚æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨è´£ä»»é“¾ä¸­ä½¿ç”¨nextï¼Œè€Œåœ¨è¿™é‡Œå®ƒä½¿ç”¨äº†filteræ¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œä»è€Œæ­£å¸¸åœ°æ”¾è¡Œè¯·æ±‚ã€‚

- æ‹¦æˆªè¯·æ±‚ï¼š

  ```java
  ServerHttpRequset = resp = exchange.getResponse();
  response.setStatusCode(HttpStatus.FORBIDDEN);
  return response.setComplete();
  ```

  è¿™ä¸ª**<font color='red'>Mono</font>**å…¶å®æ˜¯**å“åº”å¼ç¼–ç¨‹**çš„ä¸€ç§å¯¹è±¡ï¼Œç±»ä¼¼äºå‰ç«¯çš„ Promiseã€‚å¦‚æœä½ ç†Ÿæ‚‰å‰ç«¯çš„å¼‚æ­¥æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥å°†Monoç†è§£ä¸ºç±»ä¼¼çš„æ¦‚å¿µã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥è¿”å›äº†è¿™ä¸ªMonoï¼Œå®ƒå¹¶ä¸åŒ…å«å“åº”å‚æ•°ã€‚ç›¸å½“äºæˆ‘ä»¬å‘Šè¯‰ç¨‹åºï¼Œè¯·æ±‚å¤„ç†å®Œæˆäº†ï¼Œä¸éœ€è¦å†æ‰§è¡Œå…¶ä»–æ“ä½œäº†ã€‚

**é—®é¢˜**ï¼šé¢„æœŸæ˜¯ç­‰æ¨¡æ‹Ÿæ¥å£è°ƒç”¨å®Œæˆï¼Œæ‰è®°å½•å“åº”æ—¥å¿—ã€ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°ï¼Œä½†æ˜¯å‘ç°chain.filter()æ–¹æ³•æ”¾è¡Œï¼ŒFilterè¿‡æ»¤å™¨returnæ‰§è¡Œå®Œäº†ä¹‹åæ‰æ‰§è¡Œçš„æ¥å£æ–¹æ³•ã€‚å› ä¸ºæ˜¯chain.filter()å¼‚æ­¥çš„ï¼Œæ²¡æœ‰ç«‹å³å»æ‰§è¡Œæ¥å£æ–¹æ³•ï¼ŒGatewayçš„æ¶æ„é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯æ‰§è¡Œå®Œæ‰€æœ‰çš„Filterå€¼æ‰æ‹¿åˆ°æœåŠ¡çš„ä»£ç†å¯¹è±¡æ‰§è¡Œçš„ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240325211736.png)

è§£å†³æ–¹æ³•ï¼šåˆ©ç”¨**Responseè£…é¥°è€…**ï¼Œå¢å¼ºåŸæœ‰Responseçš„å¤„ç†èƒ½åŠ›ã€‚

**<font color='red'>ServerHttpResponseDecorated</font>**(HttpResponse originalResponse) ç±»ä¼¼ä¸AOPå¢å¼ºäº†æ–¹æ³•ï¼Œè¿™ä¸ªè£…é¥°ç±»å¢å¼ºäº†Responseç±»ï¼Œè€Œè¿™é‡Œé¢å†™çš„é€»è¾‘éƒ½æ˜¯åœ¨è°ƒç”¨æ¥å£è·å–å“åº”åæ‰§è¡Œäº†ï¼Œå°±èƒ½å¤Ÿå¼•å…¥å¹¶æ›¿æ¢åŸå…ˆFilterä¸­çš„é€»è¾‘ã€‚ 

**è¿™æ ·å“ªæ€•å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œå½“æœ€åæ‰§è¡Œè¿™ä¸ªæ–¹æ³•æ—¶ï¼Œè£…é¥°å™¨ä¹Ÿèƒ½åšé¢å¤–çš„äº‹æƒ…ã€‚è¿™å°±æ˜¯è£…é¥°è€…åˆ©ç”¨è£…é¥°å¢å¼ºåŸæœ‰æ–¹æ³•çš„å¤„ç†èƒ½åŠ›ã€‚**

todo ç½‘å…³é¡¹ç›®å†…æ˜¯æ²¡æœ‰mybatisçš„ï¼Œä¸èƒ½åšæ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥ï¼Œå¯ä»¥è°ƒç”¨ backend é¡¹ç›®ä¸­çš„æ¥å£

- Httpè¯·æ±‚ï¼ˆHttpClientã€RestTemplateã€OpenFeignï¼‰
- RPCï¼ˆDubboï¼‰

### åŸºäºgatewayçš„è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡

dubbo-nacosè¸©å‘

nacosä¸è¦ç”¨è¿™ä¸ªä¾èµ–ï¼Œpapi-gatewayä½œä¸ºæ¶ˆè´¹è€…æ³¨å†Œåˆ°nacosä¸€ç›´æ³¨å†Œä¸ä¸Šï¼Œè™½ç„¶èƒ½å¤Ÿè°ƒåˆ°papi-mainæä¾›çš„æœåŠ¡ï¼Œä½†æ˜¯ä¸èƒ½è·å–åˆ°å…¶ä»–å¾®æœåŠ¡ï¼Œåœ¨è¿™é‡Œæƒ³è¦ç”¨æœåŠ¡åè´Ÿè½½å‡è¡¡åœ°è°ƒç”¨papi-interfaceå´æ˜¯ä¸èƒ½äº†ã€‚

```xml
<dependency>
    <groupId>com.alibaba.nacos</groupId>
    <artifactId>nacos-client</artifactId>
    <version>2.3.0</version>
</dependency>
```

æ”¹ç”¨ä¸‹é¢è¿™ä¸ªä¾èµ–å°±è¡Œäº†

```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

è´Ÿè½½å‡è¡¡

```yaml
spring:
  application:
    name: papi-gateway
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: b765d215-8484-45ec-a86f-07048c01dd47
        group: ${spring.profiles.active}
        username: nacos
        password: nacos
    loadbalancer:
      nacos:
        enabled: false
    gateway:
      routes:
        - id: papi-route
#          uri: http://localhost:8123
          uri: lb://papi-interface
          predicates:
            - Path=/api/**
```

### åŸºäºGatewayçš„æµé‡æŸ“è‰²

ç»™é€šè¿‡ç½‘å…³çš„è¯·æ±‚éƒ½åŠ ç»Ÿä¸€è¯·æ±‚å¤´ï¼Œä¸æ¥è‡ªç½‘å…³çš„è¯·æ±‚ä¸æºå¸¦æŒ‡å®šè¯·æ±‚å¤´å°†è¢«æ‹’ç»

[ç½‘å…³gateway tokenéªŒè¯æˆåŠŸåæ·»åŠ è¯·æ±‚å¤´æ“ä½œ_gatewayæ·»åŠ è¯·æ±‚å¤´-CSDNåšå®¢](https://blog.csdn.net/qq_51456123/article/details/125735344)

## 14 æ¥å£è°ƒç”¨ç»Ÿè®¡åˆ†æ

> ### <font color='red'>**è°ƒç”¨æ¥å£çš„è¿‡ç¨‹ï¼š**</font>

1. **å‰ç«¯ 8000** ç‚¹å‡»è°ƒç”¨ 
2. **åç«¯ 7529** controller /Invoke  
3. **sdk** åç«¯ç”±LoginUserè·å–AKå’ŒSKè·å–å®¢æˆ·ç«¯ papiClient
4. **sdk** åç«¯ç”±å®¢æˆ·ç«¯é€šè¿‡Httpåè®®è°ƒç”¨æ¥å£ï¼ŒåŒæ—¶ä¼šæ·»åŠ ç”¨æˆ·ç­¾åè®¤è¯æ‰€éœ€çš„è¯·æ±‚å¤´ 
5. **ç½‘å…³ 8090** è¯·æ±‚æ‰“åˆ°ç½‘å…³ï¼Œç½‘å…³é‰´æƒã€è½¬å‘
6. **æ¥å£é¡¹ç›® 8123** æ¥å£è°ƒç”¨

## 12 RPC

> è°ƒç”¨å¦ä¸€ä¸ªé¡¹ç›®é‡Œçš„æ–¹æ³•

**1.å¤åˆ¶ä»£ç å’Œä¾èµ–ã€ç¯å¢ƒ**

å¯èƒ½æœ‰ç¯å¢ƒä¾èµ–å’Œä»£ç é—®é¢˜ï¼Œå¸¸é‡ã€é…ç½®ç­‰å†²çªæˆ–ä¸åŒï¼›

**2.HTTPè¯·æ±‚**(æä¾›ä¸€ä¸ªæ¥å£ï¼Œä¾›å…¶ä»–é¡¹ç›®è°ƒç”¨)

**3.RPC**

**4ï¼å®¢æˆ·ç«¯SDK**ï¼ˆæŠŠå…¬å…±çš„ä»£ç æ‰“ä¸ªjaråŒ…ï¼Œå…¶ä»–é¡¹ç›®å»å¼•ç”¨ï¼‰

> RPC

åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•

å’Œç›´æ¥Httpè°ƒç”¨çš„åŒºåˆ«

1. å¯¹å¼€å‘è€…æ›´é€æ˜ï¼Œå‡å°‘äº†æ²Ÿé€šæˆæœ¬

   åœ¨è°ƒç”¨æœ¬åœ°æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ é€’å‚æ•°ç»™æ–¹æ³•ï¼Œæ¯”å¦‚æ¥å£ç»Ÿè®¡çš„æ–¹æ³•ã€‚ä½†æ˜¯Httpè¯·æ±‚éœ€è¦è°ƒç”¨æ–¹åšæ›´å¤šçš„æ“ä½œæ¥é…åˆæ‰èƒ½ä½¿ç”¨ã€‚å¦‚yuapi-client-sdké¡¹ç›®é‡Œï¼Œä½ éœ€è¦è‡ªè¡Œå°è£…HTTPè¯·æ±‚ï¼Œå°†å‚æ•°æ‰“åŒ…æˆä¸€ä¸ªå‚æ•°æ˜ å°„(map)ï¼Œç„¶åæŒ‰ç…§å®¢æˆ·ç«¯å·¥å…·ç±»çš„æ–¹å¼å‘é€è¯·æ±‚ã€‚æ­¤å¤–ï¼Œä½ è¿˜éœ€è¦è§£æè¿”å›å€¼ï¼Œå°†å…¶ä¸­çš„codeã€dataä»¥åŠ messageç­‰ä¿¡æ¯æå–å‡ºæ¥ã€‚

2. å‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå¯ä»¥é€‰æ‹©æ€§èƒ½æ›´é«˜çš„åè®®ï¼ˆRPCå¯ä»¥ç”¨Httpï¼Œä½†å¯ä»¥é€‰æ‹©å…¶ä»–å¦‚TCP/IPï¼‰

3. ##### æœåŠ¡æ²»ç†ï¼ˆä¸‹æ¸¸æœåŠ¡æ–°å¢ï¼Œé‡å¯ï¼Œä¸‹çº¿æ—¶å¦‚ä½•ä¸å½±å“ä¸Šæ¸¸è°ƒç”¨è€…ï¼‰

   - RPCï¼šèƒ½åšåˆ°è‡ªåŠ¨é€šçŸ¥ï¼Œä¸å½±å“ä¸Šæ¸¸
   - HTTPï¼šéœ€è¦äº‹å…ˆé€šçŸ¥ï¼Œä¿®æ”¹Nginx/HAProxyé…ç½®

**RPCä¸»è¦ç”¨äºå…¬å¸å†…éƒ¨æœåŠ¡è°ƒç”¨ï¼Œæ€§èƒ½æ¶ˆè€—ä½ï¼Œä¼ è¾“æ•ˆç‡é«˜ï¼ŒæœåŠ¡æ²»ç†æ–¹ä¾¿**ã€‚**HTTPä¸»è¦ç”¨äºå¯¹å¤–çš„å¼‚æ„ç¯å¢ƒï¼Œæµè§ˆå™¨è°ƒç”¨ï¼ŒAPPæ¥å£è°ƒç”¨ï¼Œç¬¬ä¸‰æ–¹æ¥å£è°ƒç”¨ç­‰ç­‰ã€‚**

> Dubbo

Dubbo3 ä½¿ç”¨çš„åè®®æ˜¯ Tripleåè®®ï¼Œæ˜¯åŸºäº HTTP çš„å¼€æ”¾åè®®ï¼Œæ—¨åœ¨è§£å†³ Dubbo2 ç§æœ‰åè®®å¸¦æ¥çš„äº’é€šæ€§é—®é¢˜ï¼ŒTripe åŸºäº gRPC å’Œ gRPC-Web è®¾è®¡è€Œæ¥ï¼Œä¿ç•™äº†ä¸¤è€…çš„ä¼˜ç§€è®¾è®¡ï¼ŒTriple åšåˆ°äº†å®Œå…¨å…¼å®¹ gRPC åè®®ï¼Œå¹¶å¯åŒæ—¶è¿è¡Œåœ¨ HTTP/1 å’Œ HTTP/2 ä¹‹ä¸Šã€‚

Dubbo ç¼ºçœåè®®é‡‡ç”¨å•ä¸€é•¿è¿æ¥å’Œ NIO å¼‚æ­¥é€šè®¯ï¼Œé€‚åˆäºå°æ•°æ®é‡å¤§å¹¶å‘çš„æœåŠ¡è°ƒç”¨ï¼Œä»¥åŠæœåŠ¡æ¶ˆè´¹è€…æœºå™¨æ•°è¿œå¤§äºæœåŠ¡æä¾›è€…æœºå™¨æ•°çš„æƒ…å†µã€‚

> RPC å®æ“

Dubbo+nacos 

è¦å®ç°çš„ä¸šåŠ¡åŠŸèƒ½

1. backendé¡¹ç›®ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œæä¾›3ä¸ªæ–¹æ³•:

  aï¼å®é™…æƒ…å†µåº”è¯¥æ˜¯å»æ•°æ®åº“ä¸­æŸ¥æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·

  b.ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠè¯·æ±‚æ–¹æ³•æ˜¯å¦åŒ¹é…(è¿˜å¯ä»¥æ ¡éªŒè¯·æ±‚å‚æ•°)

  cï¼è°ƒç”¨æˆåŠŸï¼Œæ¥å£è°ƒç”¨æ¬¡æ•°+1 invokeCount

2. gateway é¡¹ç›®ä½œä¸ºæœåŠ¡è°ƒç”¨è€…ï¼Œè°ƒç”¨è¿™3ä¸ªæ–¹æ³•

- ä»€ä¹ˆæ˜¯IDLï¼Ÿ
- å¦‚ä½•ä½¿ç”¨ï¼š
  - å¼•å…¥ä¾èµ–
  - æä¾›è€…ä¸»ç±»@EnableDubbo
  - æä¾›è€…æ¥å£çš„å®ç°@DubboService
  - æ¶ˆè´¹è€…@DubboReferenceæ³¨å…¥

## 13 æŠ½å–å…¬å…±æœåŠ¡

é¡¹ç›®å: yuapi-common

ç›®çš„:è®©æ–¹æ³•ã€å®ä½“ç±»åœ¨å¤šä¸ªé¡¹ç›®é—´å¤ç”¨ï¼Œå‡å°‘é‡å¤ç¼–å†™ã€‚

æœåŠ¡æŠ½å–:

1.æ•°æ®åº“ä¸­æŸ¥æ˜¯å¦å·²åˆ†é…ç»™ç”¨æˆ·ç§˜é’¥ï¼ˆæ ¹æ®accessKeyæ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨)

2ï¼ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ¨¡æ‹Ÿæ¥å£æ˜¯å¦å­˜åœ¨ï¼ˆ(è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å‚æ•°ï¼Œè¿”å›æ¥å£ä¿¡æ¯ï¼Œä¸ºç©ºè¡¨ç¤ºä¸å­˜åœ¨)

3ï¼æ¥å£è°ƒç”¨æ¬¡æ•°ï¼‹1 invokeCount (accessKeyã€secretKey(æ ‡è¯†ç”¨æˆ·)ï¼Œè¯·æ±‚æ¥å£è·¯å¾„)

æ­¥éª¤:

1. æ–°å»ºå¹²å‡€çš„mavené¡¹ç›®ï¼Œåªä¿ç•™å¿…è¦çš„å…¬å…±ä¾èµ–

2. æŠ½å–serviceæ¥å£å’Œå®ä½“ç±»

3. installæœ¬åœ° mavenåŒ…
4. è®©æœåŠ¡æä¾›è€…å¼•å…¥commonåŒ…ï¼Œæµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ
5. è®©æœåŠ¡æ¶ˆè´¹è€…å¼•å…¥commonåŒ…

- **å…¬å…±åŒ…é‡Œçš„æ¥å£ç”¨Innerå‰ç¼€ä¸å…¶ä»–ç›¸åŒºåˆ†ï¼Œå¹¶ä¸”åªéœ€è¯´æ˜ç»“æ„å³å¯ï¼Œå…·ä½“å®ç°åœ¨å…¶ä»–é¡¹ç›®å®Œæˆã€‚**
- **ä¸”æ¥å£ä¸ç”¨ç»§æ‰¿mybatisçš„IServiceï¼Œåœ¨å…¶ä»–é¡¹ç›®å®ç°æ—¶ç›´æ¥ç”¨æ³¨å…¥çš„mapperå³å¯**

**<font color='green'>todo æµé‡æŸ“è‰²</font>**

<font color='green'>**todo è·å–æ¥å£host**</font>

<font color='green'>**todo sdkä¸­é’ˆå¯¹ä¸åŒè¯·æ±‚è°ƒç”¨ä¸åŒæ¥å£æ–¹æ³•**</font>

**<font color='green'>todo è®©å…¶ä»–ç”¨æˆ·ä¸Šä¼ æ¥å£</font>**

æœ‰åŒå­¦é—®:å¦‚ä½•è®©å…¶ä»–ç”¨æˆ·ä¸Šä¼ è‡ªå·±ç¼–å†™çš„æ¥å£?
éœ€è¦æä¾›ä¸€ä¸ªæ³¨å†Œæœºåˆ¶ã€‚åœ¨è¿™ä¸ªæœºåˆ¶ä¸‹ï¼Œå…¶ä»–ç”¨æˆ·å¯ä»¥ä¸Šä¼ ä»–ä»¬è‡ªå·±ç¼–å†™çš„æ¥å£ä¿¡æ¯ã€‚ä¸ºäº†ç®€åŒ–æµç¨‹ï¼Œå¯ä»¥è®¾è®¡ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢ã€‚åœ¨è¿™ä¸ªç•Œé¢ä¸Šï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ä»–ä»¬çš„æ¥å£ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨åœ°å€(host)ã€è¯·æ±‚è·¯å¾„ç­‰å†…å®¹ã€‚ä¹Ÿå¯ä»¥è§„å®šï¼Œåœ¨æ¥å…¥æˆ‘ä»¬çš„å¹³å°æ—¶ï¼Œç”¨æˆ·å¿…é¡»ä½¿ç”¨æˆ‘ä»¬æä¾›çš„SDKæˆ–éµå¾ªä¸€å®šçš„è¦æ±‚ã€‚
å¦‚ä½•è¿›è¡Œæ¥å…¥å’Œè¦æ±‚çš„éµå¾ª?åœ¨ç”¨æˆ·ä¸Šä¼ æ¥å£çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¥å£ä¿¡æ¯è¿›è¡Œæµ‹è¯•è°ƒç”¨ï¼Œä»¥ç¡®ä¿æ¥å£çš„æ­£å¸¸è¿è¡Œï¼Œè¿™å¯ä»¥é€šè¿‡æˆ‘ä»¬çš„å¹³å°æ¥å®Œæˆã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¦æ±‚ç”¨æˆ·æ ‡æ˜è¯¥æ¥å£æ˜¯å¦æ˜¯ç”±æˆ‘ä»¬çš„ç½‘å…³è°ƒç”¨ï¼Œè¿™å¯èƒ½éœ€è¦ç”¨æˆ·åœ¨ä»£ç ä¸­åŠ å…¥åˆ¤æ–­ä»£ç ï¼Œæˆ–è€…å¼•å…¥æˆ‘ä»¬æä¾›çš„SDKæ¥å®ç°ã€‚
æ¥å£ä¿¡æ¯çš„ç»„ç»‡å’Œå­˜å‚¨:å½“ç”¨æˆ·ä¸Šä¼ æ¥å£ä¿¡æ¯æ—¶ï¼Œè¿™äº›ä¿¡æ¯å°†è¢«å­˜å‚¨åœ¨InterfaceInfoæ¥å£ä¸­ã€‚é™¤äº†URLå¤–ï¼Œè¿˜åº”è¯¥æ·»åŠ ä¸€ä¸ªhostå­—æ®µï¼Œç”¨äºæ˜ç¡®åŒºåˆ†ä¸åŒæœåŠ¡å™¨çš„åœ°å€ã€‚è¿™æ ·ï¼Œå¯ä»¥æ›´æ¸…æ™°åœ°åŒºåˆ†è¯·æ±‚è·¯å¾„å’ŒæœåŠ¡å™¨åœ°å€ï¼Œæé«˜æ¥å£ä¿¡æ¯çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚



## 14 æ¥å£è°ƒç”¨ç»Ÿè®¡åˆ†æ

å„æ¥å£çš„æ€»è°ƒç”¨æ¬¡æ•°å æ¯”ï¼ˆé¥¼å›¾ï¼‰å–è°ƒç”¨æœ€å¤šçš„å‰3ä¸ªæ¥å£ï¼Œä»è€Œåˆ†æå‡ºå“ªäº›æ¥å£æ²¡æœ‰äººç”¨(é™ä½èµ„æºã€æˆ–è€…ä¸‹çº¿)ï¼Œé«˜é¢‘æ¥å£(å¢åŠ èµ„æºã€æé«˜æ”¶è´¹)ã€‚

> #### åç«¯

æŸ¥è¯¢å„æ¥å£çš„æ€»è°ƒç”¨æ¬¡æ•°ï¼Œåœ¨ UserInterfaceInfo è¡¨ä¸­æŒ‰ InterfaceId åˆ†ç»„æŸ¥è¯¢ã€‚

ä½†æ˜¯æˆ‘ä»¬è¦è¿›è¡Œå±•ç¤ºï¼Œéœ€è¦è·å–æ¥å£åï¼Œåˆ™åˆéœ€è¦å† InterfaceInfoè¡¨ä¸­è¿›è¡ŒæŸ¥è¯¢ã€‚



## 15 è§‚æ‘©å¤§å‚çš„APIå¹³å°

æ’åä¸åˆ†å…ˆå

å¤§å‚å¿…å¤‡çš„æä¾›ç»™å¼€å‘è€…æ¥åœ¨çº¿è°ƒè¯•è‡ªå®¶çš„æœåŠ¡å’Œæ¥å£çš„å¹³å°ã€‚

### TencentCloud 

è…¾è®¯ äº‘API å¹³å° [äº‘ API_äº‘äº§å“æ¥å£_äº‘èµ„æºç®¡ç†_äº‘è¿ç»´å¼€å‘ - è…¾è®¯äº‘ (tencent.com)](https://cloud.tencent.com/product/api)

> ##### 01 è…¾è®¯APIè°ƒè¯•æ–¹å¼

- ä¸‹è½½SDK

- API explorer åœ¨çº¿è°ƒè¯•

  https://console.cloud.tencent.com/api/explorer

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329105337.png)

> ##### 02 SDKä¿¡æ¯

æ¬¢è¿ä½¿ç”¨è…¾è®¯äº‘å¼€å‘è€…å·¥å…·å¥—ä»¶ï¼ˆSDKï¼‰3.0ï¼ŒSDK 3.0æ˜¯äº‘ API 3.0å¹³å°çš„é…å¥—å·¥å…·ã€‚ç›®å‰å·²ç»æ”¯æŒ CVMã€VPCã€CBS ç­‰äº§å“ï¼Œåç»­æ‰€æœ‰çš„äº‘æœåŠ¡äº§å“éƒ½ä¼šé™†ç»­æ¥å…¥ã€‚æ–°ç‰ˆ SDK å®ç°äº†ç»Ÿä¸€åŒ–ï¼Œå…·æœ‰å„ä¸ªè¯­è¨€ç‰ˆæœ¬çš„ SDK ä½¿ç”¨æ–¹æ³•ç›¸åŒï¼Œæ¥å£è°ƒç”¨æ–¹å¼ç›¸åŒï¼Œé”™è¯¯ç ç›¸åŒä»¥åŠè¿”å›åŒ…æ ¼å¼ç›¸åŒç­‰ä¼˜ç‚¹ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329105445.png)

> ##### 03 SDKä½¿ç”¨æ–‡æ¡£

[Java-SDK ä¸­å¿ƒ-è…¾è®¯äº‘ (tencent.com)](https://cloud.tencent.com/document/sdk/Java#d006b724-ca4d-462d-90f8-b4f14748ac6e)

ä½¿ç”¨ä¸Šè¿°å¼•ç”¨æ–¹å¼ä¼šå°†è…¾è®¯äº‘æ‰€æœ‰äº§å“çš„ SDK ä¸‹è½½åˆ°æœ¬åœ°ã€‚å¦‚æœæ‚¨åªéœ€è¦ç‰¹å®šäº§å“çš„ SDKï¼Œå¯ä»¥å°† artifactId æ›¿æ¢ä¸º tencentcloud-sdk-java-cvm/cbs/vpc ç­‰ã€‚ä»£ç ä¸­çš„ä½¿ç”¨æ–¹å¼å’Œæ•´ä½“ SDK ç›¸åŒï¼Œå¯å‚è€ƒç¤ºä¾‹ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨ [Maven ä»“åº“ ](https://search.maven.org/search?q=tencentcloud-sdk-java)ä¸­æŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬ï¼Œå¯èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚

> ##### 04 SDK-JAVA æºç åˆ†æ

[TencentCloud/tencentcloud-sdk-java: Tencent Cloud API 3.0 SDK for Java (github.com)](https://github.com/TencentCloud/tencentcloud-sdk-java)

**æºç ç»“æ„**

ä¸»è·¯å¾„ä¸‹æ˜¯ä¸åŒåŠŸèƒ½æ¨¡å—çš„å¯¹åº”SDKåŒ…

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329114259.png)![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329114354.png)

**å•ä¸ªæ¨¡å—æºç ç»“æ„**

- **models**åŒ…

  ä¸»è¦æ˜¯å¯¹åº”ä¸€ä¸ªAPIæ¥å£çš„ä¸€ä¸ªRequestå’ŒResponseå°è£…ç±»ï¼ˆç”¨äºå‘é€è¯·æ±‚æ—¶çš„å‚æ•°å’Œæ¥æ”¶å“åº”ç»“æœçš„å°è£…ç±»ï¼‰ï¼Œä¹Ÿæœ‰ä¸€äº›è¯¥æ¨¡å—ä¸‹ç‰¹æœ‰çš„ä¸€äº›å…¶ä»–æ–¹æ³•

  ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329115521.png)

- **AaClient**

  å®¢æˆ·ç«¯ç±»ï¼Œä¸»è¦æ˜¯ä¸‰éƒ¨åˆ†ï¼šå±æ€§ã€æ„é€ å™¨ã€æ–¹æ³•

  ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329115857.png)

  **æ„é€ å™¨**ï¼šæ„é€ å™¨ä¸­éœ€è¦ä¼ å…¥credentialï¼ˆå‡­è¯ï¼Œåé¢è®²ï¼‰ï¼Œregionï¼ˆåœ°åŒºï¼‰ï¼ŒClientProfileï¼ˆå®šä¹‰å®¢æˆ·ç«¯çš„å±æ€§è€Œå°è£…çš„ç±»ï¼Œä¸»è¦æ˜¯è®¾ç½®ç­¾åæ–¹æ³•ã€Httpå±æ€§ã€è¯­è¨€ã€æ˜¯å¦debugç­‰ï¼‰

  **æ–¹æ³•**ï¼šè°ƒç”¨APIçš„å…¥å£æ–¹æ³•ï¼ˆä¸æ˜¯å…·ä½“çš„ä¸šåŠ¡ï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•å°±ä¼šå‘é€è¯·æ±‚åˆ°å¯¹åº”çš„ä¸»æœºæ¥æ‰§è¡Œä¸šåŠ¡ï¼‰ï¼Œå‚æ•°æ˜¯åœ¨modelsä¸­çš„Requestå°è£…ç±»ï¼Œè¿”å›ç±»å‹æ˜¯Responseçš„å°è£…ç±»ã€‚é‡Œé¢æ‰§è¡Œäº†ç›¸å¯¹é€šç”¨çš„å‘é€è¯·æ±‚çš„æ–¹æ³• internalRequest()ï¼Œä¸»è¦æ˜¯æ ¹æ®ä¸åŒçš„API (actionName)æ¥å‘é€è¯·æ±‚ï¼ˆåé¢ç»†è®²ï¼‰ã€‚

  ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329125804.png)

- **AaErrorCode**

  å®šä¹‰äº†ä¸åŒé”™è¯¯ç±»å‹çš„æšä¸¾ç±»

  ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329130641.png)

**æºç é€šç”¨ç»“æ„ï¼šCommonåŒ…**

CommonåŒ…ç»“æ„

1. Exception

   é€šç”¨çš„å¼‚å¸¸ç±»

2. HttpConnection

   è·å–Httpè¿æ¥ï¼Œå®šä¹‰äº†doRequest()ã€getRequest()ã€PostRequest()ç­‰å‘èµ·è¯·æ±‚çš„æ–¹æ³•

3. Profile

   å®šä¹‰å®¢æˆ·ç«¯ã€Httpè¿æ¥å±æ€§çš„å°è£…ç±»ã€æšä¸¾ç±»ã€‚

4. Provider

   å®šä¹‰äº†é’ˆå¯¹ä¸åŒä½¿ç”¨åœºæ™¯çš„ç”¨æˆ·å‡­è¯ ï¼ˆé‡Œé¢çš„ç±»ç»§æ‰¿äº†Credentialï¼‰

5. é€šç”¨ç»“æ„

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329131824.png)

   - AbstractClientï¼šæŠ½è±¡ç±»ï¼Œå®šä¹‰äº†å®¢æˆ·ç«¯çš„ä¸€äº›åŸºç¡€ç»“æ„ï¼Œå…¶ä»–æ¨¡å—çš„å®¢æˆ·ç«¯åœ¨æ­¤åŸºç¡€ä¸Šå®ç°

   - Credentialï¼šå®šä¹‰äº†ç”¨æˆ·è°ƒç”¨æ¥å£è®¸å¯çš„å‡­è¯ï¼Œå¦‚å¯†é’¥IDå’Œå¯†é’¥ã€‚

     ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329133815.png)

   - signï¼šå®šä¹‰å‰é¢ç”Ÿæˆæ–¹æ³•ï¼ŒåŠ å¯†ç®—æ³•ç­‰

     ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329134206.png)

   - AbtractModelï¼šæŠ½è±¡ç±»ï¼Œå®šä¹‰äº†Requestå’ŒResponseçš„ä¸€äº›åŸºç¡€ç»“æ„ï¼Œå…¶ä»–æ¨¡å—çš„Requestå’ŒResponseåœ¨æ­¤åŸºç¡€ä¸Šå®ç°

**ç»†çœ‹å‰é¢æåˆ°çš„å‘èµ·è¯·æ±‚çš„æ–¹æ³• internalRequest()**

1. å…ˆçœ‹è¡¨å±‚

```java
protected String internalRequest(AbstractModel request, String actionName)
            throws TencentCloudSDKException {
	// CircuitBreaker æ–­è·¯å™¨ï¼Œå¯¹è°ƒç”¨è¿‡ç¨‹èµ·åˆ°ä¸€ä¸ªæµç¨‹æ§åˆ¶å’Œè®°å½•çš„ä½œç”¨
    CircuitBreaker.Token breakerToken = null;
    if (regionBreaker != null) {
        breakerToken = regionBreaker.allow();// æ”¾è¡Œ
        if (!breakerToken.allowed) {
            endpoint = service + "." + profile.getBackupEndpoint();
        }
    }
	// è®°å½•å“åº”ä¿¡æ¯
    Response okRsp;
    try {
        okRsp = internalRequestRaw(request, actionName);
    } catch (IOException e) {
        // network failure, consider region failure
        if (breakerToken != null) {
            breakerToken.report(false); // è®°å½•é”™è¯¯ä¿¡æ¯
        }
        throw new TencentCloudSDKException("", e);
    }
	// å“åº”æˆåŠŸçš„è¿”å›
    String strResp;
    try {
        strResp = okRsp.body().string();
    } catch (IOException e) {
        String msg = "Cannot transfer response body to string, because Content-Length is too large, or Content-Length and stream length disagree.";
        log.info(msg);
        throw new TencentCloudSDKException(msg, e);
    }
	// å“åº”å¤±è´¥çš„è¿”å›
    JsonResponseModel<JsonResponseErrModel> errResp;
    try {
        Type errType = new TypeToken<JsonResponseModel<JsonResponseErrModel>>() {
        }.getType();
        errResp = gson.fromJson(strResp, errType);
    } catch (JsonSyntaxException e) {
        String msg = "json is not a valid representation for an object of type";
        log.info(msg);
        throw new TencentCloudSDKException(msg, e);
    }

    if (errResp.response.error != null) {
        if (breakerToken != null) {// å¦‚æœå“åº”å¤±è´¥ï¼Œæ–­è·¯å™¨ä¸ä¸ºç©ºï¼Œè¿›è¡Œä¸€äº›æ•…éšœæ’æŸ¥
            JsonResponseErrModel error = errResp.response;
            boolean regionOk = error.requestId != null
                && !error.requestId.isEmpty()
                && error.error.code != null
                && !error.error.code.equals("InternalError");
            breakerToken.report(regionOk);
        }
        throw new TencentCloudSDKException(
            errResp.response.error.message,
            errResp.response.requestId,
            errResp.response.error.code);
    }

    return strResp;
}
```

è¿˜æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œè¿™ä¸ªæ›´ç®€æ´

```java
protected <T> T internalRequest(AbstractModel request, String actionName, Class<T> typeOfT)
            throws TencentCloudSDKException {
        CircuitBreaker.Token breakerToken = null;
        if (regionBreaker != null) {
            breakerToken = regionBreaker.allow();
            if (!breakerToken.allowed) {
                endpoint = service + "." + profile.getBackupEndpoint();
            }
        }

        try {
            Response resp = internalRequestRaw(request, actionName);
            if (Objects.equals(resp.header("Content-Type"), "text/event-stream")) {
                return processResponseSSE(resp, typeOfT, breakerToken);
            }
            // å¤„ç†è¿”å›çš„å“åº”ï¼ŒtypeOfTä¼šä¼ è¿›å„ä¸ªæ¨¡å—ä¸­å®šä¹‰çš„Responseç±»
            return processResponseJson(resp, typeOfT, breakerToken);
        } catch (IOException e) {
            // network failure, consider region failure
            if (breakerToken != null) {
                breakerToken.report(false);
            }
            throw new TencentCloudSDKException("", e);
        }
    }
```

2. å®é™…ä¸Šè¿˜åŒ…äº†ä¸€å±‚ï¼Œ**okRsp = internalRequestRaw(request, actionName)** æ‰æ˜¯å®é™…æœ‰ä½œç”¨çš„ï¼Œç‚¹è¿›è¿™ä¸ªæ–¹æ³•

è¿™ä¸ªæ–¹æ³•å‰é¢çš„æˆ‘ä»¬ä¸å…³å¿ƒï¼Œå°±æ˜¯è·å–ä¸€äº›å±æ€§ï¼Œè®¾ç½®ç­¾åçš„ç®—æ³•ï¼Œå®é™…ä½œç”¨çš„æ˜¯æ¡†å‡ºæ¥çš„ **doRequest**å’Œ**doRequestWithTC3**ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329142339.png)

3. **doRequest()**æ¯”è¾ƒç®€æ´ï¼Œå…ˆçœ‹

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329142825.png)

   **å¯¹äº<font color='red'>get</font>è¯·æ±‚**ï¼š

   æŠŠ **<font color='red'>åè®® protocol + è¯·æ±‚åŸŸå endpoint + è¯·æ±‚è·¯å¾„ path + ? + è¯·æ±‚å‚æ•° strParam</font>** æ‹¼æ¥èµ·æ¥å°±æ˜¯APIæ¥å£è°ƒç”¨çš„è·¯å¾„

   getRequest()æ–¹æ³•ä¸­ï¼Œå°†è¯·æ±‚åœ°å€ã€è¯·æ±‚å¤´æ”¾å…¥åˆ›å»ºè¯·æ±‚ï¼Œç„¶ådoRequest()æ‰§è¡Œã€‚

   **å¯¹äº<font color='red'>post</font>è¯·æ±‚**ï¼š

   æŠŠ <font color='red'>**åè®® protocol + è¯·æ±‚åŸŸå endpoint + è¯·æ±‚è·¯å¾„ path** </font>æ‹¼æ¥èµ·æ¥å°±æ˜¯APIæ¥å£è°ƒç”¨çš„è·¯å¾„ã€‚

   postRequest()æ–¹æ³•ä¸­ï¼Œè¯·æ±‚å‚æ•°ä»¥**application/x-www-form-urlencoded**é”®å€¼å¯¹å‚æ•°ç±»å‹æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œå°†è¯·æ±‚åœ°å€ã€è¯·æ±‚å¤´æ”¾å…¥åˆ›å»ºè¯·æ±‚ï¼Œç„¶ådoRequest()æ‰§è¡Œã€‚

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329145129.png)

   å…³äºè¯·æ±‚å‚æ•° StrParam çš„ç‰¹åˆ«è¯´æ˜ï¼šè¯·æ±‚å‚æ•°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€æ˜¯APIæ¥å£æœ¬èº«è¦ä¼ é€’çš„å‚æ•°ï¼Œè¿™ä¸ªç”±ä¸åŒæ¨¡å—è‡ªå·±çš„Requestå·²ç»å°è£…å¥½äº†ï¼ŒäºŒæ˜¯APIæ¥å£åï¼Œå› ä¸ºå¯¹äºé€šç”¨çš„è¯·æ±‚å‘èµ·æ–¹æ³•æ¥è¯´ï¼Œä¸çŸ¥é“å®é™…è¦è¯·æ±‚çš„æ˜¯å“ªä¸ªæ¥å£ã€‚

4. **doRequestWithTC3()**ç›¸æ¯”doRequest()ä¸»è¦æ˜¯å¤šäº†åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ç­¾åçš„è¿‡ç¨‹ï¼Œè€ƒè™‘äº†é‰´æƒçš„é—®é¢˜ã€‚

   ```java
   private Response doRequestWithTC3(String endpoint, AbstractModel request, String action)
       throws TencentCloudSDKException, IOException {
       /*
          æ­¤å¤„çœç•¥ä¸€å¤§æ®µä»£ç 
       */
       String stringToSign =
           "TC3-HMAC-SHA256\n" + timestamp + "\n" + credentialScope + "\n" + hashedCanonicalRequest;
       boolean skipSign = request.getSkipSign();
       String authorization = "";
       if (skipSign) {
           authorization = "SKIP";
       } else {
           // è·å–ç­¾åä¿¡æ¯
           String secretId = this.credential.getSecretId();
           String secretKey = this.credential.getSecretKey();
           byte[] secretDate = Sign.hmac256(("TC3" + secretKey).getBytes(StandardCharsets.UTF_8), date);
           byte[] secretService = Sign.hmac256(secretDate, service);
           byte[] secretSigning = Sign.hmac256(secretService, "tc3_request");
           // ç”ŸæˆåŠ å¯†ç­¾å
           String signature =
               DatatypeConverter.printHexBinary(Sign.hmac256(secretSigning, stringToSign)).toLowerCase();
           // æœ€ç»ˆçš„ç­¾åè®¤è¯
           authorization =
               "TC3-HMAC-SHA256 "
               + "Credential="
               + secretId
               + "/"
               + credentialScope
               + ", "
               + "SignedHeaders="
               + signedHeaders
               + ", "
               + "Signature="
               + signature;
       }
       // å°†ç­¾åè®¤è¯æ·»åŠ åˆ°è¯·æ±‚å¤´
       Builder hb = new Headers.Builder();
       hb.add("Content-Type", contentType)
           .add("Host", endpoint)
           .add("Authorization", authorization)
           .add("X-TC-Action", action)
           .add("X-TC-Timestamp", timestamp)
           .add("X-TC-Version", this.apiVersion)
           .add("X-TC-RequestClient", SDK_VERSION);
       if (null != request.GetHeader()) {
           for (Map.Entry<String, String> entry : request.GetHeader().entrySet()) {
               hb.add(entry.getKey(), entry.getValue());
           }
       }
       if (null != this.getRegion()) {
           hb.add("X-TC-Region", this.getRegion());
       }
       String token = this.credential.getToken();
       if (token != null && !token.isEmpty()) {
           hb.add("X-TC-Token", token);
       }
       if (this.profile.isUnsignedPayload()) {
           hb.add("X-TC-Content-SHA256", "UNSIGNED-PAYLOAD");
       }
       if (null != this.profile.getLanguage()) {
           hb.add("X-TC-Language", this.profile.getLanguage().getValue());
       }
   
       String protocol = this.profile.getHttpProfile().getProtocol();
       String url = protocol + endpoint + this.path;
       String apigwEndpoint = this.profile.getHttpProfile().getApigwEndpoint();
       if (null != apigwEndpoint) {
           url = protocol + apigwEndpoint;
           hb.set("Host", apigwEndpoint);
       }
       Headers headers = hb.build();
       // å¸¦è¯·æ±‚å¤´æ‰§è¡Œgetæ–¹æ³•
       if (httpRequestMethod.equals(HttpProfile.REQ_GET)) {
           return this.httpConnection.getRequest(url + "?" + canonicalQueryString, headers);
       } else if (httpRequestMethod.equals(HttpProfile.REQ_POST)) {
           // å¸¦è¯·æ±‚å¤´æ‰§è¡Œpostæ–¹æ³•
           return this.httpConnection.postRequest(url, requestPayload, headers);
       } else {
           // ä¸æ”¯æŒpostå’Œgetä¹‹å¤–çš„æ–¹æ³•
           throw new TencentCloudSDKException("Method only support GET, POST");
       }
   }
   ```

----

**æœ€åå†æ¥çœ‹ä¸€ä¸ªtestçš„å®ä¾‹ï¼Œè¿˜æ˜¯ç”¨æœ€å¼€å§‹çš„AAï¼ˆæ´»åŠ¨é˜²åˆ·ï¼‰ä¸¾ä¾‹**

ç‚¹å‡»ä¸‹è½½å·¥ç¨‹å°±èƒ½æŠŠè¯¥APIæ¥å£ç›¸å…³çš„SDKä¸‹è½½ä¸‹æ¥äº†

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329195657.png)

åœ¨IDEAä¸­æ‰“å¼€

è’¸é”…è¿‡ç¨‹å¤§æ¦‚å°±æ˜¯ï¼š

1. ä¼ å…¥å¯†é’¥
2. è®¾ç½®å®¢æˆ·ç«¯å±æ€§
3. ç”Ÿæˆå®¢æˆ·ç«¯
4. ç”Ÿæˆè¯·æ±‚å‚æ•°å¯¹è±¡Request
5. æ‰§è¡Œæ–¹æ³•
6. æ‹¿åˆ°å“åº”Response

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329195350.png)

### Aliyun

é˜¿é‡Œäº‘ä¹Ÿæ˜¯å¾ˆå¼ºï¼Œä½†åŠŸèƒ½ç±»ä¼¼ï¼Œå°±ä¸ç»†å“äº†

å®˜ç½‘ï¼š[é˜¿é‡Œäº‘OpenAPIå¼€å‘è€…é—¨æˆ· (aliyun.com)](https://api.aliyun.com/)

æ–‡æ¡£ï¼š[OpenAPI Explorer(OpenAPI)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ (aliyun.com)](https://help.aliyun.com/product/74373.html?spm=a2c4g.74407.0.0.785bde53r5xA54)

OpenAPI é—¨æˆ·ï¼Œè‹±æ–‡åç§° OpenAPI Portal æˆ– OpenAPI Explorerã€‚å®ƒæ˜¯ä¸€æ¬¾é›† OpenAPI æ™ºèƒ½æœç´¢ã€æ–‡æ¡£ã€åœ¨çº¿è°ƒè¯•ã€SDK è·å–ã€CodeSampleã€è°ƒç”¨å‡ºé”™è¯Šæ–­ã€è°ƒç”¨ç»Ÿè®¡ä¸ºä¸€ä½“çš„äº§å“ã€‚æ‚¨å¯ä»¥åœ¨ OpenAPI é—¨æˆ·ä¸­è°ƒç”¨é˜¿é‡Œäº‘å„äº‘äº§å“å¼€æ”¾çš„ OpenAPI ï¼ŒæŸ¥çœ‹ OpenAPI è¯·æ±‚å’Œè¿”å›ç»“æœã€‚æ­¤å¤–ï¼Œ OpenAPI é—¨æˆ·ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº” OpenAPI çš„ SDK è°ƒç”¨ç¤ºä¾‹ï¼Œå¸®åŠ©æ‚¨ä½¿ç”¨é˜¿é‡Œäº‘ OpenAPI ã€‚

> 01 åŠŸèƒ½

OpenAPI é—¨æˆ·æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- OpenAPI æ£€ç´¢

  æ±‡é›†é˜¿é‡Œäº‘å¤šä¸ªäº§å“çš„ OpenAPI ï¼Œå¯ä»¥åœ¨æ­¤é›†ä¸­æ£€ç´¢ï¼Œå¿«é€Ÿæ‰¾åˆ°æ‚¨æ‰€éœ€è¦çš„ APIã€‚

- OpenAPI è°ƒç”¨

  æ— éœ€ç¼–å†™ä»£ç ï¼Œåœ¨è°ƒç”¨é¡µé¢ä¸­å¡«å†™è¯·æ±‚å‚æ•°ï¼Œä¾¿å¯è°ƒç”¨ OpenAPI ã€‚

- æŸ¥çœ‹ OpenAPI è¯·æ±‚

  æ ¹æ®æ‚¨å¡«å†™çš„è¯·æ±‚å‚æ•°è‡ªåŠ¨ç”Ÿæˆ OpenAPI è¯·æ±‚ï¼Œå¹¶æ‰“å°åˆ°ç½‘é¡µä¸Šï¼Œè®©æ‚¨ç›´è§‚åœ°æŸ¥çœ‹åˆ°çœŸå®å‘é€çš„ OpenAPI è¯·æ±‚ã€‚

- ç»“æ„åŒ–è¾“å‡ºè¿”å›ç»“æœ

  æ ¹æ® OpenAPI è¯·æ±‚ï¼Œè¿”å›çœŸå®çš„ OpenAPI è°ƒç”¨ç»“æœï¼Œç»“æ„åŒ–è¾“å‡ºã€‚

- ç”Ÿæˆ SDK è°ƒç”¨ç¤ºä¾‹

  æ ¹æ®è¾“å…¥çš„ OpenAPI è¯·æ±‚å‚æ•°ï¼Œè‡ªåŠ¨ç”Ÿæˆå¤šç§è¯­è¨€çš„ SDK è°ƒç”¨ç¤ºä¾‹ã€‚

- å‘½ä»¤è¡Œè°ƒç”¨

  æä¾›ç½‘é¡µç‰ˆå‘½ä»¤è¡Œå·¥å…·ï¼Œæ¨¡æ‹Ÿ Linux æ“ä½œä½“éªŒä½¿ç”¨å‘½ä»¤è¡Œè°ƒç”¨ OpenAPI ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/6c3ebf00103vd.svg)

OpenAPI é—¨æˆ·è¦æ±‚å¼€å‘è€…å¿…é¡»ç™»å½•ï¼Œé€šè¿‡ç”¨æˆ·ç™»å½•èº«ä»½ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è·å–å¯ç”¨çš„ AK ä¿¡æ¯ï¼Œè°ƒç”¨ OpenAPI ï¼Œæ— éœ€ç”¨æˆ·åœ¨è°ƒè¯•ç•Œé¢ä¼ å…¥ AK æ•°æ®ï¼Œæå‡ OpenAPI è°ƒè¯•çš„ä¾¿æ·æ€§ã€‚

> 02 ç•Œé¢

ç•Œé¢æ¯”è¾ƒç›¸ä¼¼

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329104518.png)

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329104818.png)

SDKä¹Ÿå¾ˆç±»ä¼¼

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240329200802.png)

### ç¾å›¢

ç¾å›¢éƒ¨åˆ†ä¸»è¦å…³æ³¨å®ƒçš„[SDKè‡ªåŠ¨ç”Ÿæˆ](https://tech.meituan.com/2023/01/05/openplatform-sdk-auto-generate.html)

> #### **01 åº”ç”¨èƒŒæ™¯**

1. é˜…è¯»è…¾è®¯çš„SDKæºç å¯ä»¥çŸ¥é“ï¼Œä¸åŒæ¨¡å—ä¸åŒæ–¹æ³•å†è°ƒç”¨æ—¶å› ä¸ºå‚æ•°ç­‰ä¸åŒï¼Œè™½ç„¶å¹¶ä¸éœ€è¦å®ç°ä¸šåŠ¡åŠŸèƒ½ï¼Œä½†ä¹Ÿå¾ˆéš¾ç”¨é€šç”¨çš„é€»è¾‘æ¥å®ç°ï¼Œè¿˜æ˜¯éœ€è¦ä¸€ä¸ªæ¥å£æœ‰å¯¹åº”SDKï¼Œè¿™éœ€è¦äººå·¥å¼€å‘ååˆ†éº»çƒ¦ã€‚

2. ä»¥ç¾å›¢ä¸ºä¾‹ï¼Œç¾å›¢å¼€æ”¾å¹³å°å°†ç¾å›¢å„ç±»ä¸šåŠ¡æä¾›çš„æ‰©å±•æœåŠ¡å°è£…æˆä¸€ç³»åˆ—åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰å¯¹å¤–å¼€æ”¾ï¼Œä¾›ç¬¬ä¸‰æ–¹å¼€å‘è€…ä½¿ç”¨ã€‚å¼€å‘è€…å¯é€šè¿‡è°ƒç”¨å¼€æ”¾å¹³å°æä¾›çš„OpenAPIè·å–æ•°æ®å’Œèƒ½åŠ›ï¼Œä»¥å®ç°è‡ªèº«ç³»ç»Ÿä¸ç¾å›¢ç³»ç»ŸååŒå·¥ä½œçš„ä¸šåŠ¡é€»è¾‘ã€‚ä»¥å¤–å–ä¸šåŠ¡åœºæ™¯ä¸ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è‡ªå·±ä¸ºå¤–å–å•†æˆ·å¼€å‘çš„åº”ç”¨ä¸­é€šè¿‡è°ƒç”¨ç¾å›¢å¼€æ”¾å¹³å°æä¾›çš„APIï¼Œæä¾›å¤–å–è®¢å•æŸ¥è¯¢ã€æ¥å•ã€è®¢å•ç®¡ç†ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://github.com/polarisronx/Papi-backend/doc/images/42fc2d55ccbed47e618eb1f16a94a5e7121354.png)

3. ç¾å›¢å¼€æ”¾å¹³å°æä¾›ç»™å¼€å‘è€…çš„**æ¥å£å¥‘çº¦è¾ƒä¸ºå¤æ‚**ï¼Œå…¶ä¸­åŒ…å«äº†ä¸šåŠ¡è§„åˆ™å¤æ‚åŠå®‰å…¨æ€§è¦æ±‚é«˜ç­‰åŸå› ã€‚è‹¥**å¼€å‘è€…éœ€è¦ç›´æ¥ä»0åˆ°1ç¼–ç å¯¹æ¥å¹³å°æä¾›çš„HTTP APIï¼Œéœ€è¦å…³æ³¨é€šä¿¡åè®®ã€æ¥å£å¥‘çº¦è§„èŒƒã€è®¤è¯æ ‡è¯†ä¼ é€’å’Œå®‰å…¨ç­¾åç­‰ç»†èŠ‚ï¼Œæˆæœ¬è¾ƒé«˜**ã€‚éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¹³å°æ”¯æŒçš„OpenAPIæ•°é‡åœ¨è¿‘ä¸¤å¹´å¢é•¿çº¦ä¸€å€ï¼Œè¾¾åˆ°è¿‘1000ä¸ªï¼Œå¹³å°è¿è¥å’Œç ”å‘äººå‘˜éœ€è¦æŠ•å…¥è¶Šæ¥è¶Šå¤šçš„ç²¾åŠ›å»å¸®åŠ©å¼€å‘è€…è§£å†³æ¥å£å¯¹æ¥è¿‡ç¨‹ä¸­çš„ç–‘éš¾é—®é¢˜ã€‚å› æ­¤ï¼Œæä¾›SDKä»¥å¸®åŠ©å¼€å‘è€…æé«˜å¼€å‘å¯¹æ¥æ•ˆç‡ï¼Œå˜å¾—ååˆ†æœ‰å¿…è¦ã€‚

> #### **02 SDK æ¶æ„**

SDKï¼Œè‹±æ–‡åç§°ä¸º Software Development Kitï¼Œå³è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œå¹¿ä¹‰ä¸ŠæŒ‡è¾…åŠ©å¼€å‘æŸä¸€ç±»è½¯ä»¶çš„ç›¸å…³å·¥å…·ã€æ–‡æ¡£å’ŒèŒƒä¾‹çš„é›†åˆã€‚åœ¨å¼€æ”¾å¹³å°çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä¸ºå¼€å‘è€…æä¾›çš„SDKåº”èƒ½ä¸ºå…¶å±è”½è°ƒç”¨OpenAPIçš„**é€šä¿¡åè®®ã€å‚æ•°ä¼ é€’è§„èŒƒã€æ¥å£åŸºç¡€å¥‘çº¦ï¼ˆå¦‚æ—¶é—´æˆ³ã€å®‰å…¨ç­¾åï¼‰**ç­‰ç»†èŠ‚ï¼Œä»¥é™ä½å…¶å¯¹æ¥å¹³å°APIæ‰€éœ€çš„å¼€å‘æˆæœ¬ã€‚å…·å¤‡åŸºæœ¬åŠŸèƒ½çš„å¼€æ”¾å¹³å°SDKçš„æ¶æ„å’ŒåŠŸèƒ½æ¨¡å—å¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://github.com/polarisronx/Papi-backend/doc/images/a68a0c26f4d404ed8b2745f4ad21687f193061.png)

> #### **03 SDKè®¾è®¡ç›®æ ‡**

1. **é€šä¿¡åè®®å°è£…**ï¼ˆä¸€æ¬¡æ€§å·¥ä½œï¼‰ï¼šè®©å¼€å‘è€…æ— éœ€å…³æ³¨è°ƒç”¨APIçš„é€šä¿¡åè®®å’Œé€šä¿¡é€»è¾‘ã€‚
2. **æ¥å£åŸºç¡€å¥‘çº¦å°è£…**ï¼ˆä¸€æ¬¡æ€§å·¥ä½œï¼‰ï¼šè®©å¼€å‘è€…æ— éœ€å…³æ³¨è°ƒç”¨APIçš„å‚æ•°ä¼ é€’æ ¼å¼ã€æ—¶é—´æˆ³ã€å®‰å…¨ç­¾åã€è¿”å›Codeç å¤„ç†ç­‰ç»†èŠ‚ã€‚
3. **è¯·æ±‚å‚æ•°æ¨¡å‹å°è£…**ï¼šè®©å¼€å‘è€…ä¾¿æ·åœ°è®¾ç½®APIè¯·æ±‚å‚æ•°ã€‚
4. **è¿”å›å‚æ•°æ¨¡å‹å°è£…**ï¼šè®©å¼€å‘è€…ä¾¿æ·åœ°ä½¿ç”¨APIè¿”å›çš„æ•°æ®ã€‚

**<font color='red'>SDKè‡ªåŠ¨ç”Ÿæˆå·¥å…·çš„ä¸»è¦ç›®æ ‡ --> ç”Ÿæˆå‚æ•°å¯Œæ¨¡å‹ï¼ˆ3ã€4ï¼‰</font>**

è‡ªåŠ¨ç”Ÿæˆä¾›SDKä½¿ç”¨çš„è¯·æ±‚å‚æ•°æ¨¡å‹ä»£ç ï¼ˆRequestç±»ï¼‰ã€è¿”å›å‚æ•°æ¨¡å‹ä»£ç ï¼ˆResponseç±»ï¼‰å’Œè°ƒç”¨ç¤ºä¾‹ä»£ç ï¼ˆExampleï¼‰ï¼Œå¹¶ä¸”ä»£ç è‡ªåŠ¨ç”Ÿæˆæœºåˆ¶è¦æ”¯æŒSDKé€‚é…çš„å¤šç§ç¼–ç¨‹è¯­è¨€ã€‚

- **ä¸»è¦å·¥ä½œ**

è¯·æ±‚å‚æ•°æ¨¡å‹ï¼ˆRequestç±»ï¼‰ï¼šéœ€è¦ç”ŸæˆRequest Pathã€é‰´æƒé…ç½®ã€å­—æ®µå¼ºç±»å‹å®šä¹‰ã€å­—æ®µå–å€¼ã€èµ‹å€¼åŠæ ¡éªŒé€»è¾‘ç­‰ä»£ç ã€‚

è¿”å›å‚æ•°æ¨¡å‹ï¼ˆResponseç±»ï¼‰ï¼šéœ€è¦ç”Ÿæˆæ¥å£è¿”å›çš„å„ä¸ªæ•°æ®å­—æ®µçš„å¼ºç±»å‹å®šä¹‰ã€å–å€¼é€»è¾‘åŠæ ¡éªŒè§„åˆ™ã€‚è°ƒç”¨ç¤ºä¾‹ä»£ç åˆ™éœ€è¦åŒ…å«è¯·æ±‚å‚æ•°èµ‹å€¼ã€å‘èµ·æ¥å£è°ƒç”¨å’Œå¤„ç†æ¥å£è¿”å›æ•°æ®ç­‰ç›¸å…³é€»è¾‘ã€‚

> #### **04 è®¾è®¡æ–¹æ³•**

å½“å‰ä¸»è¦çš„ä»£ç è‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æœ‰ï¼š

1. **åŸºäºæ¨¡ç‰ˆç¼–æ’ç”Ÿæˆä»£ç **ï¼šæœ€åŸå§‹æœ€ç®€å•ä¹Ÿæ˜¯ç›®å‰åº”ç”¨æœ€å¹¿æ³›çš„ä¸€ç§ä»£ç ç”Ÿæˆæ–¹å¼ã€‚åŒ…æ‹¬åç«¯MVCæ¡†æ¶çš„Controllerã€Serviceã€DAOå±‚æ¨¡å¼åŒ–ä»£ç ä¸€é”®ç”Ÿæˆï¼ˆ**<font color='red'>MybatisPlus</font>**ï¼‰ï¼Œè¿˜æœ‰å‰ç«¯Vue CLI å’ŒCreate-React-Appä¸¤æ¬¾è„šæ‰‹æ¶çš„ä»£ç ç”Ÿæˆï¼Œéƒ½å±äºæ­¤ç±»ã€‚
2. **åŸºäºå¯è§†åŒ–UIç”Ÿæˆä»£ç **ï¼šç›®å‰å¸‚åœºä¸Šè¿ç”¨å¾—å¾ˆå¹¿çš„ä¸€é—¨æŠ€æœ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºä»£ç å¯è§†åŒ–ç”Ÿæˆå·¥å…·ã€‚ä»Eclipseçš„Webå¯è§†åŒ–ç¼–è¾‘å™¨ï¼Œåˆ°.NET Frameworkæä¾›çš„MVCï¼ŒåŠWinformç•Œé¢åŠ**<font color='red'>æ§ä»¶ä»£ç å¯è§†åŒ–æ‹–æ‹½ç”Ÿæˆ</font>**ï¼Œåˆ°æ±½è½¦è¡Œä¸šå¹¿æ³›ä½¿ç”¨çš„å¯è§†åŒ–åŸå‹æ­å»ºå·¥å…·ï¼ˆè‡ªåŠ¨ç”ŸæˆCä»£ç ï¼‰éƒ½å±äºæ­¤ç±»ã€‚åœ¨è¿‘å‡ å¹´æ¯”è¾ƒç«çš„ä½ä»£ç å¹³å°ï¼ˆå¦‚aPaaSï¼‰ä¸­ï¼Œé€šè¿‡å¯è§†åŒ–UIç”Ÿæˆä»£ç çš„æŠ€æœ¯ä¹Ÿè¢«å¤§é‡ä½¿ç”¨ã€‚
3. **åŸºäºä»£ç è¯­æ–™ç”Ÿæˆä»£ç **ï¼šåŸºäºä»£ç è¯­æ–™ç”Ÿäº§ä»£ç çš„å‰ææ˜¯è¦æœ‰è¶³å¤Ÿçš„è¯­æ–™ï¼Œä¾‹å¦‚ä¼ªä»£ç /ä¸­é—´è¯­è¨€/æè¿°æ€§ä»£ç æ¨¡æ¿ï¼Œå†åŸºäºä¸€å¥—ç”Ÿæˆè§„åˆ™å»ç”Ÿæˆç›®æ ‡ä»£ç ã€‚å¸¸è§çš„è½åœ°åœºæ™¯åŒ…æ‹¬**<font color='red'>RPCæ¡†æ¶ä¸­åŸºäºIDL</font>**ï¼ˆInterface description languageï¼Œæ¥å£æè¿°è¯­è¨€ï¼‰è‡ªåŠ¨ç”Ÿæˆå¤šç§ç¼–ç¨‹è¯­è¨€çš„RPC Clientå’ŒServiceä»£ç ï¼ˆ**Dubbo**ï¼‰ï¼Œä»¥åŠIDEæ’ä»¶ä¸­çš„ä»£ç è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ï¼ˆä¾‹å¦‚Eclipseçš„[telosys](https://marketplace.eclipse.org/content/telosys-tools)æ’ä»¶å¯é€šè¿‡DSLç”Ÿæˆå¤šç§è¯­è¨€ä»£ç ï¼‰ã€‚
4. **åŸºäºäººå·¥æ™ºèƒ½æŠ€æœ¯ç”Ÿæˆä»£ç **ï¼šå±äºæ¯”è¾ƒå‰æ²¿çš„æŠ€æœ¯èŒƒç•´ï¼Œå¤šå’ŒAIé¢†åŸŸçš„å›¾åƒè¯†åˆ«å’Œæœºå™¨å­¦ä¹ æŠ€æœ¯ç»“åˆã€‚ç°æœ‰çš„ä¸€äº›å…¸å‹æ¡ˆä¾‹åŒ…æ‹¬ï¼šå¾®è½¯å¼€å‘çš„å¯å°†æ‰‹ç»˜å›¾è½¬åŒ–HTMLä»£ç çš„æ™ºèƒ½åŒ–ä»£ç ç”Ÿæˆå·¥å…·[sketch2code](https://www.microsoft.com/en-us/ai/ai-lab-sketch2code)ï¼ŒåŸºäºAIæŠ€æœ¯è‡ªåŠ¨ç”ŸæˆUIé€»è¾‘çš„[teleporthq](https://github.com/teleporthq)ã€‚

ç”±äºéœ€è¦è‡ªåŠ¨ç”Ÿæˆçš„OpenAPIå‚æ•°å¯Œæ¨¡å‹ä»£ç å’Œè°ƒç”¨ç¤ºä¾‹ä»£ç å‡å…·å¤‡ç›¸å¯¹è¾ƒå¼ºçš„**è§„åˆ™æ€§å’Œæ¨¡å¼æ€§**ï¼Œé‡‡ç”¨ **ä»£ç è¯­æ–™** ç”Ÿæˆã€‚åŸºäºä»£ç è¯­æ–™è‡ªåŠ¨ç”Ÿæˆä»£ç éœ€è¦â€œ**è¯­æ–™**â€+â€œ**è§„åˆ™**â€ä¸¤ä¸ªæ ¸å¿ƒå…ƒç´ ï¼Œéœ€è¦ï¼š

1. é€šè¿‡è§£æAPIå…ƒæ•°æ®å¹¶ç»“åˆé¢†åŸŸä¸“ç”¨è¯­è¨€ï¼ˆDSLï¼‰ä½œä¸ºè¯­æ–™æ¨¡æ¿ï¼Œç”Ÿæˆä»£ç è¯­æ–™ï¼›

2. åŸºäºè¯­æ–™ç‰¹æ€§ä¸ºä¸åŒçš„ç¼–ç¨‹è¯­è¨€å®šåˆ¶ä»£ç ç”Ÿæˆè§„åˆ™ï¼›

3. æœ€ç»ˆå°†â€œè¯­æ–™â€+â€œè§„åˆ™â€è¾“å…¥ä»£ç ç”Ÿæˆå™¨ä»¥å®Œæˆç›®æ ‡ä»£ç çš„ç”Ÿæˆã€‚

   æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

   <img src="https://github.com/polarisronx/Papi-backend/doc/images/d98ed501c083ca9b5207c4c052b3abcc340972.png" style="zoom: 50%;" />

> #### **05 APIå…ƒæ•°æ®**

**APIå…ƒæ•°æ®æ˜¯ä»£ç è¯­æ–™ç”Ÿæˆçš„æ•°æ®æº**ï¼Œå…¶æ¥æºäºå¼€æ”¾å¹³å°å®ç°çš„é›¶ç¼–ç APIç½‘å…³åº•å±‚ç»´æŠ¤çš„åŸºç¡€é…ç½®ã€‚å¼€æ”¾å¹³å°ç½‘å…³åŸºäºAPIå…ƒæ•°æ®é…ç½®åŒ–çš„æŠ€æœ¯ï¼Œå¯åšåˆ°é›¶ç¼–ç å°†ä¸šåŠ¡æœåŠ¡çš„RPCæ¥å£è½¬åŒ–ä¸ºHTTPåè®®çš„APIè¿›è¡Œå¼€æ”¾ã€‚å…¶åŸºæœ¬è¿è¡Œç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://github.com/polarisronx/Papi-backend/doc/images/49245d3c18d8f755dbefdc6478f689bf230136.png)

APIå…ƒæ•°æ®ä¸­åŒ…å«äº†**<font color='red'>HTTP Methodã€URLã€è¯·æ±‚å‚æ•°ã€è¿”å›å‚æ•°ç­‰</font>**ä¿¡æ¯ã€‚åœ¨å‚æ•°ä¿¡æ¯ä¸­ï¼Œåˆä»¥æ ‘å½¢ç»“æ„è®°å½•äº†**æ¯ä¸ªå‚æ•°å­—æ®µçš„å­—æ®µåã€å­—æ®µç±»å‹ã€å­—æ®µæè¿°ã€æ ¡éªŒè§„åˆ™å’Œç¤ºä¾‹å€¼**ï¼Œæœ‰äº†è¿™äº›ä¿¡æ¯å°±èƒ½å¤Ÿæ”¯æ’‘æˆ‘ä»¬ä¸ºSDKç”Ÿæˆå‚æ•°å¯Œæ¨¡å‹å’Œè°ƒç”¨ç¤ºä¾‹ä»£ç ã€‚ä¾‹å¦‚â€œæŒ‰è®¢å•idæŸ¥è¯¢è®¢å•è¯¦æƒ…â€ï¼Œå…¶å…ƒæ•°æ®ä¸­å’ŒSDKç”Ÿæˆç›¸å…³çš„æ•°æ®å¦‚ä¸‹æ‰€ç¤ºï¼š

```properties
APIGroup:waimai
APISubGroup:order
APIName: order_query_by_id
HTTP METHOD: POST
HTTP PATH: /api/order/queryById
Description: æŒ‰è®¢å•idæŸ¥è¯¢è®¢å•è¯¦æƒ…
Request
  |- orderId LONG NOT_NULL è¦æŸ¥è¯¢çš„è®¢å•çš„id example:1000224201796844308
Response
  |- orderId  LONG NOT_NULL è®¢å•id  example:1000224201796844308
  |- price  LONG NOT_NULL è®¢å•é‡‘é¢ï¼ˆå•ä½ä¸ºäººæ°‘å¸â€œåˆ†â€ï¼‰ example:3308
  |- phone  STRING  é¡¾å®¢è”ç³»ç”µè¯   example:"13000000002"
  |- products  ARRAY<Product>  è®¢å•å•†å“åˆ—è¡¨
     |- pid  LONG  å•†å“id   example:"13000000002"
     |- name  String  å•†å“å  example:"çç å¥¶èŒ¶"
     |- num  INTEGER  å•†å“æ•°é‡  example:1
     |- price  LONG  å•†å“å•ä»·   example:1199
     |- properties  ARRAY<Property>  å•†å“å±æ€§åˆ—è¡¨
        |- name STRING å•†å“å±æ€§å  example:"ç”œåº¦"
        |- value STRING å•†å“å±æ€§å€¼  example:"ä¸ƒåˆ†ç³–"
     |- remark  STRING  å•†å“å¤‡æ³¨  example:"è¯·åšå¸¸æ¸©çš„"
  |- status  INTEGER  è®¢å•çŠ¶æ€  example:7
```

æ¥ä¸‹æ¥åªè¦æœ‰è§„èŒƒçš„æ•°æ®è®°å½•æ ¼å¼å’Œè¯»å–æ–¹å¼ï¼Œå°±èƒ½å¤Ÿç”Ÿæˆå¯¹åº”çš„ä»£ç 

> #### 06 ä»£ç è¯­æ–™

**ä»£ç è¯­æ–™å¯ä»¥ç†è§£ä¸ºç¬¦åˆç¼–ç¨‹æ€æƒ³ï¼Œèƒ½è®©æœºå™¨ç«‹å³å’Œå®ç°çš„ä»£ç åŸæ–™ï¼Œèƒ½å¤Ÿè®©è¯­è¨€è½¬æ¢å¼•æ“ç›´æ¥ç¿»è¯‘ä¸ºä»£ç ã€‚**ä¸åŒè¯­è¨€çš„è¯­æ–™ç•¥æœ‰ä¸åŒï¼Œä»¥ç”ŸæˆJava SDKä¸­çš„å‚æ•°å¯Œæ¨¡å‹ä»£ç ä¸ºä¾‹ï¼Œéœ€è¦ç”¨åˆ°çš„ä»£ç è¯­æ–™åŒ…å«ä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†ä¸º**ç±»çš„åŸºæœ¬ä¿¡æ¯**ï¼Œç”±å…ƒæ•°æ®è§£æå™¨åœ¨è§£æAPIçš„å…ƒæ•°æ®æ—¶ç”Ÿæˆï¼Œå…¶åŒ…å«çš„å†…å®¹å’Œå…·ä½“ç”Ÿæˆæ–¹å¼å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

![](https://github.com/polarisronx/Papi-backend/doc/images/e2d3a67d186f36e9c5b24e47b056e2cb504544.png)

ç¬¬äºŒéƒ¨åˆ†ä¸º**è¯­æ–™æ¨¡æ¿**ï¼Œæˆ‘ä»¬ä»¥DSLï¼ˆDomain Specific Languageï¼‰ä½œä¸ºä¸­é—´è¯­è¨€åŠ ä»¥æè¿°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```xml
<@class className=className metaInfo=javaApiMeta baseClass=baseClass interfaces=interfaces classDesc=classDesc package=packageName importPackages=importPackages>
    <#-- é™æ€å­—æ®µ   -->
    <#if staticFields?? && (staticFields?size > 0) >
        <#list staticFields as param>
            <@staticField param=param/>
        </#list>
    </#if>
    <#-- å­—æ®µ   -->
    <#if privateFields?? && (privateFields?size > 0) >
        <#list privateFields as param>
            <@field param=param/>
        </#list>
    </#if>
   <#-- Getter/Setter -->
    <#if privateFields?? && (privateFields?size > 0) >
        <#list privateFields as param>
            <@getterMethod param=param/>
            <@setterMethod param=param/>
        </#list>
    </#if>
    
    <#-- é™æ€å­—æ®µGetter -->
    <#if staticFields?? && (staticFields?size > 0) >
        <#list staticFields as param>
            <@getterMethod param=param/>
        </#list>
    </#if>

    <#if javaApiMeta?has_content>
        <@deserializeResponse metaInfo=javaApiMeta/>
        <@serializeToJson metaInfo=javaApiMeta/>
    </#if>

    <#-- toStringæ–¹æ³• -->
    <#if privateFields?? && (privateFields?size > 0) >
        <@toString className=className params=privateFields/>
    </#if>
</@class>
```

> #### 07 è¯­è¨€è½¬æ¢å¼•æ“

**å°†è§£æå¥½çš„APIå…ƒæ•°æ®ä½œä¸ºè¾“å…¥æœ‰äº†ä¸Šè¿°çš„ä»£ç è¯­æ–™ï¼Œæ‰§è¡ŒåŸºäºDSLçš„è¯­è¨€è½¬æ¢å¼•æ“ï¼Œå³å¯ç”ŸæˆJavaä»£ç ã€‚**

è¯­è¨€è½¬æ¢å¼•æ“é€šè¿‡æ‰§è¡Œ**<font color='red'>å®å‘½ä»¤</font>å°†è¦ç”Ÿæˆçš„ä»£ç ç±»çš„åŸºæœ¬ä¿¡æ¯åœ¨DSLè¯­æ–™æ¨¡æ¿ä¸­è¿›è¡Œå¡«å……ï¼Œæœ€ç»ˆå¾—åˆ°Javaç¼–ç¨‹è¯­è¨€çš„ç›®æ ‡ç±»åŠå…¶é™„å±ç±»çš„ä»£ç **ã€‚

ä»¥ç”ŸæˆResponseç±»ä»£ç ä¸ºä¾‹ï¼Œä»£ç ç”Ÿæˆçš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://github.com/polarisronx/Papi-backend/doc/images/723c582613c49822aeb8f8a6279f7e59636801.png)

Requestå’ŒResponseç±»ä¸­å…¶ä½™çš„`getter`æ–¹æ³•ã€`setter`æ–¹æ³•ã€ç±»æ³¨è§£ç­‰å…ƒç´ çš„ç”ŸæˆåŸç†å’Œæ­¥éª¤å‡å’Œä»¥ä¸Šç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚åœ¨DSLè¯­æ–™æ¨¡æ¿ä¸­æ‰€æœ‰çš„å…ƒç´ å¤„ç†å®Œæˆåï¼Œæˆ‘ä»¬å³å¯å¾—åˆ°ä¾›Javaç¼–ç¨‹è¯­è¨€ä½¿ç”¨çš„è¯·æ±‚å‚æ•°ç±»å’Œè¿”å›å‚æ•°ç±»çš„å®Œæ•´ä»£ç ã€‚

å¯¹äºå…¶ä»–çš„ç¼–ç¨‹è¯­è¨€ï¼ˆä¾‹å¦‚Pythonï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„APIå…ƒæ•°æ®å’Œå…ƒæ•°æ®è§£æé€»è¾‘å’ŒJavaæ˜¯ä¸€è‡´çš„ï¼Œä¸åŒç‚¹åœ¨äºDSLè¯­æ–™æ¨¡æ¿å’Œè¯­è¨€è½¬æ¢å¼•æ“ã€‚å½“éœ€è¦å¯¹SDKæ–°å¢ä¸€ç§ç¼–ç¨‹è¯­è¨€çš„æ”¯æŒæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹ç›®æ ‡è¯­è¨€å»ºç«‹DSLè¯­æ–™æ¨¡æ¿å¹¶æä¾›ç›¸åº”çš„è½¬æ¢é€»è¾‘ï¼Œå³å¯æ”¯æŒè¯¥è¯­è¨€çš„è¯·æ±‚å‚æ•°ç±»å’Œè¿”å›å‚æ•°ç±»çš„ä»£ç è‡ªåŠ¨ç”Ÿæˆã€‚

> #### 08 è‡ªåŠ¨ç”ŸæˆAPIè°ƒç”¨ç¤ºä¾‹ä»£ç 

APIè°ƒç”¨ç¤ºä¾‹ä»£ç å¯ä»¥ä¸ºå¼€å‘è€…å‘ˆç°å‡ºæ¯ä¸ªè¯·æ±‚å‚æ•°èµ‹å€¼çš„ç¤ºä¾‹é€»è¾‘ï¼Œå¯æœ‰æ•ˆé™ä½å¼€å‘è€…åœ¨å¯¹æ¥APIæ—¶çš„ç†è§£æˆæœ¬ã€‚åç»­æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–DSLè¯­æ–™æ¨¡æ¿ï¼Œåœ¨ç¤ºä¾‹ä»£ç ä¸­å¢åŠ å¯¹è¿”å›æ•°æ®ç»“æ„ä¸­å„ä¸ªå­—æ®µçš„å–å€¼é€»è¾‘ç¤ºèŒƒï¼Œä»¥è¿›ä¸€æ­¥é™ä½å¼€å‘è€…åœ¨å¤„ç†APIè¿”å›æ•°æ®æ—¶çš„ç†è§£å’Œå¼€å‘æˆæœ¬ã€‚

é€šè¿‡åŒæ ·çš„æŠ€æœ¯æ‰‹æ®µï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ¯ä¸ªOpenAPIçš„è°ƒç”¨ç¤ºä¾‹ä»£ç ï¼Œå¹¶å°†ç¤ºä¾‹ä»£ç å±•ç¤ºæ¥å£æ–‡æ¡£ä¸­ä¾›å¼€å‘è€…å‚è€ƒã€‚ä¸»è¦æ“ä½œæœ‰ï¼š

1. ä½¿ç”¨APIå…ƒæ•°æ®ä¸­çš„ç±»åå’Œå­—æ®µä¿¡æ¯ï¼ˆå…ƒæ•°æ®ä¸­ä¹ŸåŒ…å«äº†æ¯ä¸ªå­—æ®µçš„examleå€¼ï¼Œå¯ç”¨äºåœ¨ä»£ç ç¤ºä¾‹ä¸­ç”Ÿæˆå­—æ®µèµ‹å€¼çš„é€»è¾‘ï¼‰å¡«å…¥ä»£ç è¯­æ–™ä¸­

2. ç„¶åæ‰§è¡Œè¯­è¨€è½¬æ¢å¼•æ“ç”Ÿæˆç›®æ ‡ä»£ç å³å¯ã€‚

   Javaç¼–ç¨‹è¯­è¨€ä¸ºä¾‹ï¼Œç”¨äºç”ŸæˆAPIè°ƒç”¨ç¤ºä¾‹ä»£ç çš„**DSLè¯­æ–™æ¨¡æ¿**å¦‚ä¸‹æ‰€ç¤ºï¼š

   ```xml
   <#setting number_format="computer">
   MeituanClient meituanClient = DefaultMeituanClient.builder(10000L, "xxxxx").build();
   
   <#assign reqVarName = className?uncap_first/>
   ${className} ${reqVarName} = new ${className}();
   
   <#if privateFields?? && (privateFields?size > 0)>
   <#list privateFields as field>
   ${reqVarName}.set${field.fieldName?cap_first}(${field.exampleValue!""});
   </#list>
   </#if>
   
   <#if javaApiMeta.needAuth>
   String appAuthToken = "xxxx";
   MeituanResponse<${javaApiMeta.responseClass}> response = meituanClient.invokeApi(request, appAuthToken);
   <#else >
   MeituanResponse<${javaApiMeta.responseClass}> response = meituanClient.invokeApi(request);
   </#if>
   
   if (response.isSuccess()) {
   <#if javaApiMeta.responseClass == "Void">
       System.out.println("è°ƒç”¨æˆåŠŸ");
   <#else>
       ${javaApiMeta.responseClass} resp = response.getData();
       System.out.println(resp);
   </#if>
   } else {
       System.out.println("è°ƒç”¨å¤±è´¥");
   }
   ```

   åœ¨ä½¿ç”¨APIå…ƒæ•°æ®å’Œä»£ç è¯­æ–™æ¨¡æ¿æ‰§è¡ŒåŸºäºDSLçš„è¯­è¨€è½¬æ¢å¼•æ“åï¼Œç”Ÿæˆçš„APIè°ƒç”¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

   ```java
   MeituanClient client = DefaultMeituanClient.builder(developerId, signKey).build();
   //è®¾ç½®è¯·æ±‚å‚æ•°
   OrderQueryByIdRequest request = new OrderQueryByIdRequest();
   request.setOrderId(1000224201796844308L);
   //è°ƒç”¨æ¥å£
   MeituanResponse<OrderQueryByIdResponse> response = client.invokeApi(req);
   //å¤„ç†æ¥å£è¿”å›
   if(response.isSuccess()) {
     OrderQueryByIdResponse orderResponse = response.getData();
     System.out.println(orderResponse);
   } else {
     System.out.println("è°ƒç”¨å¤±è´¥");
   }
   ```

> #### 09 æŒç»­é›†æˆå’ŒæŒç»­å‘å¸ƒ

ä¼ ç»Ÿç”±äººå·¥ç¼–è¯‘ã€æµ‹è¯•å’Œä¸Šä¼ å‘å¸ƒSDKçš„æ¨¡å¼ï¼Œå¼€å‘è€…å¾—åˆ°SDKç‰ˆæœ¬æ›´æ–°çš„å‘¨æœŸçŸ­åˆ™æ•°å‘¨ï¼Œé•¿åˆ™æ•°æœˆã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†è¿™ä¸ªå‘¨æœŸç¼©çŸ­åˆ°åˆ†é’Ÿçº§åˆ«ï¼š**å½“SDKçš„åŸºç¡€é€»è¾‘å’ŒAPIå‚æ•°æ¨¡å‹æœ‰ä»»ä½•å˜æ›´å‘ç”Ÿæ—¶ï¼Œé€šè¿‡æŒç»­é›†æˆå’ŒæŒç»­å‘å¸ƒçš„èƒ½åŠ›ï¼Œåœ¨æ•°åˆ†é’Ÿå†…å°†åŒ…å«æ­¤å˜æ›´çš„æ–°ç‰ˆæœ¬SDKå‘å¸ƒç»™å¼€å‘è€…ä½¿ç”¨**ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/bf5a87af7adc4bc44249c5f003fba930270816.png)

é¦–å…ˆæˆ‘ä»¬ç›‘å¬å¯èƒ½å¯¼è‡´SDKéœ€è¦å‘å¸ƒçš„å˜æ›´ï¼ŒåŒ…æ‹¬é€šè¿‡Binlogæœºåˆ¶ç›‘å¬APIå…ƒæ•°æ®çš„å˜æ›´ï¼Œä»¥åŠé€šè¿‡Git Hookæœºåˆ¶ç›‘å¬SDKåŸºç¡€é€»è¾‘ä»£ç ä»“åº“Masteråˆ†æ”¯çš„å˜æ›´ã€‚ä¸€æ—¦ç›‘å¬åˆ°æœ‰å˜æ›´äº§ç”Ÿï¼Œé€šè¿‡è§¦å‘å™¨å»è§¦å‘SDKæŒç»­é›†æˆå’Œå‘å¸ƒæµæ°´çº¿çš„è¿ä½œã€‚

æµæ°´çº¿å¼€å§‹è¿ä½œåï¼Œé¦–å…ˆæ‰§è¡ŒSDKæ„å»ºç»„ä»¶ï¼ŒSDKæ„å»ºç»„ä»¶ä¼šå¹¶å‘æ‰§è¡Œä¸¤ä¸ªæ“ä½œï¼š

1. è·å–SDKåŸºç¡€é€»è¾‘ä»£ç ï¼ˆäººå·¥ç¼–å†™ï¼‰å¹¶å®Œæˆé™æ€ä»£ç æ£€æŸ¥ï¼›
2. æ‹‰å–APIå…ƒæ•°æ®å¹¶è‡ªåŠ¨ç”Ÿæˆå‚æ•°å¯Œæ¨¡å‹ä»£ç ã€‚

ä»¥ä¸Šä¸¤ä¸ªæ“ä½œå®Œæˆåï¼Œæ‰§è¡Œä»£ç åˆå¹¶å’Œä»£ç ç¼–è¯‘ï¼Œå°†ç»“æœæäº¤åˆ°æµæ°´çº¿æ‰§è¡Œä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚æ¥ä¸‹æ¥ç”±è‡ªåŠ¨åŒ–æµ‹è¯•ç»„ä»¶å®Œæˆå¯¹SDKçš„å•å…ƒæµ‹è¯•å’Œç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé€šè¿‡åæäº¤åˆ°æµæ°´çº¿æ‰§è¡Œä¸‹ä¸€ä¸ªæ­¥éª¤ã€‚æœ€åç”±è‡ªåŠ¨å‘å¸ƒç»„ä»¶å®ŒæˆSDKçš„æ‰“åŒ…ã€ä¸Šä¼ ã€ä¸‹è½½é“¾æ¥ç”Ÿæˆå’Œç‰ˆæœ¬ä¿¡æ¯ç”Ÿæˆç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œå¹¶æœ€ç»ˆå°†æœ€æ–°ç‰ˆæœ¬SDKå‘å¸ƒåˆ°å®˜ç½‘ä¾›å¼€å‘è€…ä¸‹è½½ã€‚

> ### ç»“è¯­

å¤§å‚è‡ªæœ‰å¤§å‚è‡ªå·±çš„å¥½å¤„ï¼Œç¼–å†™SDKçš„ä¸€æ•´å¥—æµç¨‹å‡ ä¹ä¸éœ€è¦äººå·¥å‚ä¸ï¼Œå…¨è‡ªåŠ¨åˆ†é’Ÿçº§çš„é«˜æ•ˆå®ŒæˆSDKçš„å‘å¸ƒå’Œå˜æ›´ã€‚







## æ‹“å±•1ï¼šSDKä¼˜åŒ–

> #### è®°å½•é‡åˆ°çš„é—®é¢˜

1. headerè¯·æ±‚å¤´ä¸èƒ½æœ‰æ¢è¡Œ \n

2. v3ç‰ˆæœ¬æ„å»ºè§„èŒƒè¯·æ±‚

[è‡ªç ”è¯·æ±‚ä½“å’Œç­¾åæœºåˆ¶_é˜¿é‡Œäº‘SDK(Alibaba Cloud SDK)-é˜¿é‡Œäº‘å¸®åŠ©ä¸­å¿ƒ (aliyun.com)](https://help.aliyun.com/zh/sdk/product-overview/v3-request-structure-and-signature?spm=a2c4g.11186623.0.0.446746bcU0vmxH#section-mqj-l8f-ak0)

3. æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼šåœ¨backendä¸­å…ˆç”¨é€šç”¨è¯·æ±‚ç±»commonRequestæŠŠå‚æ•°å…ˆä¼ è¿›æ¥ï¼Œæ ¹æ®åå°„æ ¹æ®actionåœ¨å®¢æˆ·ç«¯æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œåœ¨å®¢æˆ·ç«¯çš„æ–¹æ³•ä¸­newå¯¹åº”çš„Requestï¼ŒæŠŠå‚æ•°æ’å…¥ï¼Œåœ¨å®¢æˆ·ç«¯æ¥æ”¶å“åº”æ—¶æ ¹æ®ç”±Requestçš„getResponseClassæ–¹æ³•å¾—åˆ°å¯¹åº”çš„å“åº”å°è£…ç±»ã€‚ä½†æ˜¯åœ¨backendç«¯åªèƒ½ç”¨é€šç”¨çš„å“åº”ç±»æ¥æ”¶ã€‚

   åœ¨SDKå¯ä»¥æ ¹æ®æ¥å£çš„ä¸åŒä¸ªæ€§åŒ–åœ°é€‰æ‹©æŒ‡å®šçš„Requestå’ŒResponseï¼Œçµæ´»åœ°è®¾ç½®è¯·æ±‚å‚æ•°å’Œå“åº”å‚æ•°ï¼Œè€Œbackendç«¯è°ƒè¯•ä¾èµ–äºé€šç”¨çš„mapåšä¸ºæ•°æ®çš„è½½ä½“ã€‚

4. gatewayä¸­Postè¯·æ±‚è·å–ä¸åˆ°queryParams

5. åœ¨è§„èŒƒè¯·æ±‚ä¸­ host æ”¾å…¥çš„æ˜¯æœåŠ¡ç»ˆç«¯endpointï¼Œè€Œåœ¨åé¢ç½‘å…³ä¸­ hostå·²ç»è¢«ä¿®æ”¹ä¸ºäº† ç½‘å…³çš„åœ°å€ï¼Œå¯ä»¥æŠŠendpointæ”¾è¯·æ±‚å¤´ä¼ è¿‡æ¥ï¼Œä½†æ˜¯è¿™æ ·å°±å¯¹å¤–æš´éœ²äº†æ¥å£çš„æœåŠ¡ç»ˆç«¯ï¼Œè§£å†³åŠæ³•æ˜¯æ ¹æ®pathå’ŒmethodæŸ¥æ•°æ®åº“æ‰¾åˆ°æ¥å£å¯¹åº”çš„endpoint ã€‚

   ![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240409191959.png)



> #### papiæ¥å£ä¸Šä¼ è§„èŒƒ

æœ€åæ›´æ–°æ—¥æœŸ 2024.05.29

> æ¥å£ä¿¡æ¯å¡«å†™

|                 | æè¿°                                     | å¤‡æ³¨             | ç¤ºä¾‹                 |
| --------------- | ---------------------------------------- | ---------------- | -------------------- |
| æ¥å£åç§°        | å…·æœ‰è¾¨è¯†åº¦çš„å¸…æ°”åå­—                     |                  | éšä½ å–œæ¬¢             |
| æè¿°            | ä¸€å¥è¯æŒ‘æ˜ä½ çš„æ¥æ„                       |                  | è¨€ç®€æ„èµ…             |
| æœåŠ¡ç»ˆç«¯        | æ¥å£éƒ¨ç½²æ‰€åœ¨çš„æœåŠ¡å™¨ç»ˆç«¯IPåœ°å€+ç«¯å£å·    | ip_address+port  | localhost:1234       |
| æ¥å£è·¯å¾„*       | æ¥å£controllerè·¯å¾„                       | /api/*/${action} | /api/a/getYourHeart  |
| å®šä»·            | æ¥å£è°ƒç”¨éœ€èŠ±è´¹çš„Pé’»ï¼ˆæŒ‰æ¬¡è®°ï¼‰            | number           | 1                    |
| æ“ä½œ*           | æ¥å£æ‰§è¡Œçš„æ“ä½œ                           | action           | getYourHeart         |
| è¯·æ±‚å‚æ•°*       | æ¥å£è¯·æ±‚å‚æ•°                             | Jsonæ ¼å¼         | -                    |
| å“åº”å‚æ•°*       | æ¥å£å“åº”å‚æ•°                             | Jsonæ ¼å¼         | -                    |
| è¯·æ±‚å‚æ•°å°è£…ç±»* | åŒ…å«æ¥å£è¯·æ±‚æ‰€æœ‰å‚æ•°çš„å°è£…ç±»             |                  | GetYourHeartRequest  |
| å“åº”å‚æ•°å°è£…ç±»* | åŒ…å«æ¥å£å“åº”æ‰€æœ‰å‚æ•°çš„å°è£…ç±»             |                  | GetYourHeartResponse |
| æ¥å£æ’å›¾        | æ¥å£ä¹Ÿéœ€è¦çš„æ¼‚äº®å¤´åƒ                     | url              | https://abc/1.jpg    |
| æ¥å£ç±»å‹        | æŒ‰è¿”å›æ•°æ®åˆ†æ–‡å­—ç±»ã€å›¾ç‰‡ç±»ã€æ–‡ä»¶ç±»å’Œå…¶ä»– | é»˜è®¤æ–‡å­—ç±»       | æ–‡å­—ç±»               |
| è¯·æ±‚å‚æ•°ç±»å‹    | æ¥å£è¯·æ±‚å‚æ•°ç±»å‹                         | contentType      | application/json     |
| å“åº”å‚æ•°ç±»å‹    | æ¥å£å“åº”ç±»å‹                             | contentType      | application/json     |
| è¯·æ±‚ç±»å‹        | è¯·æ±‚æ–¹æ³•ç±»å‹                             | Method           | GET                  |

ç‰¹åˆ«è¯´æ˜ï¼š

1. è¯·æ±‚å‚æ•°ç­‰éœ€è¦ä»¥Jsonæ•°æ®æ ¼å¼å¡«å†™ï¼Œå‚ç…§ä»¥ä¸‹æ¨¡æ¿ï¼š

```json
[
  {
    "type": "int",
    "fieldName": "code",
    "desc": "å…¨å±€å“åº”çŠ¶æ€ç "
  },// å¯¹åº”å“åº”å‚æ•°è¯·ä¿ç•™è¯¥å­—æ®µ
  {
    "type": "int",
    "fieldName": "data.code",
    "desc": "å†…éƒ¨å“åº”çŠ¶æ€ç "
  },// å¯¹åº”å“åº”å‚æ•°è¯·ä¿ç•™è¯¥å­—æ®µ
  {
    "type": "String",
    "fieldName": "data.roman",
    "required": "true",
    "desc": "ç½—é©¬æ•°"
  }
]
```

2. æˆ‘ä»¬æ¨èä¸ºæ¯ä¸ªæ¥å¤´æä¾›ä¸€ä¸ªä¸“å±çš„è¯·æ±‚å‚æ•°å°è£…ç±»å’Œå“åº”å‚æ•°å°è£…ç±»ï¼Œå½¢å¦‚

```java
@GetMapping("/romanToInt")
public RomanToIntResponse romanToInt(@RequestParam String roman){
    return new RomanToIntResponse(romanNumeralsService.romanToInt(roman));
}
```

3. æ“ä½œå­—æ®µï¼ˆactionï¼‰ä¿æŒä¸æ¥å£çš„æœ€åä¸€çº§è·¯å¾„ä¸€è‡´ï¼Œå¹¶ä¸æ¥å£è¯·æ±‚å‚æ•°å°è£…ç±»å¯¹åº”ï¼Œå½¢å¦‚

actionï¼š`getUsername` ---> pathï¼š`/api/a/getUsername` ---> RequestClassï¼š`GetUsernameRequest`

> æ¥å…¥æˆ‘ä»¬

é¦–å…ˆéå¸¸æ„Ÿè°¢ä½ é€‰æ‹©æˆ‘ä»¬çš„å¹³å°ï¼Œä¸å…¨é“¶æ²³ç³»çš„å°ä¼™ä¼´ä¸€èµ·åˆ†äº«ä½ çš„å‘ç°ä¸å–œæ‚¦ã€‚

åœ¨ä¸Šä¼ æˆåŠŸåï¼Œæˆ‘ä»¬å°†åœ¨2\~3ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸ä½ æä¾›çš„æ¥å£ï¼Œå…ˆç¥ä½ å¥½è¿~è‹¥é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ä»¬ï¼ˆQQ907830201ï¼ŒEmailï¼špolarisronx@163.comï¼‰

ä»¥ä¸‹äº‹é¡¹è¯·æ³¨æ„ï¼š

1. åœ¨å®¡æ ¸å®Œæˆå‰ï¼Œè¯·å‹¿é‡å¤æäº¤ã€‚
2. è¯·ç¡®ä¿æ¥å£éƒ¨ç½²çš„æœåŠ¡å™¨IPçš„å¡«å†™æ˜¯æ­£ç¡®çš„ï¼Œä¸”æ˜¯å…¬ç½‘IPï¼Œç«¯å£å¯¹å¤–å¼€æ”¾ã€‚å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒâ€œæŸ¥çœ‹è¯¦æƒ…â€åœ¨å¹³å°åœ¨çº¿è°ƒè¯•ï¼Œæˆ–ç”¨ç¬¬ä¸‰æ–¹æµ‹è¯•è½¯ä»¶å…ˆè¡Œæµ‹è¯•ã€‚
3. å¹³å°çš„æ‰€æœ‰æ¥å£å¯¹å¤–å¼€æ”¾ï¼Œä¸€æ—¦æäº¤é»˜è®¤æ¥å—å¹³å°ç®¡ç†ã€‚





## æ‹“å±•1+ï¼šä¸Šä¼ SKDåˆ°mavenä¸­å¤®ä»“åº“

åœ¨2024å¹´2æœˆ1æ—¥ï¼Œsonatype ç»ˆäºæ”¾å¼ƒäº†åŸæœ¬çš„maven-centralçš„æ³¨å†Œæ–¹å¼ï¼Œä¸å†æ”¯æŒ [**jira**](https://issues.sonatype.org/) åˆ›å»ºå·¥å•å¤„ç†äº†

1. åœ¨https://central.sonatype.com/æ³¨å†Œè´¦æˆ·

polarisronx@163.com Liu907830201@

2. User Token

åœ¨å¤´åƒä¸‹æ‹‰ View Account

usrname:4KHReXXW

passwoed:nEUthtTz5LomZ/A89xlHN33J9sYNFGmTIQJ89H43bLTp

```xml
<server>
	<id>${server}</id>
	<username>4KHReXXW</username>
	<password>nEUthtTz5LomZ/A89xlHN33J9sYNFGmTIQJ89H43bLTp</password>
</server>
```

![image-20240527201437610](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240527201437610.png)

3. æ·»åŠ namespace

è¿™ä¸ªæ˜¯å¯¹åº”é¡¹ç›®pom.xmlä¸­çš„groupIdçš„ï¼Œä¹‹å‰éƒ½æ˜¯éšä¾¿å†™ä»€ä¹ˆcom.atguiguï¼Œcom.polarisï¼Œè¿™ä¸ªéœ€è¦éªŒè¯çš„ï¼Œæ–¹ä¾¿èµ·è§ç”¨githubï¼Œå‘½åç©ºé—´å°±æ˜¯io.github.polarisronx

4. é…ç½®gpgå¯†é’¥

éœ€è¦https//[http://www.gnupg.org/download/](https://link.zhihu.com/?target=http%3A//www.gnupg.org/download/) ä¸‹è½½è½¯ä»¶ï¼Œåˆ›å»ºå¯†é’¥å¹¶ä¸Šä¼ 

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240527211109.png)

https//[http://www.gnupg.org/download/](https://link.zhihu.com/?target=http%3A//www.gnupg.org/download/) è¿™ä¸ªç½‘ç«™ä¸Šèƒ½æŸ¥å¾—åˆ°å°±æˆåŠŸ

5. ä¿®æ”¹mavençš„é…ç½®æ–‡ä»¶

åœ¨Dç›˜çš„ï¼Œè¦å¡«çš„å°±æ˜¯ä¸Šé¢çš„ï¼Œidéšæ„è·Ÿä¸‹é¢çš„serverIdå¯¹åº”å³å¯

```xml
<servers>
    <server>
        <id>central</id>
        <username>..username..</username>
        <password>..password..</password>
    </server>
</servers>
```

6. ä¿®æ”¹é¡¹ç›®çš„pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.13</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>io.github.polarisronx</groupId>
    <artifactId>papi-client-sdk</artifactId>
    <version>1.0.2</version>
    <name>papi-client-sdk</name>
    <description>papi-client-sdk</description>
    <url>https://github.com/polarisronx/papi-client-sdk.git</url>
    <licenses>
        <license>
            <name>The Apache Software License, Version 2.0</name>
            <url>http://www.apache.org/licenses/LICENSE-2.0.txt</url>
        </license>
    </licenses>
    <developers>
        <developer>
            <name></name>
            <email></email>
        </developer>
    </developers>
    <scm>
        <connection>scm:git:git://github.com/polarisronx/papi-client-sdk.git</connection>
        <developerConnection>scm:git:ssh://github.com:polarisronx/papi-client-sdk.git</developerConnection>
        <url>http://github.com/polarisronx/papi-client-sdk/tree/master</url>
    </scm>
    <distributionManagement>
        <repository>
            <id>central</id>
            <name>central-releases</name>
            <url>https://s01.oss.sonatype.org/</url>
        </repository>
    </distributionManagement>
    <properties>
        <java.version>8</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <!--   centralå‘å¸ƒæ’ä»¶    -->
            <plugin>
                <groupId>org.sonatype.central</groupId>
                <artifactId>central-publishing-maven-plugin</artifactId>
                <version>0.4.0</version>
                <extensions>true</extensions>
                <configuration>
                    <publishingServerId>central</publishingServerId>
                    <tokenAuth>true</tokenAuth>
                </configuration>
            </plugin>
            <!--   sourceæºç æ’ä»¶   å®˜æ–¹è¦æ±‚ -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-source-plugin</artifactId>
                <version>2.2.1</version>
                <executions>
                    <execution>
                        <id>attach-sources</id>
                        <goals>
                            <goal>jar-no-fork</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <!--   javadocæ’ä»¶  å®˜æ–¹è¦æ±‚  -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-javadoc-plugin</artifactId>
                <version>3.6.3</version>
                <configuration>
                    <additionalJOptions>
                        <additionalJOption>-Xdoclint:none</additionalJOption>
                    </additionalJOptions>
                </configuration>
                <executions>
                    <execution>
                        <id>attach-javadocs</id>
                        <goals>
                            <goal>jar</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-gpg-plugin</artifactId>
                <version>1.5</version>
                <configuration>
                    <!--   æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œå¯çŸ¥é“GnuPGè·¯å¾„ -->
                    <executable>D:\program files\GnuPG\bin\gpg.exe</executable>
                </configuration>
                <executions>
                    <execution>
                        <id>sign-artifacts</id>
                        <phase>verify</phase>
                        <goals>
                            <goal>sign</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>

```

7. ç‚¹å‡»æ’ä»¶deployï¼Œç„¶åå°±å¯ä»¥ç™»å½•ä¹‹å‰çš„ç½‘ç«™publish

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240527211852.png)

å‚è€ƒ[2024å¹´2æœˆåå¦‚ä½•ä½¿ç”¨maven centralå‘å¸ƒè‡ªå·±çš„jaråˆ°ä¸­å¤®ä»“åº“_central-publishing-maven-plugin-CSDNåšå®¢](https://blog.csdn.net/qq_37160346/article/details/136537800)

[å¦‚ä½•å‘å¸ƒå¼€æºç»„ä»¶åˆ°Mavenä¸­å¤®ä»“åº“ï¼ˆæ–°ï¼‰ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/681731772)

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240710141029.png)

**é‡åˆ°çš„é—®é¢˜**

**1. maven æ‰“åŒ…é”™è¯¯ Exit code: 1 - javadoc ä¸­æ–‡ä¹±ç **

è§£å†³ï¼šideaç¼–è¾‘å™¨ï¼šåœ¨mavençš„Runnerä¸­å¢åŠ è®¾ç½®ï¼š-DarchetypeCatalog=internal -Dfile.encoding=GBK

å‚è€ƒï¼š[mavenæ‰“åŒ…é”™è¯¯ Exit code: 1 - javadoc_mavenæ‰“åŒ…æŠ¥é”™javadoc-CSDNåšå®¢](https://blog.csdn.net/u010427387/article/details/120667674)

**2. maven-javadoc-pluginæ‰“åŒ…é”™è¯¯ï¼šæœªçŸ¥æ ‡è®°ï¼šdate**

è§£å†³ï¼šå¿½ç•¥docé”™è¯¯

å‚è€ƒï¼š[maven-javadoc-pluginæ‰“åŒ…é”™è¯¯ï¼šæœªçŸ¥æ ‡è®°ï¼šdate_é”™è¯¯: æœªçŸ¥æ ‡è®°: date-CSDNåšå®¢](https://blog.csdn.net/qq_30038111/article/details/106279837)

## æ‹“å±•2ï¼šRedis+JWT åŒtokenç™»å½•

> ç›®æ ‡

å½“å‰çš„ç™»å½•æ¨¡å¼ï¼šå…±äº«Sessionã€‚åˆ©ç”¨äº†springçš„å…±äº«Sessionï¼ŒæŠŠSessionå­˜åœ¨Redisã€‚

ç”¨æˆ·æ¯æ¬¡ç™»å½•ï¼Œéƒ½ä¼šæŠŠç”¨æˆ·ä¿¡æ¯ä½œä¸ºSessionçš„å‚æ•°æ”¾è¿›å»ï¼Œå› ä¸ºspringçš„é›†æˆï¼Œæ¯æ¬¡å¯ä»¥è½»æ¾åœ°ä»è¯·æ±‚ä¸­æ‹¿åˆ°Sessionï¼Œå†ä»Sessionä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚

è¦å®ç°çš„æ¨¡å¼ï¼š

æ³¨å†Œåï¼Œç”¨æˆ·ç™»å½•ï¼Œåœ¨åç«¯éªŒè¯é€šè¿‡åä¼šç”Ÿæˆtokenï¼ˆaccessTokenå’ŒRefreshTokenï¼‰å¹¶è¿”å›ç»™å‰ç«¯ï¼ˆåç«¯æ–¹æ³•è¿”å›Stringï¼‰ã€‚

å‰ç«¯åœ¨åç»­çš„è¯·æ±‚ä¸­ä¼šåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ Tokenï¼ˆè®¾ä¸ºauthorizationï¼‰ï¼Œåç«¯å¤„ç†è¯·æ±‚æ—¶ä¼šå…ˆè¢«æ‹¦æˆªå™¨æ‹¦æˆªï¼Œé€šè¿‡Tokenè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶æŠŠä¿¡æ¯å­˜åœ¨çº¿ç¨‹åŸŸThreadLocalä¸­ï¼Œåœ¨å¤„ç†ä¸šåŠ¡æ—¶ç›´æ¥ä»ThreadLocalè·å–ç”¨æˆ·ã€‚

ç”¨æˆ·å…³é—­æµè§ˆå™¨åï¼Œéä¼šè¯çº§Cookieä¸ä¼šåˆ é™¤ï¼Œåœ¨æœ‰æ•ˆæœŸå†…å†æ¬¡è¿›å…¥ç½‘ç«™ä¼šæºå¸¦tokenï¼ˆåç«¯æ¥æ”¶åˆ°ä¼šæŠŠç”¨æˆ·ä¿¡æ¯å­˜åœ¨çº¿ç¨‹åŸŸï¼Œè€Œå‰ç«¯ä¼šé¦–å…ˆæ£€æŸ¥ç”¨æˆ·ç™»å½•æ€initialStateå»è·å–ç”¨æˆ·ä¿¡æ¯ï¼‰ï¼Œä¸éœ€è¦å†æ¬¡ç™»å½•ã€‚

> åç«¯

ç”Ÿæˆtoken

ä½¿ç”¨jwtå·¥å…·åŒ…ï¼šjose4j (é€‰æ‹©å‚è€ƒ[å„ç±»JWTåº“(java)çš„ä½¿ç”¨ä¸è¯„ä»· | MONKEYK.åšå®¢ (andaily.com)](https://andaily.com/blog/?p=956)ï¼Œjwtå®˜ç½‘ï¼šhttps://jwt.io/)

1.åˆ›å»ºtoken

ç»„æˆ 

- header
  - type
  - algo: RSA_USING_SHA256
- payload
  - Subject: JWTæ‰€é¢å‘çš„ç”¨æˆ·
  - ExpirationTime: è¿‡æœŸæ—¶é—´
  - Issued at: ç­¾å‘æ—¶é—´
  - NotBeforeMinutesInThePast: ç”Ÿæ•ˆæ—¶é—´
  - è‡ªå®šä¹‰Stringå‚æ•°ï¼šç”¨æˆ·ç›¸å…³ä¿¡æ¯
- signature
  - head+payload+privateKey åŠ å¯†å¾—åˆ°çš„ç­¾å

2.tokenè¿‡æœŸæ—¶é—´è®¾ç½®

å‚è€ƒ[åŒtokenåˆ·æ–°ã€ç»­æœŸï¼Œaccess_tokenå’Œrefresh_tokenå®æ•ˆå¦‚ä½•è®¾ç½®-CSDNåšå®¢](https://blog.csdn.net/a704397849/article/details/90216739)

aToken 60\*60\*24 1å¤©

rToken 4\*60\*60*24 4å¤©

3.tokenå­˜å‚¨

å‰ç«¯ï¼šç”¨æˆ·ç™»å½•åtokenä¼šè¢«å­˜å‚¨åœ¨å®¢æˆ·ç«¯æœ¬åœ°çš„éä¼šè¯çº§çš„Cookieä¸­ï¼ˆå€ŸåŠ©js-cookieåŒ…ï¼‰ï¼Œåé¢æ¯æ¬¡å‘é€è¯·æ±‚åˆ°åç«¯ï¼Œåœ¨å‰ç«¯æ‹¦æˆªå™¨è®¾ç½®äº†åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ Keyä¸ºAuthorizationçš„tokenã€‚

åç«¯ï¼šç”¨æˆ·ç™»å½•åç”Ÿäº§çš„tokenä¼šè¢«å­˜å‚¨åœ¨Redisï¼Œä¸¤ä¸ªtokençš„æœ‰æ•ˆæœŸä¸åŒï¼Œæ¯æ¬¡åç«¯å‘æ¥è¯·æ±‚éƒ½ä¼šè¢«æ‹¦æˆªå™¨æ‹¦æˆªï¼ˆMVCæä¾›çš„æ‹¦æˆªå™¨ï¼‰è¦æ±‚è·å–è¯·æ±‚å¤´ä¸­Authorizationçš„tokenï¼Œå¹¶ä¸Redisä¸­å­˜å‚¨çš„tokenè¿›è¡Œæ ¡éªŒï¼Œæ— æ•ˆæ‹¦æˆªï¼Œè¿‡æœŸäº†è¿›è¡Œåˆ·æ–°

> è®°å½•é‡åˆ°çš„Bug

1. ç™»å½•æ˜¯Postè¯·æ±‚ï¼Œä¼šå‘ä¸€ä¸ªé¢„è¯·æ±‚ï¼Œé¢„è¯·æ±‚ä¸ä¼šå¸¦è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œå¯¼è‡´ä¸€ç›´è·å–ä¸åˆ°authorizationçš„è¯·æ±‚å¤´ä¸€ç›´è¢«æ‹¦æˆªå™¨æ‹¦æˆªã€‚

   è§£å†³åŠæ³•ï¼šå¦‚æœæ˜¯é¢„è¯·æ±‚å°±ç›´æ¥æ”¾è¡Œ

2. ç”±äºç™»å½•æ¥å£è¿”å›tokenï¼Œå¯¼è‡´å‰ç«¯åœ¨ç™»å½•åä¹Ÿè·å–ä¸åˆ°ç”¨æˆ·ä¿¡æ¯

   è§£å†³åŠæ³•ï¼šç™»å½•çš„æ—¶å€™åº”è¯¥åŒæ­¥æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·ã€‚

3. accessTokenè¿‡æœŸæˆ–è€…è¢«åˆ é™¤åï¼ˆä½†RefreshTokenè¿˜åœ¨ï¼‰ï¼Œå¹¶æ²¡æœ‰ç»­ç­¾ï¼Œè€Œæ˜¯ç›´æ¥å¼‚å¸¸ï¼Œæé†’ç”¨æˆ·é‡æ–°ç™»å½•ã€‚

   åŸå› ï¼šç”ŸæˆTokençš„æ—¶å€™claimsä¸­æœ‰ç­¾å‘æ—¶é—´ã€è¿‡æœŸæ—¶é—´ã€‚åœ¨æ ¡éªŒtokenæ˜¯å¦è¿‡æœŸçš„æ—¶å€™è¦å…ˆè§£ætokenå†…çš„ä¿¡æ¯ï¼Œå‘ç°å·²ç»è¿‡expirationtimeä¸ä¼šåå°åˆ¤æ–­å°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ä¸ä¼šç»­ç­¾äº†ã€‚

   å¼‚å¸¸ï¼šInValidJWTException: The JWT is no longer valid - the evaluation time  " ... " is on or after the Expiration Time;

   è§£å†³ï¼štokenä¸­ä¸å†æ·»åŠ è¿‡æœŸæ—¶é—´ã€‚æ˜¯å¦è¿‡æœŸç”±åå°æ ¹æ®ç­¾å‘æ—¶é—´iat+ACCESS_TOKEN_EXPIRATION_TIMEåˆ¤æ–­ã€‚

   <img src="https://github.com/polarisronx/Papi-backend/doc/images/QQ20240427210107.png" style="zoom: 50%;" /><img src="https://github.com/polarisronx/Papi-backend/doc/images/QQ20240427205743.png" style="zoom:50%;" />

## æ‹“å±•3ï¼šå‰ç«¯ä¼˜åŒ–

> 01 ç”¨æˆ·åè®®ï¼Œéšç§åè®®

ç”¨äº†ant designçš„æŠ˜å é¢æ¿ç»„ä»¶

é‡åˆ°é—®é¢˜ï¼šä¸ä¼šç”¨ç»„ä»¶ï¼Œç†Ÿæ‚‰ä¸€ä¸‹ä»¥ä¸‹æµç¨‹

```tsx
import {Collapse} from 'antd';

const PrivacyAgreement = () => {
    const onCharge = (key) =>{
        ...// å®šä¹‰è¦ç”¨åˆ°çš„å‡½æ•°
    };
    const text = `...`;// å®šä¹‰å˜é‡
    const {Title,Paragrapg} = Typography;// å®šä¹‰ç»„ä»¶çš„ä¸€äº›å­ç»„ä»¶æˆ–å±æ€§
    return(
    	<div>
        	<Collapse bordered={false}>
            	<Panel>
                	<p>{text}</p>
                </Panel>
            </Collapse>
        </div>
    )  
}
export default PrivacyAgreement;
```

> 02 ä¼˜åŒ–é¦–é¡µ

ç”¨äº†ä¸€ä¸ªèµ°é©¬ç¯ã€‚ä¿®æ”¹äº†logoã€‚ä¿®æ”¹äº†footä¿¡æ¯ã€‚

**é‡åˆ°çš„é—®é¢˜ï¼Œ**é¡µé¢æ²¡æœ‰æŠ¥é”™ä½†æ˜¯ä¸€ç‰‡ç©ºç™½ï¼Œæ²¡æœ‰æ˜¾ç¤ºã€‚

è§£å†³ï¼šåŸå› æ˜¯å¯¼é”™åŒ…äº†ï¼Œ\<link>åº”è¯¥æ˜¯umiçš„ï¼Œä½†æ˜¯å¯¼æˆantdçš„äº†ã€‚



> 03 å°†åç«¯å¼‚å¸¸è¿”å›ç»™å‰ç«¯

åç«¯çš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼Œä¼šåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶æ•æ‰å¼‚å¸¸ï¼Œå¹¶æŠŠå¼‚å¸¸ä¿¡æ¯ä½œä¸ºå“åº”è¿”å›ç»™å‰ç«¯ã€‚

åŒæ—¶å‰ç«¯è¦åœ¨å“åº”æ‹¦æˆªå™¨è®¾ç½®

```ts
// å“åº”æ‹¦æˆªå™¨
  responseInterceptors: [
    (response) => {
      // æ‹¦æˆªå“åº”æ•°æ®ï¼Œè¿›è¡Œä¸ªæ€§åŒ–å¤„ç†
      const { data } = response as unknown as ResponseStructure;
      // æ‰“å°å“åº”æ•°æ®ç”¨äºè°ƒè¯•
      console.log('response data:', data);
      const {code} = data;
      // å“åº”æˆåŠŸï¼Œè¿”å›å“åº”
      if (data && code === 0) {
        return response;
      } else {
        switch (code) {
          case 40100:
            history.push('/user/login');      
            break;
          default:
            // if (location.pathname.includes("/")) {
            //   break
            // }

            message.error(data.message);
            break;
        }
      }
      return response;
    },
  ],
```

> 04 æ¥å£å¸‚åœºé¡µé¢

ä¼˜åŒ–ç•Œé¢UI ä»¥åŠå¢åŠ æ¥å£æœç´¢åŠŸèƒ½

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240428214018.png)

***TODO***ï¼šæ”¶è—ã€ç‚¹èµå’Œè¯„è®ºåŠŸèƒ½å¾…å¼€å‘

> 05æ¥å£ä¸Šä¼ åŠŸèƒ½

é‡‡ç”¨åˆ†é¡µè¡¨å•ç»„ä»¶ã€‚

åœ¨ç”¨æˆ·æäº¤å‰éœ€è¦è¾“å…¥éšæœºæ•°æ ¡éªŒç ï¼Œé˜²æ­¢æ¶æ„åˆ·

## æ‹“å±•4ï¼šAliyun-OSS ä¸ªäººè®¾ç½®é¡µ&ä¸Šä¼ å¤´åƒ

å¤´åƒæ¡†ç‚¹å‡»è¿›å…¥ä¸ªäººé¡µï¼Œå¯ä»¥ä¿®æ”¹ç”¨æˆ·ä¸ªäººä¿¡æ¯ã€‚

1. ä¿®æ”¹å¤´åƒ
   1. ä½¿ç”¨é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ Aliyun-OSSï¼Œå¼•å…¥SDKï¼Œé…ç½®å®¢æˆ·ç«¯ï¼Œï¼ˆåŒ…æ‹¬å¯†é’¥èŠ‚ç‚¹ç­‰ä¿¡æ¯ï¼‰
   2. ä¸Šä¼ æ–‡ä»¶ @RequestPart
   3. æµç¨‹ï¼šä¸Šä¼ æ–‡ä»¶åˆ°é˜¿é‡Œäº‘ï¼Œè¿”å›ä¸Šä¼ ç»“æœ UploadResult ç±»ï¼Œæ“ä½œæˆåŠŸæŠŠURLå–å‡ºæ¥ç»™åé¢æ›´æ–°ç”¨ã€‚

```java
@Data
public class UploadResult {
    /**
     * æ–‡ä»¶å”¯ä¸€æ ‡è¯†
     */
    private String uid;
    /**
     * æ–‡ä»¶å
     */
    private String name;
    /**
     * çŠ¶æ€
     */
    private String status;
    /**
     * æœåŠ¡ç«¯å“åº”å†…å®¹ï¼Œå¦‚ï¼š'{"status": "success"}'
     */
    private String response;
    /**
     * å›¾åƒurl
     */
    private String url; //aliyunOssConfig.getPrefix() + newFileName
}
```

æ–‡ä»¶åå‘½åè§„åˆ™ï¼š

```java
"papi/" +new DateTime().toString("yyyy/MM/dd")+ "/user-" + userId + RandomUtil.randomInt(100, 9999) + "."
                + StringUtils.substringAfterLast(sourceFileName, ".");
```

2. ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯

   1. é¦–å…ˆè¦å¤ç°ç”¨æˆ·åŸæœ‰çš„ä¿¡æ¯

      ```tsx
      // ä½¿ç”¨ React çš„ useRef åˆ›å»ºä¸€ä¸ªå¼•ç”¨ä»¥è®¿é—® ProTable ä¸­çš„è¡¨å•å®ä¾‹
      const proTableRef = useRef<ProFormInstance>();
      // é˜²æ­¢ä¿®æ”¹çš„è¡¨å•å†…å®¹åœ¨åˆæ¬¡åˆå§‹åŒ–åå°±ä¸åœ¨å˜åŒ–ï¼Œè¦ç›‘å¬Valuesçš„å˜åŒ–
      // ç”¨Reactçš„useEffectåœ¨å€¼å‘ç”Ÿæ”¹å˜æ—¶èƒ½æ›´æ–°è¡¨å•çš„å€¼
      useEffect(() => {
          if(proTableRef){
              proTableRef.current?.setFieldsValue(currentUser);
          }
      },[currentUser]);
      ```

   2. è·å–åˆ°è¡¨å•å†…ç”¨æˆ·å¡«çš„ä¿¡æ¯ + ä¸Šä¼ çš„å¤´åƒè¿”å›çš„URL => æ›´æ–°ç”¨æˆ·ä¿¡æ¯ã€‚

      ä¸å¼ºåˆ¶æ¯æ¡å†…å®¹å¿…å¡«ï¼Œæœªå¡«çš„å†…å®¹ä½œç½®ç©ºå¤„ç†è€Œä¸ä¼šä¿ç•™å·²æœ‰å†…å®¹ï¼Œè€Œä¸”æœ‰æç¤ºï¼Œè¿™æ ·æ›´çµæ´»ä¸€äº›ã€‚

**é‡åˆ°çš„é—®é¢˜ï¼š**ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ä¸Šä¼ å¤´åƒå’Œä¿®æ”¹ä¿¡æ¯ä¸€ä¸ªæ¥å£ï¼Œ@RequestBodyå’Œ@RequestPartè”åˆä½¿ç”¨ã€‚ä½†ä¸€æƒ³ä¸å¤ªç°å®ï¼Œå¤´åƒè¦å…ˆä¸Šä¼ åˆ°äº‘ç«¯ï¼Œå‰ç«¯èƒ½æ˜¾ç¤ºå¤´åƒï¼Œç„¶åå†æŠŠå¤´åƒçš„urlç»™åç«¯ä¿®æ”¹ã€‚

**é‡åˆ°çš„é—®é¢˜ï¼š**å›¾ç‰‡æˆåŠŸä¸Šä¼ åˆ°äº‘ç«¯ä½†å‰ç«¯æ— æ³•æ˜¾ç¤ºï¼Œæäº¤ä¿®æ”¹ä¹Ÿæ²¡æœ‰æ”¹å¤´åƒã€‚

åŸå› ï¼šè‡³å°‘å¤´åƒä¸Šä¼ æ¥å£æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ä¿®æ”¹ä¿¡æ¯çš„æ¥å£åŒ…æ‹¬å‰ç«¯éƒ½æ²¡æœ‰æ”¶åˆ°å¤´åƒçš„URLã€‚å¤´åƒurlè®¾ç½®æ ¹æ®å‰åç«¯ä»¥åŠäº‘ç«¯çš„çº¦å®šã€‚

```java
private String getFilePath(String sourceFileName) {
    Long userId = UserHolder.getUser().getId();
    return "papi/" +new DateTime().toString("yyyy/MM/dd")+ "/user-" + userId + RandomUtil.randomInt(100, 9999) + "." + StringUtils.substringAfterLast(sourceFileName, ".");
}

String newFileName = getFilePath(fileName);
fileUploadDto.setUrl(aliyunOssConfig.getPrefix() + newFileName);
```

**é‡åˆ°çš„é—®é¢˜ï¼š**æ‰“å¼€ä¿¡æ¯è®¾ç½®çš„é¡µé¢æ—¶ï¼Œç”¨æˆ·åŸæœ‰çš„å¤´åƒä¸æ˜¾ç¤ºã€‚

åŸå› ï¼šåŸå…ˆæƒ³çš„æ˜¯å†™ä¸€ä¸ªæ–¹æ³•æ¥loadDataï¼ŒåŠ è½½ç”¨æˆ·æ•°æ®åˆ°å‰ç«¯é¡µé¢ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸ä¼šéšæ—¶æ‰§è¡Œéšæ—¶æ›´æ–°

è§£å†³åŠæ³•ï¼šåº”è¯¥ç”¨ç³»ç»Ÿç”¨æˆ·ç™»å½•çŠ¶æ€initialStateæ¥è®¾ç½®ä¿¡æ¯è€Œä¸æ˜¯å¯„å¸Œæœ›äºè€æ˜¯æ‰§è¡Œæ–¹æ³•æ¥è·å–ã€‚

```java
const { initialState, setInitialState } = useModel('@@initialState');
const {loginUser} = initialState || {};
updatedFileList[0] = {
          // @ts-ignore
          uid: loginUser?.userAccount,
          // @ts-ignore
          name: loginUser?.userAvatar?.substring(loginUser?.userAvatar!.lastIndexOf('-') + 1),
          status: "done",
          percent: 100,
          url: loginUser?.userAvatar
        }
```

æ‹“å±•5ï¼šä¸ªäººä¸­å¿ƒé¡µ&&æ¥å£ä¸Šä¼ 

ä¸ªäººä¸­å¿ƒé¡µæœ‰ä¸ªäººä¿¡æ¯ã€ä¸ªäººå¼€å‘å¯†é’¥ã€ç”¨æˆ·ä¸ªäººä¸Šä¼ çš„æ¥å£ä¿¡æ¯ï¼ŒæŸ¥çœ‹ä¸Šä¼ çš„æ¥å£çŠ¶æ€ï¼ˆå®¡æ ¸é€šè¿‡ï¼‰

æ¥å£ä¸Šä¼ é¡µï¼š

é‡‡ç”¨åˆ†æ­¥è¡¨å•ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥éšæœºçš„éªŒè¯ç åç¡®è®¤æäº¤ï¼Œé˜²æ­¢æ¶æ„çŒæ°´ã€‚

ä¼˜åŒ–ï¼šç®¡ç†é¡µå®¡æ ¸æ¥å£ä¸Šçº¿

**é‡åˆ°çš„é—®é¢˜ï¼šæŠŠæ¥å£çš„IDç”±autoçš„è‡ªå¢æ”¹ä¸ºassignedåï¼Œæ— æ³•ä¸Šä¸‹çº¿æ“ä½œäº†ã€‚**

**åŸå› **ï¼šæ¥å£çš„IDé”™è¯¯ã€‚è¡¨å•å†…çš„æ•°æ®æ˜¾ç¤ºIDçš„ç±»å‹valueTypeæ˜¯indexé»˜è®¤æ˜¯1å¼€å§‹çš„è‡ªå¢ï¼Œç”¨è¿™ä¸ªIDæŸ¥ä¸åˆ°ã€‚

valueTypeæ”¹ä¸ºtextåè¿˜æ˜¯æŠ¥é”™ã€‚åŸå› æ˜¯assignedç”Ÿæˆçš„IDæ˜¯ç”±é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„19ä½ï¼Œåœ¨åç«¯ç”¨longå­˜å‚¨æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨å‰ç«¯ JS é»˜è®¤æ˜¯æ•´å‹ numberï¼Œä½æ•°è¶…è¿‡äº†16ä½çš„å­˜å‚¨èŒƒå›´ï¼Œæ•°æ®å­˜å‚¨ä¸å‡†ç¡®äº†ï¼Œæ‰€ä»¥æŸ¥ä¸åˆ°ã€‚

**è§£å†³åŠæ³•**ï¼šè‡ªå·±å®ç°äº†é›ªèŠ±ç®—æ³•ï¼Œæ›¿ä»£äº†Mybatisé‡Œé»˜è®¤çš„ç”Ÿæˆç®—æ³•ï¼ˆimplements IdentifierGeneratorå®ç°å°±å¯ä»¥äº†ï¼‰ã€‚ç”±äºJSä¸­çš„numberç±»å‹æœ€å¤§ç²¾åº¦äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 2^53ï¼Œæ‰€ä»¥ç”Ÿæˆçš„å…¨å±€IDä¹Ÿæ˜¯53ä½ï¼Œåˆ†é…ä¸º 39ä½æ—¶é—´æˆ³+4ä½å·¥ä½œæœºå™¨ID+10ä½åºåˆ—å·ï¼Œæ—¶é—´èµ·å§‹æ ‡è®°ç‚¹ä½œä¸ºåŸºå‡†ï¼Œå–2024-01-01 00:00:00ï¼ˆä¸€æ—¦ç¡®å®šä¸èƒ½å˜åŠ¨ï¼‰ï¼Œç³»ç»Ÿæœ€å¤§å¯ç”¨æ—¶é™ï¼š2041-06-02 21:56:53ï¼Œæ¯æ¯«ç§’å¯äº§ç”Ÿ1024ä¸ªåºåˆ—å·ã€‚è¿™æ ·å°±ä¸ä¼šä¸¢å¤±ç²¾åº¦äº†ï¼ˆä¸‹å›¾æ–°çš„ID15ä½ï¼Œæ˜¯ç²¾ç¡®çš„ï¼ŒåŸID19ä½ï¼Œæœ€å2ä½éƒ½ä¸º0ï¼‰

å‚è€ƒï¼š[é›ªèŠ±ç®—æ³•åŸç†ä»¥åŠJSç²¾åº¦ä¸¢å¤±é—®é¢˜-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)](https://developer.aliyun.com/article/1166385)

<img src="https://github.com/polarisronx/Papi-backend/doc/images/QQ20240504172003.png" style="zoom:80%;" /><img src="https://github.com/polarisronx/Papi-backend/doc/images/QQ20240504172033.png" style="zoom:67%;" />

## æ‹“å±•5ï¼šNacos é…ç½®ä¸­å¿ƒ

bootstrap æ˜¯åº”ç”¨ç¨‹åºçš„çˆ¶ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±æ˜¯è¯´ bootstrap åŠ è½½ä¼˜å…ˆäº applicatonã€‚

- boostrap ç”±çˆ¶ ApplicationContext åŠ è½½ï¼Œæ¯” applicaton ä¼˜å…ˆåŠ è½½
- boostrap é‡Œé¢çš„å±æ€§ä¸èƒ½è¢«è¦†ç›–
- åœ¨ bootstrap é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¿æ¥åˆ°é…ç½®ä¸­å¿ƒçš„é…ç½®å±æ€§æ¥åŠ è½½å¤–éƒ¨é…ç½®ä¸­å¿ƒçš„é…ç½®ä¿¡æ¯ï¼›

åº”ç”¨å¯åŠ¨æ—¶ä¼šä¼˜å…ˆåŠ è½½bootstrapï¼Œbootstrapä¼šä»å¤–éƒ¨é…ç½®ä¸­å¿ƒè·å–é…ç½®ä¿¡æ¯ã€‚è¿™é‡Œåœ¨nacosé…ç½®äº†é‚®ç®±ã€é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨çš„é…ç½®ï¼ˆæ¶‰åŠå¯†é’¥ã€æˆæƒç ç­‰ï¼‰

**é‡åˆ°çš„é—®é¢˜ï¼šbootstrapä¸ä¼šè¢«è¯†åˆ«**

**è§£å†³åŠæ³•ï¼š**

```xml
<!--éœ€è¦å¼•å…¥è¯¥jaræ‰èƒ½ä½¿bootstrapé…ç½®æ–‡ä»¶ç”Ÿæ•ˆ-->
<!--æ–°ç‰ˆçš„SpringCloudé»˜è®¤æ²¡æœ‰å®‰è£…bootstrapä¾èµ–ï¼Œå› æ­¤ä¸èƒ½è¯»å–é¡¹ç›®bootstrap.ymlæ–‡ä»¶å†…å®¹-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-bootstrap</artifactId>
</dependency>
```

**é‡åˆ°çš„é—®é¢˜ï¼šåŒ¹é…ä¸åˆ°nacosä¸Šçš„é…ç½®ä¿¡æ¯**

åŸå› ï¼šé…ç½®æ–‡ä»¶çš„é…ç½®æœ‰é—®é¢˜ï¼Œä»”ç»†æ¯”å¯¹å„é¡¹é…ç½®

```yaml
spring:
  cloud:
    nacos:
      config:
        server-addr: ${host.nacos}
        namespace: b765d215-8484-45ec-a86f-07048c01dd47
        group: ${spring.profiles.active}
        file-extension: yaml
        extension-configs:  # å˜åŒ–çš„åœ°æ–¹
          - data-id: papi-main-dev.yaml
            group: dev
            refresh: true
```

**é‡åˆ°çš„é—®é¢˜ï¼šDubboæ³¨å†Œå¤±è´¥**

Param check invalid:Param 'group' is illegal, illegal characters should not appear in the param.

**åŸå› ï¼šä¸æ”¯æŒè®¾ç½®åˆ†ç»„ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ªdubboçš„å‘½åç©ºé—´ä½œéš”ç¦»**

```yml
dubbo:
  application:
    name: papi-main
  # è®¾ç½®dubboçš„åè®®ä¸ºdubboï¼Œéšæœºåˆ†é…ç«¯å£
  protocol:
    name: dubbo
    port: 22221
  registry:
    # é…ç½®æ³¨å†Œä¸­å¿ƒä¸º nacosï¼Œä½¿ç”¨çš„åœ°å€æ˜¯ nacos://127.0.0.1:8848
    id: nacos-registry
    address: nacos://${host.nacos}
    parameters:
      # æ³¨æ„ è¿™é‡Œè¦åœ¨ nacos åˆ›å»ºåä¸º dubbo çš„ namespace ç¯å¢ƒ
      namespace: 742651c4-5b7c-45e8-91ce-a1d2ba31cf02
#      group: ${spring.profiles.active} Param 'group' is illegal
```

## æ‰©å±•ï¼šå¤šç¯å¢ƒé…ç½®ä¸éƒ¨ç½²ä¸Šçº¿

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240424215901.png)

```ya
spring:
  application:
    name: papi-main
  profiles:
    active: dev
```

å‚è€ƒ AliyunECS.md ç”±äºè®¾è®¡è´¦å¯†ä¿¡æ¯ï¼Œä¸å…¬å¼€ã€‚

## æ‹“å±•6ï¼šSMTP é‚®ç®±ç™»å½•å’Œé‚®ç®±æ³¨å†Œ

> ç™»å½•é¡µå’Œæ³¨å†Œé¡µ

1. å¢åŠ äº†æ³¨å†Œé¡µï¼Œ

**é‡åˆ°çš„é—®é¢˜ï¼š**è·¯ç”±é…ç½®é”™è¯¯

è§£å†³ï¼šè¿™ä¸ªä¸éš¾ï¼Œè¦ç»†å¿ƒã€‚

**é‡åˆ°çš„é—®é¢˜ï¼š**æ²¡ç™»å½•çš„è¯è®¿é—®ä»»ä½•é¡µé¢éƒ½ä¼šç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µ

åœ¨app.tsï¼Œ

```ts
onPageChange: () => {
    const { location } = history;
    if (LOGIN_WHITE_LIST.includes(location.pathname)){
        return; // å¦‚æœå‡ºç°åœ¨ç™½åå•ä¸­ï¼Œåˆ™ä¸é‡å®šå‘
    }
    // å¦‚æœæ²¡æœ‰ç™»å½•ï¼Œé‡å®šå‘åˆ° login
    if (!initialState?.loginUser) {
        history.push(loginPath);
    }
},
```

è¿˜æœ‰ï¼Œè¿™ä¸ªinitialStateæ˜¯å’Œumiç³»ç»Ÿç®¡ç†çš„ï¼Œä¸è¦éšä¾¿æ”¹ï¼Œè¿™é‡Œè¸©äº†å¾ˆä¹…å‘

åŒ…æ‹¬ä¸é™äºUnhandled Rejection (Error): register failed, invalid key getInitialState from plugin çœ‹.umiæ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰plugin-initialState

```java
export async function getInitialState(): Promise<InitialState> {
  // å½“é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè·å–è¦å…¨å±€ä¿å­˜çš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯
  const state: InitialState = {
    // åˆå§‹åŒ–ç”¨æˆ·ç™»å½•çš„çŠ¶æ€ï¼Œåˆå§‹å€¼è®¾ä¸º undefined
    loginUser: undefined,
    settings: Settings,
  }
  if (LOGIN_WHITE_LIST.includes(history.location.pathname)) {
    return state;
  }

  try {
    // è°ƒç”¨ getLoginUserUsingGET() æ–¹æ³•ï¼Œå°è¯•è·å–å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯
    const res = await getLoginUserUsingGet();
    // å¦‚æœä»åç«¯è·å–çš„æ•°æ®ä¸ä¸ºç©ºï¼Œåˆ™æŠŠè·å–åˆ°çš„ç”¨æˆ·æ•°æ®èµ‹ç»™state.loginUser
    if (res.data) {
      state.loginUser = res.data;
    }
  // å¦‚æœåœ¨è·å–ç”¨æˆ·ä¿¡æ¯çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œå°±æŠŠé¡µé¢é‡å®šå‘åˆ°ç™»å½•é¡µé¢
  } catch (error) {
    history.push(loginPath);
  }
  // è¿”å›ä¿®æ”¹åçš„çŠ¶æ€
    return state;
  };
```

é‡åˆ°çš„é—®é¢˜ï¼šæ¥å£è¢«æ‹¦æˆª

åç«¯çš„æ‹¦æˆªå™¨è¦è®¾ç½®ä¸æ‹¦æˆªç™»å½•ã€ä¸‹çº¿ã€æ³¨å†Œè¿™äº›è¯·æ±‚ã€‚

> å®ç°é‚®ç®±æ³¨å†Œå’Œç™»å½•

æµç¨‹å‚è€ƒï¼šå›¾ç‰‡æ¥æº[Springboot----å®ç°é‚®ç®±éªŒè¯ç ç™»å½•(ä»£ç éƒ¨åˆ†)_springbootå®ç°é‚®ç®±éªŒè¯ç ç™»å…¥-CSDNåšå®¢](https://blog.csdn.net/weixin_45750572/article/details/125467669)

![](https://github.com/polarisronx/Papi-backend/doc/images/c62d13dcf1654c20a31a4e2a9c86b2d6.png)

**é‡åˆ°çš„é—®é¢˜ï¼šknife4j æ— æ³•è®¿é—®ã€‚**

åŸå› 1ï¼šæ²¡åŠ å‰ç¼€/api

åŸå› 2ï¼šæ‹¦æˆªå™¨æ‹¦æˆª

åŸå› 3ï¼šæ²¡å¼€æ”¾èµ„æºï¼šåœ¨mvcConfig[knif4j è®¿é—®ä¸äº†_knife4j-springdoc-ui ä½¿ç”¨ä¸èµ·ä½œç”¨-CSDNåšå®¢](https://blog.csdn.net/lu1171901273/article/details/118227078)

```java
@Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("doc.html")
                .addResourceLocations("classpath:/META-INF/resources/");
        // å¯åŠ¨æˆåŠŸï¼Œè®¿é—®æŠ¥jsæ‰¾ä¸åˆ°çš„é—®é¢˜  å¼•å…¥ä¸‹é¢çš„é…ç½®
        registry.addResourceHandler("/webjars/**").addResourceLocations(
                "classpath:/META-INF/resources/webjars/");
    }
```

åŸå› 5ï¼šé…ç½®å†²çªæˆ–è¦†ç›–ï¼Œåœ¨configæ–‡ä»¶å†™äº†é…ç½®ï¼Œåœ¨ymlé‡Œä¹Ÿå†™äº†

åœ¨ymlé‡Œé…å°±å¯ä»¥äº†ï¼Œ

```java
# springdoc-openapié¡¹ç›®é…ç½®
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: default
      paths-to-match: '/**'
      packages-to-scan: com.polaris.project.controller
knife4j:
  enable: true
  setting:
    language: zh_cn
```

åŸå› 6ï¼šä¸€äº›ç‰ˆæœ¬çš„åŸå› ï¼šä¼šæŠ¥No OpenAPI resource found for group: swagger-configé”™è¯¯

[No OpenAPI resource found for group: swagger-config | Knife4j (xiaominfo.com)](https://doc.xiaominfo.com/docs/faq/v4/knife4j-no-openapi)

```java
<!--å†æ·»åŠ ä¸€ä¸ªjar-->
<dependency>
  <groupId>org.springdoc</groupId>
  <artifactId>springdoc-openapi-ui</artifactId>
  <!--ä¿æŒç‰ˆæœ¬ä¸Knife4j v4.0çš„ç‰ˆæœ¬ä¸€è‡´ï¼Œé¿å…jaråŒ…å†²çªï¼Œå› ä¸ºKnife4j-v4.0.0ç‰ˆæœ¬ä¾èµ–çš„springdocç‰ˆæœ¬æ˜¯1.6.9 -->
  <version>1.6.9</version>
</dependency>
```

è¿˜éœ€è¦åŠ ä¸€ä¸ªjaråŒ…

**é‡åˆ°çš„é—®é¢˜ï¼šé‚®ç®±æœåŠ¡é…ç½®**

åŸå› 1ï¼šåŒ5ï¼Œåœ¨ymlå’Œconfigéƒ½å†™äº†é…ç½®ï¼Œä½†æœ‰å†²çªæˆ–éƒ½æ²¡å†™å…¨ã€‚

åŸå› 2ï¼šè¿æ¥ä¸»æœºå¤±è´¥ï¼šæ”¹ä¸ºsslè¿æ¥ï¼Œåè®®smtpsï¼Œç«¯å£465ï¼Œè¿˜æœ‰hostæ˜¯smtp.qq.comä¸æ˜¯æœ¬æœºlocalhost

```yml
  # é‚®ç®±ç™»å½•é…ç½®
  mail:
    #smtpæœåŠ¡ä¸»æœº  qqé‚®ç®±åˆ™ä¸ºsmtp.qq.com
    host: smtp.qq.com
    port: 465
    #æœåŠ¡åè®®
    protocol: smtps
    # ç¼–ç é›†
    default-encoding: UTF-8
    #å‘é€é‚®ä»¶çš„è´¦æˆ·
    username: 907830201@qq.com
    #æˆæƒç 
    password: kiuppzxdnxelbdbg
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          ssl:
            enable: true
          socketFactory:
            port: 465
            class: javax.net.ssl.SSLSocketFactory
```

[Got bad greeting from SMTP host: smtp.163.com, port: 465, response: [EOF\] - æ¥¼å…°èƒ¡æ¨ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/east7/p/13406120.html)

[ä½¿ç”¨SpringBoot + JavaMailSender å‘é€é‚®ä»¶æŠ¥é”™ Mail server connection failedï¼›Could not connect to SMTP host_org.springframework.mail.mailsendexception: mail s-CSDNåšå®¢](https://blog.csdn.net/qq_39128430/article/details/133099368)

**æœ‰ä¸€ä¸ªBug**ï¼Œå°±æ˜¯æ³¨å†Œå’Œç™»å½•ç”¨çš„åŒä¸€ä¸ªé‚®ç®±éªŒè¯ç ï¼Œç„¶ååŸå…ˆæ˜¯è®¾è®¡é‚®ç®±éªŒè¯ç è¿‡æœŸå‰ç”¨æˆ·ä¸èƒ½å†æ¬¡è·å–éªŒè¯ç ï¼Œç”¨æˆ·æ³¨å†Œå®Œè¦ç”¨ä¹‹å‰çš„éªŒè¯ç ï¼Œä½†ä¸€èˆ¬çš„ä¹ æƒ¯éƒ½æ˜¯å†è·å–ä¸€ä¸ªã€‚

Redisçš„setå¯ä»¥è¦†ç›–å·²æœ‰çš„å€¼ã€‚æ‰€ä»¥ä¸éœ€è¦é™åˆ¶è¿‡æœŸå‰ä¸èƒ½å†æ¬¡è·å–ã€‚

**é‡åˆ°çš„é—®é¢˜ï¼šä¸€ä¸ªå¤©å‘ï¼**åœ¨é€€å‡ºç™»å½•çš„æ—¶å€™ï¼Œå‰ç«¯è¦æ¶ˆé™¤ç™»å½•æ€å¹¶ä¸”æ¸…é™¤Cookieï¼Œä½†æ˜¯ç”¨js-cookieçš„æ—¶å€™æ­»æ´»è¯´æ²¡æœ‰removeå±æ€§

Unhandled Rejection (TypeError): Cannot read property of undefined (reading remove)

**è§£å†³ï¼š**æŠŠremoveå°è£…åˆ°ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œæ²¡æœ‰ç›´æ¥ä½¿ç”¨å°±è¡Œäº†ï¼Œåº”è¯¥æ˜¯å‰ç«¯è‡ªå·±çš„é—®é¢˜ã€‚

```ts
export const delCookie = (label:string) => {
  Cookies.remove(label)
}

delCookie('token');
```

## æ‹“å±•7ï¼šBITMAP ç”¨æˆ·ç­¾åˆ°å’Œç§¯åˆ†å¥–åŠ±

æ–°å¢å­—æ®µï¼šç”¨æˆ·ç§¯åˆ†

> BITMAP ç”¨æˆ·ç­¾åˆ°åŠŸèƒ½

ç”±äºç­¾åˆ°ä¸ç§¯åˆ†å¥–åŠ±ç›´æ¥æŒ‚é’©ï¼Œé˜²æ­¢ç”¨æˆ·æ¶æ„åˆ·å–ï¼Œè®¾ç½®äº†åŸºäºredissonçš„åˆ†å¸ƒå¼é”ã€‚

åŸºäºRedisçš„BITMAPä½å›¾æ¥å®ç°ç”¨æˆ·ç­¾åˆ°ã€‚

ç”¨æˆ·ç­¾åˆ°æ£€æµ‹ï¼Œå¦‚æœæœªç­¾åˆ°è¿”å›-1ï¼Œå¦‚æœå·²ç»ç­¾åˆ°ç»Ÿè®¡ç”¨æˆ·çš„ç­¾åˆ°å¤©æ•°ã€‚

## æ‹“å±•8ï¼šCafferine&Redis äºŒçº§ç¼“å­˜

1. æœ¬åœ°ç¼“å­˜

ä½¿ç”¨caffeineç¼“å­˜æ¡†æ¶ï¼Œä½¿ç”¨Springçš„é›†æˆCacheManagerã€‚

```java
@Configuration
public class CacheManagerConfig {
    @Bean
    public CacheManager cacheManager(){
        CaffeineCacheManager cacheManager=new CaffeineCacheManager();
        cacheManager.setCaffeine(Caffeine.newBuilder()
                .initialCapacity(128)
                .maximumSize(1024)
                .expireAfterWrite(60, TimeUnit.SECONDS));
        return cacheManager;
    }
}
```



2. Redisåˆ†å¸ƒå¼ç¼“å­˜

ç”¨æˆ·ä¿¡æ¯ç»å¸¸éœ€è¦ç”¨åˆ°ï¼Œæ¯æ¬¡éƒ½æŸ¥æ•°æ®åº“æ€§èƒ½å¤ªå·®ã€‚

æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·æ—¶ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æ•°æ®åº“ç»“æœå†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚

æ ¹æ®idä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚ï¼ˆæ›´æ–°åŠ¨ä½œå®é™…ä¸Šåªæœ‰æœ€åä¸€æ¬¡ç”Ÿæ•ˆï¼Œä¸­é—´çš„æ›´æ–°åŠ¨ä½œæ„ä¹‰å¹¶ä¸å¤§ï¼‰

æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·æ—¶ï¼Œå¦‚æœæŸ¥ä¸åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œä¸ºé˜²æ­¢ç¼“å­˜ç©¿é€ï¼Œå°†ç©ºå€¼æ’å…¥åˆ°Redisã€‚

ç”¨æˆ·æŸ¥è¯¢ç¼“å­˜

```java
/**
* è·å–å½“å‰ç™»å½•ç”¨æˆ·
*
*/
@Override
public UserVO getLoginUser() {
    //ä»çº¿ç¨‹åŸŸå–å‡ºç”¨æˆ·ä¿¡æ¯
    UserDTO user = UserHolder.getUser();
    throwIf(user == null, ErrorCode.NOT_LOGIN_ERROR);
    // æŸ¥è¯¢ç¼“å­˜(è€ƒè™‘ç¼“å­˜ç©¿é€ï¼‰
    User userEntity = cacheClient.queryWithPassThrough(CACHE_LOGIN_USER, user.getId(), User.class, this::getUserById, CACHE_LOGIN_USER_TTL, TimeUnit.MINUTES);
    throwIf(userEntity == null, ErrorCode.OPERATION_ERROR, "ç”¨æˆ·ä¸å­˜åœ¨");
    return BeanUtil.copyProperties(userEntity, UserVO.class);
}
```

æ ¹æ®idæ’ç”¨æˆ·çš„æ–¹æ³•ä½¿ç”¨æœ¬åœ°ç¼“å­˜

```java
@Cacheable(value = "user", key = "'userId:'+#userId")
@Override
public User getUserById (Long userId){
    return getById(userId);
}
```

æ‹“å±•ï¼šé»‘åå•é™æµ



## æ‹“å±•9ï¼šVuepressæ­å»ºapi-doc

1. å®‰è£…äº†nvmå¯ç®¡ç†Nodeç‰ˆæœ¬

```powershell
nvm list available
nvm install version   //è¯·æŠŠversionæ¢æˆç‰ˆæœ¬å·ï¼Œåˆ«ç›´æ¥å¤åˆ¶
nvm install lts       //ä¸æƒ³è¾“ç‰ˆæœ¬å·ï¼Œå®‰è£…æœ€æ–°é•¿æœŸæ”¯æŒç‰ˆ
nvm use version       //åˆ‡æ¢ç‰ˆæœ¬ï¼Œè¯·æŠŠversionæ¢æˆç‰ˆæœ¬å·ï¼Œåˆ«ç›´æ¥å¤åˆ¶
nvm uninstall version  //å¸è½½æŒ‡å®šç‰ˆæœ¬nodeï¼Œè¯·ä¸è¦åœ¨å½“å‰nodeç‰ˆæœ¬æ‰§è¡Œ
```

2. é…ç½®äº†yarnçš„ç¯å¢ƒå˜é‡

   ä¹‹å‰æ²¡æœ‰é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸çŸ¥é“æ˜¯æ€ä¹ˆè¿‡æ¥çš„ã€‚yarnæ˜¯è£…åœ¨nodejsè·¯å¾„ä¸‹çš„

   [yarn ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤,ä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºï¼ˆäº²æµ‹å¯ç”¨ï¼‰_yarnä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤,ä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº-CSDNåšå®¢](https://blog.csdn.net/qq_16946803/article/details/108416526)

3. ç”¨æ›´ä¼˜é›…çš„vuepressæ¨¡æ¿vuepress-thrmr-reco

   å‚è€ƒä¸€ä¸‹è¿™ä¸ªäººæ­å»ºåšå®¢çš„ï¼Œä¹Ÿæ˜¯ç”¨çš„è¿™ä¸ªæ¡†æ¶

[ä¸ªäººåšå®¢æ­å»ºé‡å‘æµç¨‹ã®VuePress2 ğŸ“• - æ˜é‡‘ (juejin.cn)](https://juejin.cn/post/7140934570370662407)





[Vuepress 2ä»0-1ä¿å§†çº§å…¥é—¨æ•™ç¨‹â€”â€”æ–‡æ¡£é…ç½®ç¯‡_vuepress2-CSDNåšå®¢](https://blog.csdn.net/passwordgloo/article/details/129114625)



## æ‹“å±•10ï¼šDjango-LSTM-Feign-Nacosé¢„æµ‹æ¥å£

> ### æ¦‚å†µ

- pythonæ˜¯æ·±åº¦å­¦ä¹ ç®—æ³•æ›´é€‚åˆçš„è¿è¡Œç¯å¢ƒï¼ŒLSTMé•¿çŸ­æ—¶è®°å¿†ç¥ç»ç½‘ç»œæ¨¡å‹æ¥å£é‡‡ç”¨pythonå‰åç«¯å¼€å‘æ¡†æ¶Djangoå¼€å‘ã€‚

  - é¡¹ç›®åservice-django

  - é¡¹ç›®éƒ¨ç½²åœ°å€ï¼šlocalhost:8000

  - æ¥å£è·¯å¾„ï¼š/user/lstm_predict

  - è¯·æ±‚æ–¹æ³•ï¼šPOST

  - è¯·æ±‚å‚æ•°ï¼š

    - æ•°æ®æ–‡ä»¶ï¼š

      - è¯·æ±‚å‚æ•°åï¼š`excelData`æˆ–`csvData`

      - è¯·æ±‚æ–¹æ³•æ˜¯ `POST`ï¼Œå¹¶ä¸”å‘å¸ƒè¯·æ±‚çš„ `<form>` æœ‰ `enctype="multipart/form-data"` çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šåŒ…å«æ•°æ®

        å‚è€ƒ[è¯·æ±‚å’Œå“åº”å¯¹è±¡ | Django æ–‡æ¡£ | Django (djangoproject.com)](https://docs.djangoproject.com/zh-hans/3.2/ref/request-response/)

      - ç›®å‰æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ä¸ºcsvã€xlsx

      - å¤§å°ä¸è¶…è¿‡3M

      - æ•°æ®è¦æ±‚ï¼šç›®å‰ä»…æ”¯æŒå•æ­¥å•ç‰¹å¾é¢„æµ‹ï¼Œæ•°æ®å½¢å¦‚

    ```bash
    time	target
    2024.01  0.1
    2024.02  0.2
    2024.03  0.3
    ```

    - æ—¶é—´æ­¥time-step
      - æ•°æ®ç±»å‹ï¼šæ•´å‹ï¼ˆint)
      - æ¨èå€¼ï¼ˆé»˜è®¤å€¼ï¼‰ï¼š12
    - è®­ç»ƒæµ‹è¯•æ¯”ratio
      - æ•°æ®ç±»å‹ï¼šæµ®ç‚¹å‹ï¼ˆfloat)
      - æ¨èå€¼ï¼ˆé»˜è®¤å€¼ï¼‰ï¼š0.8
    - è½®æ¬¡epoch
      - æ•°æ®ç±»å‹ï¼šæ•´å‹ï¼ˆint)
      - æ¨èå€¼ï¼ˆé»˜è®¤å€¼ï¼‰ï¼š100
    - æ‰¹æ¬¡é‡batchSize
      - æ•°æ®ç±»å‹ï¼šæ•´å‹ï¼ˆint)
      - æ¨èå€¼ï¼ˆé»˜è®¤å€¼ï¼‰ï¼š32

  - è¿”å›ç»“æœï¼šæµ‹è¯•é›†çš„æµ‹è¯•ç»“æœï¼ˆmatplotlibç»˜åˆ¶çš„å›¾å½¢ï¼‰

    - æ•°æ®ç¼–ç æ ¼å¼ï¼šbase64

      å‚è€ƒ[Django + Matplotlibï¼šå®ç°æ•°æ®åˆ†ææ˜¾ç¤ºä¸ä¸‹è½½ä¸ºPDFæˆ–SVG_matplotlib django-CSDNåšå®¢](https://blog.csdn.net/weixin_41861301/article/details/134854798)

- åˆ©ç”¨nacosä½œä¸ºç»Ÿä¸€çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°ä¸­å¿ƒï¼Œdjango-projecté¡¹ç›®ä½œä¸ºæœåŠ¡æä¾›è€…å…¥é©»nacos

- springbooté¡¹ç›®ä½¿ç”¨openFeignè°ƒç”¨django-projecté¡¹ç›®çš„æ¥å£

  - æ¥å£è·¯å¾„ï¼š/api/v2/dl/lstm

- lstmç®—æ³•å‚è€ƒï¼š[ã€Pythonæ—¶åºé¢„æµ‹ç³»åˆ—ã€‘åŸºäºLSTMå®ç°å•å˜é‡æ—¶é—´åºåˆ—é¢„æµ‹ï¼ˆæºç ï¼‰_å•å˜é‡æ—¶é—´åºåˆ—é¢„æµ‹ lstm-CSDNåšå®¢](https://blog.csdn.net/sinat_41858359/article/details/135904507)

> ### é‡åˆ°çš„é—®é¢˜

> 1 å“åº”æ•°æ®æ ¼å¼

æœ¬æ¥æ˜¯æƒ³åœ¨pythonç«¯ä¹Ÿç»Ÿä¸€å®šä¹‰ä¸€ä¸ªBaseResponseæ¥ä½œä¸ºè¿”å›æ•°æ®ç±»å‹çš„ï¼Œä½†æ˜¯pythonä¸­ä¸å¦‚Javaä¸­æ–¹ä¾¿ï¼ˆå¯èƒ½æ˜¯æˆ‘å­¤é™‹å¯¡é—»ï¼‰ç”¨æˆ·è‡ªå®šä¹‰ç±»æ˜¯ä¸èƒ½åºåˆ—åŒ–çš„ï¼Œè¿™æ ·ä¸èƒ½ç”¨äºæ•°æ®ä¼ è¾“ã€‚æ‰€ä»¥è¿˜æ˜¯ç”¨çš„ JsonResponseã€‚

å¦‚æœè¿”å›ä¸€ä¸ªUserçš„å®ä¾‹ï¼Œè¿™æ—¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç›´æ¥è¿”å›ä¼šæŠ¥æ— æ³•åºåˆ—åŒ–çš„é”™ï¼Œé‡‡ç”¨Djangoçš„model_to_dictå°†æ•°æ®è½¬æ¢ä¸ºå­—å…¸ç±»å‹ã€‚***AttributeError: â€˜Userâ€˜ object has no attribute â€˜getâ€˜***

```python
json_user = model_to_dict(new_user)
```

è®°å½•ä¸€ä¸‹å…¶ä»–çš„åºåˆ—åŒ–æ–¹æ³•

```python
'''
    æŸ¥è¯¢æ‰€æœ‰çš„ç”¨æˆ·å¯¹è±¡
'''
    queryset = models.User.objects.all()
# æ–¹æ³•ä¸€
    data = []
    # åœ¨modelä¸­æ‰‹åŠ¨å†™ä¸€ä¸ªæ–¹æ³•èƒ½è¿”å›å¯¹è±¡çš„ç”¨å­—å…¸å½¢å¼è¡¨è¾¾
    # è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹å°±æ˜¯ï¼š
    # å¦‚æœå­—æ®µå¤šäº†çš„è¯ï¼Œå°±éœ€è¦ä¸€ä¸ªä¸€ä¸ªå»å†™ï¼Œä¼šå¾ˆéº»çƒ¦
    # è¿”å›çš„æ˜¯å­—å…¸ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦jsonè½¬æ¢æˆjsonæ ¼å¼å­—ç¬¦ä¸²
    for i in queryset:
        p_tmp = {
            "name": i.name,
            "address": i.address
        }
        data.append(p_tmp)

    import json
    return HttpResponse(json.dumps(data), content_type='application/json')
# æ–¹æ³•äºŒ
    data = []
    # djangoè‡ªå¸¦çš„æ¨¡å‹è½¬å­—å…¸æ–¹æ³•
    # ç¼ºç‚¹å°±æ˜¯å›¾ç‰‡ä¹‹ç±»çš„æ–‡ä»¶æ— æ³•è½¬æ¢
    # è¿”å›çš„æ˜¯å­—å…¸ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦jsonè½¬æ¢æˆjsonæ ¼å¼å­—ç¬¦ä¸²
    from django.forms.models import model_to_dict
    for i in queryset:
        data.append(model_to_dict(i))
    import json
    return HttpResponse(json.dumps(data), content_type='application/json')
# æ–¹æ³•ä¸‰
    # å¯¼å…¥djangoè‡ªå¸¦çš„åºåˆ—åŒ–å™¨
    from django.core import serializers
    data = serializers.serialize('json', queryset)
    return HttpResponse(data, content_type='application/json')
```

å‚è€ƒ [Django:åºåˆ—åŒ–çš„å‡ ç§æ–¹æ³• - ç§‹å¯»è‰ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/gcgc/p/11320636.html)

> 2 è¯·æ±‚æ•°æ®æ ¼å¼

è¯·æ±‚æ•°æ®æ˜¯ç”¨application/jsonçš„æ ¼å¼å‘é€çš„ï¼Œç”¨request.POST.get(ï¼‰è·å–ä¸åˆ°æ•°æ®

[djangoæ¡†æ¶request.POST.get(ï¼‰è·å–ä¸åˆ°æ•°æ®_django request.post.get æ‹¿ä¸åˆ°æ•°æ®-CSDNåšå®¢](https://blog.csdn.net/ezreal_tao/article/details/103266508)

> 3 Javaç«¯æ¥å—å“åº”æ•°æ®

pythonç«¯å½±å“çš„æ•°æ®æ˜¯JSONç±»å‹ï¼Œä¸èƒ½ç”¨å¯¹è±¡æ¥æ¥æ”¶ï¼Œæ‰€ä»¥ç”¨äº†ä¸€ä¸ªhashmapé›†åˆæ¥æ¥æ”¶

```java
@PostMapping ("user/register")
HashMap<String,Object> userRegister(@RequestBody RegisterRequest registerRequest);
```

> 4 Feignçš„è¸©å‘

***1 No Feign Client for loadBalancing defined. Did you forget to include spring-cloud-starter-loadbalancer?***

ç”±äºSpringCloud Feigné«˜ç‰ˆæœ¬ä¸ä½¿ç”¨Ribbonè€Œæ˜¯ä½¿ç”¨spring-cloud-loadbalancerï¼Œæ‰€ä»¥éœ€è¦å¼•ç”¨spring-cloud-loadbalanceræˆ–è€…é™ç‰ˆæœ¬

```xml
<!--ä½¿ç”¨Spring Cloud LoadBalancer è¿›è¡Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-loadbalancer</artifactId>
</dependency>
```

***2 SpringCloud FeignæŠ¥é”™ï¼šMethod has too many Body parameters***

[Method has too many Body parametersçš„å¤„ç†åŠæ³•-CSDNåšå®¢](https://blog.csdn.net/haishiyizhenfeng/article/details/80607003)

feignä¼ å‚å¿…é¡»åŠ æ³¨è§£ï¼

***3 resolved [org.springframework.web.httpmediatypenotsupportedexception:content type 'application/x-www-form-urlencoded;charset=utf-8' not supported]***

æ•°æ®æ ¼å¼ä¸æ”¯æŒï¼Œå¯èƒ½æ˜¯application/json æ­¤ç±»æ•°æ®æ ¼å¼ä¸ä¸€è‡´ï¼Œä¹Ÿå¯èƒ½æ˜¯å‚æ•°åå†™é”™ã€‚

***4 Caused by: java.lang.IllegalStateException: Body parameters cannot be used with form parameters.***

```java
@PostMapping("/user/lstm_predict")
    HashMap<String,Object> lstmPredictExcel(@RequestBody LstmPredictRequest lstmPredictRequest,@RequestPart(value = "file") MultipartFile excelData);
```

æ–¹æ³•çš„å‚æ•°é¡ºåºé¢ å€’å°±ä¼šæŠ¥é”™ã€‚

***5 Content type â€˜multipart/form-dataï¼›boundary=ï¼›charset=UTF-8â€˜ not supported***

multipart/form-dataæ˜¯é”®å€¼å¯¹çš„å½¢å¼ä¼ é€’çš„ï¼Œç”¨@RequestBodyåº”è¯¥ç”¨Jsonçš„rawä¼ å‚ã€‚

å»æ‰@RequestBodyï¼ŒspringMVCä¼šè‡ªåŠ¨å°†é”®å€¼å±æ€§ç»„è£…åˆ°LstmPredictRequest

***6 2024-06-13 09:29:23.729 ERROR 19388 --- [nio-8123-exec-2] o.a.c.c.C.[.[.[.[dispatcherServlet]      : Servlet.service() for servlet [dispatcherServlet] in context with path [/api] threw exception [Request processing failed; nested exception is feign.codec.EncodeException: Error converting request body] with root cause***

***com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class java.io.FileDescriptor and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: java.util.LinkedHashMap["file"]->org.springframework.web.multipart.support.StandardMultipartHttpServletRequest$StandardMultipartFile["inputStream"]->java.io.FileInputStream["fd"])***

åºåˆ—åŒ–æ—¶å‡ºé”™ã€‚feignä¸æ”¯æŒæ–‡ä»¶ä¼ è¾“çš„åŸå› æ˜¯åœ¨å¯¹Formå‚æ•°è¿›è¡Œç¼–ç æ—¶ï¼Œæ²¡æœ‰é»˜è®¤çš„HttpMessageConverterså¯¹Formæ ¼å¼çš„å‚æ•°è¿›è¡Œç¼–ç è½¬æ¢ï¼Œéœ€è¦è‡ªå·±æ³¨å…¥é…ç½®ã€‚

å‚è€ƒ[åŸºäºFeignçš„å¾®æœåŠ¡æ–‡ä»¶ä¸å¤æ‚å‚æ•°ä¼ è¾“_@feignclient ä¼ é€’æ–‡ä»¶å’Œå¤šä¸ªå‚æ•°-CSDNåšå®¢](https://blog.csdn.net/m_sophia/article/details/118940609)

```java
@Configuration
public class MultipartSupportConfig {
    @Autowired
    private ObjectFactory<HttpMessageConverters> messageConverters;
    /**
     * override a new FormEncoder to match complex param
     * param include properties and MultipartFile
     * @return
     */
    @Bean
    Encoder feignFormEncoder() {
        return new SpringFormEncoder(new SpringEncoder(messageConverters));
    }
}
```

***7 Load balancer does not contain an instance for the service service-django***

pythoné¡¹ç›®ç›¸å¯¹ç‰¹æ®Šï¼Œå¦‚ä½•è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸å¤ªäº†è§£ã€‚è¿™é‡Œæ˜¯å•å®ä¾‹ï¼Œä¸å»ç»†ç©¶ã€‚æŒ‡å®šæœåŠ¡çš„URL

```java
@FeignClient(value = "service-django",url = "http://127.0.0.1:8000/")
```

***8 Feign Timeout***

æ¨¡å‹è®­ç»ƒè€—æ—¶å¾ˆé•¿ï¼Œè®¾ç½®feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´

```yaml
feign:
  client:
    config:
      default:
        connectTimeout: 600000 # è®¾ç½® Feign å®¢æˆ·ç«¯çš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ä¸ºæ¯«ç§’ï¼‰
        readTimeout: 600000    # è®¾ç½® Feign å®¢æˆ·ç«¯çš„è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ä¸ºæ¯«ç§’ï¼‰
```

> 5 feignã€nacosã€springbootç‰ˆæœ¬åŒ¹é…

æ¯”è¾ƒæ¨èçš„æ–¹æ³•æ˜¯ç”¨dependencyManagementæŒ‡å®šspringbootã€cloudå’Œcloud alibabaçš„å¤§ç‰ˆæœ¬ï¼Œç„¶åä¸‹é¢ä¸ç”¨è‡ªå·±æŒ‡å®šfeignè¿™äº›ç»„ä»¶çš„ç‰ˆæœ¬ï¼Œä¸ç„¶ä¼šéå¸¸éº»çƒ¦ã€‚

> 6 pythoné¡¹ç›®æ³¨å†Œåˆ°nacos

ç”¨äº†ä¸€ä¸ªGitHubä¸Šçš„ç½‘å‹çš„ç»„ä»¶python-nacos-client

> 7 DjangoæŠ¥é”™

djangoä¸­é‡åˆ°é”™è¯¯ï¼š***1 Forbidden CSRF cookie not set***

è¿™ä¸ªæ˜¯é˜²æ­¢CSRFæ”»å‡»çš„æ£€æŸ¥ï¼Œç®€å•è§£å†³ï¼šå…³é—­

æ³¨é‡Šæ‰`django.middleware.csrf.CsrfViewMiddleware`

[djangoä¸­é‡åˆ°é”™è¯¯ï¼šForbidden CSRF cookie not set-å¤©ç¿¼äº‘ (ctyun.cn)](https://www.ctyun.cn/zhishi/p-376156)

***UnicodeDecodeError: 'utf-8' codec can't decode byte 0x87 in position 207: invalid start byte***

åŸå› ï¼šdjangoæ¡†æ¶æˆ‘ä¸å¤ªç†Ÿæ‚‰ï¼Œåªèƒ½æ˜¯debugã€‚å‘ç°æŠ¥é”™çš„æ—¶

```python
json.loads(request.body)
```

å‘ç°Bodyé‡Œæ”¾çš„æ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸æ˜¯utf-8è‡ªç„¶ä¸èƒ½ç¼–ç ã€‚è€Œä¸”å‘ç°request.GETå’Œrequest.GETé‡Œéƒ½æ²¡æœ‰å‚æ•°ï¼ˆæ­¤æ—¶javaç«¯çš„è¯·æ±‚ç»“æ„å¦‚ä¸‹ï¼ŒLstmPredictRequestå› ä¸ºä¹‹å‰çš„æŠ¥é”™å»æ‰äº†@RequestBodyï¼‰

```java
@PostMapping(value = "/user/lstm_predict", consumes = MediaType.MULTIPART_FORM_DATA_VALUE, produces = {MediaType.APPLICATION_JSON_VALUE})
    HashMap<String,Object> lstmPredictExcel(LstmPredictRequest lstmPredictRequest, @RequestPart(value = "file") MultipartFile excelData);
```

è§£å†³ï¼šå‘ç°ç»™lstmPredictRequeståŠ @RequestParamæ³¨è§£åœ¨pythonçš„djangoç«¯èƒ½åœ¨request.GETé‡Œè·å–ã€‚ä½†æ­¤æ—¶æ˜¯å¯¹è±¡ï¼Œä¼ åˆ°djangoå°±å˜å­—ç¬¦ä¸²äº†ï¼Œåº”è¯¥è½¬ä¸ºJsonä¸²ä¼ è¾“ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240613120433.png)

```java
//controller
@PostMapping("/lstm")
public LstmPredictResponse lstmPredict(@RequestPart(value = "file") MultipartFile multipartFile,LstmPredictRequest lstmPredictRequest){
    HashMap<String, Object> map =StringUtils.endsWithIgnoreCase(multipartFile.getOriginalFilename(), FileType.EXCEL.value)?
        lstmPredictor.lstmPredictExcel(JSONUtil.toJsonStr(lstmPredictRequest), multipartFile)
        : lstmPredictor.lstmPredictCsv(JSONUtil.toJsonStr(lstmPredictRequest),multipartFile);
    return new LstmPredictResponse((String)map.get("predictResult"));
}
//service
@PostMapping(value = "/user/lstm_predict", consumes = MediaType.MULTIPART_FORM_DATA_VALUE, produces = {MediaType.APPLICATION_JSON_VALUE})
    HashMap<String,Object> lstmPredictExcel(@RequestParam String lstmPredictRequest, @RequestPart(value = "file") MultipartFile excelData);
```

æ–¹æ³•ä¸è®²ç©¶é«˜æ˜ï¼Œèƒ½ç”¨å°±å¥½ã€‚

> ### å®æµ‹

å‰ç«¯è¿˜æœªå®Œå–„ï¼Œç°ä½¿ç”¨Postmanæµ‹è¯•ï¼Œå‘springbooté¡¹ç›®å‘èµ·è¯·æ±‚ï¼Œèƒ½å¾—åˆ°Djangoé¡¹ç›®çš„è¿”å›ç»“æœã€‚

![ ](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240613160611.png)

> ### å‰ç«¯å®Œå–„ï¼Œå®é™…éƒ¨ç½²

è¿™éƒ¨åˆ†èŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œè°ƒBugè°ƒåˆ°æ€€ç–‘äººç”Ÿã€‚

ç®€å•æ€»ç»“é‡åˆ°çš„é—®é¢˜

1. åŸå…ˆçš„sdkä¸æ”¯æŒå¸¦æœ‰æ–‡ä»¶çš„æ¥å£

ä¿®æ”¹åç«¯

- æ¥æ”¶å‚æ•°

è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸å›°æ‰°çš„é—®é¢˜ï¼Œå°±æ˜¯æ–‡ä»¶å’Œè¯·æ±‚å‚æ•°å¦‚æœéƒ½æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œå°±ä¸èƒ½ç”¨åŸå…ˆçš„`@RequestBody`æ³¨è§£ï¼ˆè·å–Jsonç­‰æ–‡æœ¬å½¢å¼ä¼ é€’çš„æ•°æ®ï¼‰æ¥è·å–äº†ï¼Œä¸€å¼€å§‹éå¸¸æƒ³å½“ç„¶ï¼Œæ¥æ”¶æ–‡ä»¶éœ€è¦ç”¨`@RequestPart`,å°±ç”¨äº†

```java
public BaseResponse<Object> invokeInterfaceInfo(@RequestPart(value="file",required=false)MultipartFile file,@RequestBody InvokeRequest invokeRequest){
    }
```

ä½†è¿™æ˜¾ç„¶ä¸è¡Œï¼Œè®¸ç”¨ç»Ÿä¸€ç”¨application/form-dataçš„å½¢å¼æ¥æ”¶ï¼Œ@RequestPartå’Œ@RequestParaméƒ½å¯ä»¥ç”¨äºè·å–é”®å€¼ç±»å‹çš„æ•°æ®ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240619164036.png)

- æ ¡éªŒæ–‡ä»¶æ ¼å¼

ç°åœ¨å…ˆåªæ”¯æŒä¸¤ç§ç±»å‹çš„æ•°æ®

```java
String suffix = null;
String originalFilename = null;
if (file != null) {
    // æ ¡éªŒæ–‡ä»¶
    long size = file.getSize();
    originalFilename = file.getOriginalFilename();
    // æ ¡éªŒæ–‡ä»¶å¤§å°
    final long ONE_MB = 1024 * 1024L;
    ThrowUtils.throwIf(size > ONE_MB, ErrorCode.PARAMS_ERROR, "æ–‡ä»¶è¶…è¿‡ 3M");
    // æ ¡éªŒæ–‡ä»¶åç¼€
    suffix = FileUtil.getSuffix(originalFilename);
    final List<String> validFileSuffixList = Arrays.asList("xlsx", "csv");
    ThrowUtils.throwIf(!validFileSuffixList.contains(suffix), ErrorCode.PARAMS_ERROR, "ç›®å‰ä»…æ”¯æŒxlsxå’Œcsvæ–‡ä»¶");
}
```

- Requestæºå¸¦æ–‡ä»¶

ï¼ˆè¿™é‡Œçš„Requestæ˜¯æ¥å£çš„è¯·æ±‚å‚æ•°å°è£…ç±»ï¼Œåœ¨æ¥å£è°ƒç”¨ã€SDKç­‰ç¯å¢ƒä¸­éœ€è¦ä½¿ç”¨ï¼Œä¸åŒçš„æ¥å£å°è£…æœ‰ä¸åŒRequestç±»ï¼Œä¹Ÿæœ‰æ–¹ä¾¿ç³»ç»Ÿæ‰§è¡Œç”¨çš„é€šç”¨CommonRequestï¼‰è¿™é‡Œä¸ºäº†é€‚é…æºå¸¦æ–‡ä»¶çš„ä¿¡æ¯ï¼Œåœ¨AbstractRequestä¸­æ·»åŠ äº†å­˜å‚¨æ–‡ä»¶å’Œæ–‡ä»¶åå¯¹åº”å…³ç³»çš„å­—æ®µã€‚

```java
public abstract class AbstractRequest<T extends CommonResponse> {
    public Map<String,String> header = new HashMap<>();
    public Map<String, Object> customizedParams = new HashMap<>();
    public Map<String,MultipartFile> files = new HashMap<>();
    public String info;// ç”¨äºå¿…è¦æ—¶ä¼ é€’ä¸€äº›å‚æ•°
    private boolean skipSign = false;
    private boolean isUnsignedPayload;
    public String method; // å…¨å¤§å†™
    public String path;
```

- papiClientè°ƒç”¨

å•ä¸ªæ¥å£è°ƒç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„Requestå°è£…ç±»ï¼Œè€Œå¯¹äºç³»ç»Ÿéœ€è¦ç”¨é€šç”¨çš„CommonRequest

```java
// CommonRequest éœ€è¦åšä¸€äº›æ•°æ®è½¬æ¢
public LstmPredictResponse lstmPredict(CommonRequest commonRequest) throws PapiClientSDKException, IOException{
    LstmPredictRequest lstmPredictRequest = new LstmPredictRequest(commonRequest.getMethod(), commonRequest.getPath(), commonRequest.getCustomizedParams());
    lstmPredictRequest.setCustomField(commonRequest.getCustomizedParams());
    lstmPredictRequest.setInfo(commonRequest.getInfo());
    lstmPredictRequest.setFiles(commonRequest.files);
    lstmPredictRequest.setFile(commonRequest.files.get(commonRequest.getInfo()).getBytes());
    return call(lstmPredictRequest,"lstmPredict");
}
// ç›´æ¥ç”¨å¯¹åº”çš„Requestæ›´å¿«é€Ÿï¼
public LstmPredictResponse lstmPredict(LstmPredictRequest lstmPredictRequest) throws PapiClientSDKException{
    return call(lstmPredictRequest,"lstmPredict");
}
```

- SDKä¸­å‘èµ·httpè¯·æ±‚é’ˆå¯¹ä¸åŒç±»å‹çš„è°ƒæ•´

è¿™é‡Œåˆæœ‰ä¸€ä¸ªéå¸¸è¿·æƒ‘çš„åœ°æ–¹ï¼Œå°±æ˜¯åŸå…ˆæ˜¯ç”¨äº†hutoolçš„httpRequestï¼Œä»£ç æ²¡æœ‰ä¿å­˜ï¼Œç±»ä¼¼äº

```java
//é“¾å¼æ„å»ºè¯·æ±‚
String result2 = HttpRequest.post(url)
	.header(Header.USER_AGENT, "Hutool http")//å¤´ä¿¡æ¯ï¼Œå¤šä¸ªå¤´ä¿¡æ¯å¤šæ¬¡è°ƒç”¨æ­¤æ–¹æ³•å³å¯
	.form(paramMap)//è¡¨å•å†…å®¹
	.timeout(20000)//è¶…æ—¶ï¼Œæ¯«ç§’
	.execute().body();
Console.log(result2);
```

æŠŠæ–‡ä»¶æˆ–è¯·æ±‚å‚æ•°æ”¾åœ¨form()ä¸­ï¼Œä½†å¾ˆå¥‡æ€ªæ¥æ”¶æ•°æ®çš„é¡¹ç›®é‚£è¾¹æ­»æ´»æ‹¿ä¸åˆ°æ–‡ä»¶ï¼Œä¸ç®¡æ˜¯ç”¨@RequestPartè¿˜æ˜¯@RequestParamã€‚æœ€åæ”¹ç”¨äº†OKHttpæ¡†æ¶ï¼Œè¿™ä¸ªæ¡†æ¶ä½¿ç”¨èµ·æ¥æ²¡æœ‰hutoolæ–¹ä¾¿ï¼Œä½†æ˜¯æ¯”è¾ƒçµæ´»ï¼Œå’Œhttpè¯·æ±‚çš„ä¸€äº›utilsä¹Ÿæ¯”è¾ƒé½å…¨ã€‚

```java
switch (requestMethod) {
    // å¯¹äºgetè¯·æ±‚ï¼Œè¯·æ±‚å‚æ•°ç›´æ¥åŠ åœ¨URLåé¢
    case "GET": {
        httpRequest = new Request.Builder().url(url + "?" + canonicalQueryString).headers(header).get().build();
        httpResponse = this.httpConnection.doRequest(httpRequest);
        break;
    }
    case "POST": {
        // å¯¹äºæœ‰æ–‡ä»¶çš„è¯·æ±‚ï¼Œç”¨multipart/form-dataæ ¼å¼
        if(!request.files.isEmpty()){
            MultipartBody body = new MultipartBody.Builder()
                .setType(MultipartBody.FORM)
                .addFormDataPart(actionName + "Request",AbstractRequest.toJsonString(request))
                .addFormDataPart(FileUtil.getSuffix(request.info), request.getInfo(), RequestBody.create(request.getMultipartRequestParams().get(request.getInfo())))
                .build();
            httpRequest = new Request.Builder().url(url).headers(header).post(body).build();
        }else {
            // å¯¹äºæ²¡æœ‰æ–‡ä»¶çš„è¯·æ±‚ï¼Œå°†å‚æ•°æ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œç”¨application/jsonæ ¼å¼
            httpRequest = new Request.Builder().url(url).headers(header).post(RequestBody.create(requestPayload)).build();
        }
        httpResponse = this.httpConnection.doRequest(httpRequest);
        break;
    }
    default: {
        throw new PapiClientSDKException("ä¸æ”¯æŒè¯¥è¯·æ±‚",ErrorCode.OPERATION_ERROR);
    }
}
```

- å¯¹äºé¢„æµ‹ä¸šåŠ¡çš„æ¥å£

nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œç”¨openfeignè°ƒç”¨pythonè¯­è¨€çš„Djangoé¡¹ç›®çš„æ¥å£ã€‚è¿™é‡Œçš„æ¥æ”¶æ–‡ä»¶ç”¨çš„æ³¨è§£@RequestParamä¹Ÿæ˜¯èŠ±äº†å¥½ä¸€ç•ªåŠ²è¯•é”™æ‰è°ƒé€šçš„ã€‚

```java
@Resource
private LstmPredictor lstmPredictor;
@PostMapping("/lstm")
public LstmPredictResponse lstmPredict(@RequestParam(value = "xlsx",required = false) MultipartFile xlsxFile,
                                       @RequestParam(value = "csv",required = false) MultipartFile csvFile,
                                       @RequestParam(required = false) String lstmPredictRequest,HttpServletRequest request){
    throwIf(xlsxFile==null&&csvFile==null, ErrorCode.PARAMS_ERROR,"æ–‡ä»¶ä¸èƒ½ä¸ºç©º");
    HashMap<String, Object> map = xlsxFile != null ? lstmPredictor.lstmPredictExcel(lstmPredictRequest, xlsxFile)
        : lstmPredictor.lstmPredictCsv(lstmPredictRequest, csvFile);
    return new LstmPredictResponse((String)map.get("data"));
}
```

ä¸€äº›å‰ªå½±

@RequestParam

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240618093311.png)

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240618094520.png)

```java
case "POST": {
    if(request.files!=null&&!request.files.isEmpty()){
        httpRequest = HttpRequest.post(url+ "?" + actionName + "Request=" + AbstractRequest.toJsonString(request));
        for(Map.Entry<String,MultipartFile> entry:request.files.entrySet()){
            httpRequest.form(entry.getKey(),entry.getValue());
        }
    }else {
        httpRequest = HttpRequest.post(url);
        httpRequest = httpRequest.body(requestPayload);
    }
    break;
}
```

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240618105514.png)

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240618095630.png)

2. python Djangoé¡¹ç›®è·å–å‚æ•°

- pythoné¡¹ç›®çš„è·å–è¯·æ±‚å‚æ•°å’Œæ–‡ä»¶

```python
try:    
    data_json = json.loads(request.GET.get('lstmPredictRequest'))
    timeStep = int(data_json.get('timeStep'))
    ratio = float(data_json.get('ratio'))
    epoch = int(data_json.get('epoch'))
    batchSize = int(data_json.get('batchSize'))
    raw_data = pd.read_csv(request.FILES.get('csv'))
    if not raw_data:
        raw_data = pd.read_excel(request.FILES.get('xlsx'))
    if not raw_data:
        return JsonResponse({'code': 1002, 'message': 'æ•°æ®ä¸ºç©º', 'data': None})
    img_base64 = lstm(raw_data, timeStep, ratio, epoch, batchSize)
    return JsonResponse({'code': 0, 'message': 'è°ƒç”¨æˆåŠŸ', 'data': img_base64})
except Exception:
    logger.error(traceback.format_exc())
    return JsonResponse({'code': 1001, 'message': 'è¯·æ±‚å¤±è´¥', 'data': None})
```

- pythonè¿”å›çš„ç»“æœ

å…³äºè¿™ä¸ªæˆ‘æ˜¯æƒ³ç®€å•å¤„ç†çš„ï¼ŒLSTMé¢„æµ‹çš„ç»“æœä¸€èˆ¬éƒ½ç”¨matplotlibç”»å›¾ï¼Œè€Œä¸”æˆ‘ä¸æƒ³æŠŠæ–‡ä»¶åœ¨æœ¬åœ°ä¿å­˜ä¸‹æ¥ï¼Œå°±ç›´æ¥æŠŠå›¾ç‰‡è½¬ä¸ºæµï¼Œå†è½¬ä¸ºbase64ç¼–ç æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·åœ¨å‰ç«¯ç›´æ¥å¤ç°è¿™ä¸ªå›¾åƒã€‚

```python
# å°†å›¾è¡¨ä¿å­˜åˆ°BytesIOå¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯ç£ç›˜
    img_buffer = io.BytesIO()
    plt.savefig(img_buffer, format='png', bbox_inches='tight')
    plt.close()  # å…³é—­å›¾è¡¨ä»¥é‡Šæ”¾èµ„æº
    # å°†BytesIOå¯¹è±¡çš„ä½ç½®é‡ç½®ä¸ºå¼€å§‹ï¼Œä»¥ä¾¿ä»å¤´è¯»å–
    img_buffer.seek(0)
    # å°†å›¾è¡¨æ•°æ®è½¬æ¢ä¸ºBase64ç¼–ç 
    img_base64 = base64.b64encode(img_buffer.getvalue()).decode('utf-8')
    img_base64 = 'data:image/png;base64,' + img_base64
    print(img_base64)
```

æ¯”å¦‚è¯´ï¼Œè¿™æ˜¯æœ€ç»ˆçš„ç»“æœï¼š

<img src="https://github.com/polarisronx/Papi-backend/doc/images/QQ20240619190811.png" style="zoom:67%;" />

<img src="https://github.com/polarisronx/Papi-backend/doc/images/QQ20240619190904.png" style="zoom:67%;" />

å®é™…ä¸Šæ²¡æœ‰è¿™ä¹ˆè¿™ä¹ˆé¡ºåˆ©ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆbase64.b64encodeå¾—åˆ°çš„base64å­—ç¬¦ä¸²é•¿åº¦æ¯”æˆ‘æŠŠæ–‡ä»¶ä¿å­˜ä¸‹æ¥ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è½¬æ¢çš„è¦çŸ­ï¼Œå®é™…åœ¨å‰ç«¯çš„æ—¶å€™ä¹Ÿä¸æ˜¯è¿™ä¸ªæ ·å­ï¼Œåªæœ‰ä¸€ä¸ªç©ºç™½çš„å›¾ç‰‡ã€‚è¿™ä¸ªæ‰¾äº†å¾ˆä¹…éƒ½æ²¡çœ‹å‡ºæ¥å“ªé‡Œçš„é—®é¢˜ï¼Œå…ˆä¸ç»†ç©¶äº†ã€‚åé¢å¦‚æœä¼˜åŒ–çš„è¯ï¼Œå¯ä»¥æŠŠé¢„æµ‹æ•°æ®ä¼ å›æ¥å†åœ¨å‰ç«¯ç”¨echartsç­‰å¯è§†åŒ–å·¥å…·æ¡†æ¶å¤ç°è¿™ä¸ªå›¾è¡¨ï¼Œä¼šæ›´ä¼˜é›…ä¸€äº›ã€‚

3. å‰ç«¯ä»¥form-dataæ ¼å¼å‘é€å¸¦æœ‰æ–‡ä»¶å’Œè¯·æ±‚å‚æ•°çš„æ•°æ®

å‰ç«¯å…¶å®æ˜¯æ²¡é‚£ä¹ˆç†Ÿæ‚‰çš„ï¼Œè€Œä¸”æ¥å£å¤§å¤šéƒ½æ˜¯application/jsonå’Œopenapiè‡ªåŠ¨ç”Ÿæˆrequestç”¨æƒ¯äº†ï¼Œä¸ä¼šç»„è£…è¿™ä¸ªæœ‰æ–‡ä»¶å’Œè¯·æ±‚å‚æ•°çš„æ•°æ®ï¼ŒèŠ±äº†ä¸å°‘æ—¶é—´

```typescript
/** æ­¤å¤„åç«¯æ²¡æœ‰æä¾›æ³¨é‡Š POST /interfaceInfo/invoke */
export async function invokeInterfaceInfo(
  
  params: API.InterfaceInvokeRequest,
  body: {},
  file?: File,
  options?: { [key: string]: any },
) {
  const formData = new FormData();
  const invokeRequest = JSON.stringify(params)

  if (file) {
    formData.append('file', file);
  }
  formData.append('invokeRequest', invokeRequest);
  return request<API.BaseResponseObject>('/interfaceInfo/invoke', {
    method: 'POST',
    data: formData,
    requestType: 'form',
    ...(options || {}),
  });
}
```

## æ‹“å±•11ï¼šGatewayè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥

spring gatewayçš„é»˜è®¤è´Ÿè½½å‡è¡¡ç­–ç•¥æ˜¯è½®è¯¢ï¼Œåœ¨å¼€å‘å’Œä¸€èˆ¬ç¯å¢ƒå·²ç»è¶³å¤Ÿï¼Œä½†æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿåœ¨æ›´é«˜å¹¶å‘ä¸‹çš„ç¨³å®šæ€§ï¼Œåº”è¯¥æ ¹æ®å®ä¾‹å®é™…çš„è´Ÿè½½æƒ…å†µé€‰æ‹©ï¼Œä½¿ç›¸å¯¹ç©ºé—²æˆ–å¤„ç†é€Ÿåº¦æ›´å¿«çš„å®ä¾‹æ‰¿æ‹…æ›´å¤šçš„ä»»åŠ¡ã€‚

> è¦ç‚¹1ï¼šæœåŠ¡å®ä¾‹çš„ç¹å¿™ç¨‹åº¦æŒ‡æ ‡

è¡¡é‡æŒ‡æ ‡ï¼š

1. cpuä½¿ç”¨ç‡
2. å†…å­˜ä½¿ç”¨ç‡
3. ç£ç›˜IOä½¿ç”¨ç‡
4. ç½‘ç»œå¸¦å®½ä½¿ç”¨ç‡

å¯¹ä¸Šè¯‰4ä¸ªæŒ‡æ ‡åŠ æƒå¹³å‡ï¼Œå–ç»¼åˆå€¼æ¥è¡¡é‡å®ä¾‹çš„ç¹å¿™ç¨‹åº¦ã€‚

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240630161135.png)

æ¯ä¸ªå®ä¾‹éƒ½å¼€æ”¾æ€§èƒ½ç›‘æµ‹æ¥å£

```java
@RestController
@RequestMapping("/metrics")
public class InstanceMetricsController {
    @Value("${spring.profiles.active}")
    private String profile;
    @GetMapping("/")
    public InstanceMetricsRep getInstanceMetrics(){
        return BeanUtil.copyProperties(new ServerMetrics(profile), InstanceMetricsRep.class);
    }
}
```

> è¦ç‚¹2ï¼šç›‘æµ‹ä»»åŠ¡æ‰§è¡Œ:

1. åœ¨ç½‘å…³é¡¹ç›®ç”±å¼‚æ­¥å®šæ—¶ä»»åŠ¡å®Œæˆã€‚
2. å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒé‡‡ç”¨nacosï¼Œåœ¨æ³¨å†Œä¸­å¿ƒä¸Šæ‰¾åˆ°æ‰€æœ‰æä¾›æ¥å£æœåŠ¡çš„instancesï¼Œå¹¶é€ä¸€å¯¹å…¶çš„æ€§èƒ½æƒ…å†µè¿›è¡Œç›‘æµ‹ã€‚
3. å°†ç»“æœå­˜å‚¨åœ¨Redisä¸­ï¼Œåœ¨è°ƒç”¨æ—¶ç›´æ¥ä»ç¼“å­˜å–ã€‚
4. åˆ©ç”¨@scheduledæ³¨è§£å’ŒscheduledTaskExecutorçº¿ç¨‹å®ç°å®šæ—¶å¼‚æ­¥ä»»åŠ¡ï¼Œæ¯10ç§’åˆ·æ–°ä¸€æ¬¡ã€‚

[ä½¿ç”¨@Scheduleæ³¨è§£å®ç°å®šæ—¶ä»»åŠ¡ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼ŒCronè¡¨è¾¾å¼è¯¦è§£_å®šæ—¶ä»»åŠ¡æ³¨è§£-CSDNåšå®¢](https://blog.csdn.net/lexiaowu/article/details/131210846)

```java
@Component
@Slf4j
public class ActuatorConfig {
    @Value("${spring.profiles.active}")
    private String profile;
    @Resource
    private StringRedisTemplate stringRedisTemplate;
    @Resource
    private NacosNamingService nacosNamingService;
    
    @Scheduled(fixedDelay = 10000)
    public void scheduledTasks() throws NacosException{
        log.info("å®šæ—¶ä»»åŠ¡æ‰§è¡Œä¸­...");
        // æ‰§è¡Œå®šæ—¶ä»»åŠ¡
        List<Instance> instances = nacosNamingService.getAllInstances("papi-interface",profile);
        for(Instance instance : instances){
            String instanceIp = instance.getIp();
            if("dev".equals(profile)){
                instanceIp="127.0.0.1";
            }
            String instanceId = instance.getInstanceId();
            String url = instanceIp + ":" + instance.getPort() + "/api/metrics/";
            HttpResponse response = HttpRequest.get(url).execute();
            log.info("è·å–åˆ°å®ä¾‹"+instanceId+"çš„æŒ‡æ ‡ä¿¡æ¯");
            HashMap<String, Object> map= new HashMap<>(JSONUtil.parseObj(response.body()));
            OptionalDouble average = map.values().stream().mapToDouble(o-> ((BigDecimal)o).doubleValue()).filter(d -> d > 0).average();
            if (average.isPresent()) {
                log.info("å®ä¾‹"+instanceId+"çš„ç¹å¿™ç¨‹åº¦è¯„ä¼°å‡å€¼ï¼š" + average.getAsDouble());
                stringRedisTemplate.opsForValue().set(INSTANCE_METRICS_PREFIX + instanceId, String.valueOf(average.getAsDouble()),100, TimeUnit.SECONDS);
            } else {
                log.error("å®ä¾‹"+instanceId+"çš„ç¹å¿™ç¨‹åº¦è¯„ä¼°å‡å€¼è·å–å¤±è´¥");
            }
        }
        log.info("å®šæ—¶ä»»åŠ¡æ‰§è¡Œç»“æŸ...");
    }
}
```

> è¦ç‚¹3ï¼šè´Ÿè½½å‡è¡¡ç­–ç•¥

è®¾è®¡5ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š

- ROUND_ROBINå’ŒRANDOMæ˜¯è‡ªå¸¦çš„ç­–ç•¥ã€‚
- HEADERç­–ç•¥æ˜¯æ ¹æ®ç‰¹å®šçš„è¯·æ±‚åˆ†é…å¯¹åº”çš„å®ä¾‹ï¼Œåœ¨å‰ç«¯å‘é€è¯·æ±‚æ—¶è®¾ç½®è¯·æ±‚å¤´ï¼Œå…¶ä»–è¯·æ±‚è½®è¯¢ã€‚
- GATEWAYç­–ç•¥æ˜¯åœ¨é¡¹ç›®æœ¬åœ°æˆ–ç‰¹å®šIPä¸Šéƒ¨ç½²çš„å®ä¾‹ä¸Šè½®è¯¢ï¼Œé€‚åˆåœ¨å¼€å‘ç¯å¢ƒç”¨ã€‚
- LOADç­–ç•¥æ˜¯æ ¹æ®å®ä¾‹çš„è´Ÿè½½æƒ…å†µåˆ†é…ã€‚

å¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚

```java
public enum LoadBalancerTypeEnum {
    /**
     * æ ¹æ®è¯·æ±‚å¤´ä¸­çš„è®¾ç½®è·å–å¯¹åº”å®ä¾‹
     */
    HEADER,
    /**
     * åœ¨ç‰¹å®šIPéƒ¨ç½²çš„å®ä¾‹ä¸­è½®è¯¢
     */
    GATEWAY,
    /**
     * è½®å¾ª
     */
    ROUND_ROBIN,
    /**
     * æ ¹æ®å®ä¾‹è´Ÿè½½åˆ†é…
     */
    LOAD,
    /**
     * éšæœº
     */
    RANDOM;
}
```

å…·ä½“å®ç°ï¼š

åœ¨ä½ç‰ˆæœ¬ä¸­gatewayçš„è´Ÿè½½å‡è¡¡æ˜¯ç”±ribbonæä¾›çš„ï¼Œä½†æ˜¯ribbonå·²ç»ä¸å†ç»´æŠ¤äº†ï¼Œspring cloudä¸­å¼•å…¥äº†loadbalanceråŒ…ã€‚é»˜è®¤çš„è½®è¯¢è´Ÿè½½å‡è¡¡ç­–ç•¥

org.springframework.cloud.loadbalancer.core.RoundRobinLoadBalancer

åŒ…ä¸­ï¼Œç…§çŒ«ç”»è™ä¹Ÿå®ç°ä¸€ä¸ªè¿™ä¸ªç±»å°±å¯ä»¥ã€‚ä¸»è¦è¦åšçš„å°±æ˜¯å®ç°ReactorServiceInstanceLoadBalanceræ¥å£å’Œchoose()æ–¹æ³•

```java
public class RoundRobinLoadBalancer implements ReactorServiceInstanceLoadBalancer {
	public Mono<Response<ServiceInstance>> choose(Request request) {
    }
}
```

å®æµ‹æ•ˆæœ

![](https://github.com/polarisronx/Papi-backend/doc/images/QQ20240630155958.png)

## æ‹“å±•12ï¼šæ¥å£QPSæµ‹è¯•

